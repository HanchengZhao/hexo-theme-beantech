{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/img/hz_logo.JPG","path":"img/hz_logo.JPG","modified":0,"renderable":0},{"_id":"source/img/404-bg.jpg","path":"img/404-bg.jpg","modified":0,"renderable":0},{"_id":"themes/beantech/source/css/archive.styl","path":"css/archive.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/beantech.css","path":"css/beantech.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/beantech.min.css","path":"css/beantech.min.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/highlight.styl","path":"css/highlight.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/hux-blog.min.css","path":"css/hux-blog.min.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/rocket.styl","path":"css/rocket.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/signature.styl","path":"css/signature.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/toc.styl","path":"css/toc.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/widget.styl","path":"css/widget.styl","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.eot","path":"fonts/glyphicons-halflings-regular.eot","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.ttf","path":"fonts/glyphicons-halflings-regular.ttf","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff","path":"fonts/glyphicons-halflings-regular.woff","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff2","path":"fonts/glyphicons-halflings-regular.woff2","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/bootstrap.min.js","path":"js/bootstrap.min.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/hux-blog.js","path":"js/hux-blog.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/hux-blog.min.js","path":"js/hux-blog.min.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.nav.js","path":"js/jquery.nav.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.tagcloud.js","path":"js/jquery.tagcloud.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/toc.js","path":"js/toc.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"source/img/self.jpg","path":"img/self.jpg","modified":0,"renderable":0},{"_id":"themes/beantech/source/css/bootstrap.min.css","path":"css/bootstrap.min.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.svg","path":"fonts/glyphicons-halflings-regular.svg","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/bootstrap.js","path":"js/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/beantech/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"source/img/header_img/about.jpg","path":"img/header_img/about.jpg","modified":0,"renderable":0},{"_id":"source/img/header_img/reservoir.jpg","path":"img/header_img/reservoir.jpg","modified":0,"renderable":0},{"_id":"source/img/contact-bg.jpg","path":"img/contact-bg.jpg","modified":0,"renderable":0},{"_id":"themes/beantech/source/css/bootstrap.css","path":"css/bootstrap.css","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/images/rocket.png","path":"css/images/rocket.png","modified":0,"renderable":1},{"_id":"themes/beantech/source/css/images/ironman.png","path":"css/images/ironman.png","modified":0,"renderable":1},{"_id":"source/img/header_img/home_bg_ud_night.jpg","path":"img/header_img/home_bg_ud_night.jpg","modified":0,"renderable":0},{"_id":"themes/beantech/source/js/jquery.js","path":"js/jquery.js","modified":0,"renderable":1},{"_id":"source/img/header_img/ud_night2.jpg","path":"img/header_img/ud_night2.jpg","modified":0,"renderable":0},{"_id":"source/img/header_img/tag-bg.png","path":"img/header_img/tag-bg.png","modified":0,"renderable":0},{"_id":"source/img/header_img/home-bg-o.png","path":"img/header_img/home-bg-o.png","modified":0,"renderable":0},{"_id":"source/img/header_img/home-bg-2-dark.png","path":"img/header_img/home-bg-2-dark.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/404.md","hash":"0faff01487675fca7c677bcdf200c51f4d2ff670","modified":1554342395000},{"_id":"source/CNAME","hash":"3680806b5507742f5f42a76f385b1a7ccb5c85c7","modified":1554342395000},{"_id":"themes/beantech/LICENSE","hash":"2b209f06bebeb2a8c2b7e187e436f3e1e1fbc8a7","modified":1554342395000},{"_id":"themes/beantech/_config.yml","hash":"6afd65c055d9b1c70ae67323cc869f1b4aa60348","modified":1554342395000},{"_id":"source/_drafts/a.md","hash":"427dcbd387dbbe28677cac2337deef7a753efc9b","modified":1554342395000},{"_id":"source/_posts/Automatically-create-merge-request-through-gitlab-api.md","hash":"4c9b670de91df8eb5ed6c2c9f09f290946b37b60","modified":1566005899275},{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP.md","hash":"68eb0340944e723f4fe2008e421ac4926e15a03a","modified":1554342395000},{"_id":"source/_posts/Interesting-Software-Names.md","hash":"da11ea6579b419a8d4f4ad944c006ae768f857f3","modified":1566006869794},{"_id":"source/_posts/JavaScript-Flaws.md","hash":"bf9f052b4a036d2e470925c0cf89f4bff9dc73fa","modified":1554342395000},{"_id":"source/_posts/Python-Collections-And-Tricks.md","hash":"6823511e145646a7847b725647a7d21572125cc4","modified":1554342395000},{"_id":"source/_posts/To-My-Graduation.markdown","hash":"51c1ba1898385c81c6f35185b446c92e60b2d55c","modified":1554342395000},{"_id":"source/_posts/Treechart-In-D3.md","hash":"facc7288d90bb73d88df54a039bf2c84545d3db0","modified":1554342395000},{"_id":"source/_posts/deploy-a-react-app-in-kubernetes.md","hash":"fb735c33a321745bef184062a59b2b296c17e050","modified":1554342395000},{"_id":"source/_posts/python-leetcode-trick.md","hash":"a140bac64ae6f9d471a438e3e0432f9f63c99a14","modified":1566082443471},{"_id":"source/_posts/react-global-state-management.md","hash":"78854cb2a1d53100c226aaa1f61d534f720dac1e","modified":1554342395000},{"_id":"source/_posts/一次关于networking的对话.md","hash":"86b7b9a66268559fa0bde36bb8695d0944d3f9f6","modified":1554342395000},{"_id":"source/about/index.md","hash":"59c945c47fa7f0f49c080e500b819b4172ad521b","modified":1554342395000},{"_id":"source/archive/index.md","hash":"945e5d0a779baa8239d734de30c57c0b3cc926ff","modified":1554342395000},{"_id":"source/img/hz_logo.JPG","hash":"fa10c81b50c6d6360e0da9d2ca7834db992221e6","modified":1554342395000},{"_id":"source/tags/index.md","hash":"f0733166badf849ad60a32a210eff34015860839","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/de.yml","hash":"424a9c1e6ab69334d7873f6574da02ca960aa572","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/en.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/default.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/es.yml","hash":"cb4eeca0ed3768a77e0cd216300f2b2549628b1b","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/no.yml","hash":"8ca475a3b4f8efe6603030f0013aae39668230e1","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/pl.yml","hash":"de7eb5850ae65ba7638e907c805fea90617a988c","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/ru.yml","hash":"42df7afeb7a35dc46d272b7f4fb880a9d9ebcaa5","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/zh-CN.yml","hash":"7bfcb0b8e97d7e5edcfca8ab26d55d9da2573c1c","modified":1554342395000},{"_id":"themes/beantech/languages_to_be_added/zh-TW.yml","hash":"9acac6cc4f8002c3fa53ff69fb8cf66c915bd016","modified":1554342395000},{"_id":"themes/beantech/layout/404.ejs","hash":"a4d73541a53e56b7dd46249c6d27cb59f4d97422","modified":1554342395000},{"_id":"themes/beantech/layout/about.ejs","hash":"edcf8fa3bf7093c974d418ffef42ac89c19af128","modified":1554342395000},{"_id":"themes/beantech/layout/archive.ejs","hash":"72a150c8dff0031a9107d12eaa7c2e6c6ce950d2","modified":1554342395000},{"_id":"themes/beantech/layout/index.ejs","hash":"dc8a6eaa00d1e7c33a40979afe0953ed5d7b512e","modified":1554342395000},{"_id":"themes/beantech/layout/keynote.ejs","hash":"f5689862281e34dbe8402b0e72f632902e53e88b","modified":1554342395000},{"_id":"themes/beantech/layout/layout.ejs","hash":"8205bd04d838ec9829805c34c6998e25471be661","modified":1554342395000},{"_id":"themes/beantech/layout/page.ejs","hash":"c90797e4394c5cb63c2515109480e766d04e486e","modified":1554342395000},{"_id":"themes/beantech/layout/post.ejs","hash":"2d55684fc539dc281f9e2ec0409f09ea6ca43949","modified":1554342395000},{"_id":"themes/beantech/layout/tags.ejs","hash":"2c72eb2e89130658aa068d80d27b561b509c5dcd","modified":1554342395000},{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP/formlist.png","hash":"84d8e535105b97f5ae2419efd696090d184fef43","modified":1554342395000},{"_id":"source/img/404-bg.jpg","hash":"68f7d525269a94287e0ad18713ae232fb59dcf71","modified":1554342395000},{"_id":"themes/beantech/layout/_partial/head.ejs","hash":"5531acfa70f29d47273b295460fa8a188393f458","modified":1566005768430},{"_id":"themes/beantech/layout/_partial/footer.ejs","hash":"671e10ff2eb6fad451b155df7d72d125059c12ff","modified":1554342395000},{"_id":"themes/beantech/layout/_partial/header.ejs","hash":"aafb744601042f0270d2e6595129ac8a73ad2608","modified":1554342395000},{"_id":"themes/beantech/layout/_partial/nav.ejs","hash":"4c905166c960852e9b9a3c9d5c680091e37b481f","modified":1554342395000},{"_id":"themes/beantech/layout/_partial/pagination.ejs","hash":"557d6bb069a1d48af49ae912994653f44b32a570","modified":1554342395000},{"_id":"themes/beantech/layout/_partial/sidebar.ejs","hash":"2e4e528a555917b2a267da4db2440bcc4a7a65ab","modified":1554342395000},{"_id":"themes/beantech/layout/_partial/toc.ejs","hash":"837f01e8a20e5023b4b292d1b3141a399567da65","modified":1554342395000},{"_id":"themes/beantech/layout/_widget/archive.ejs","hash":"7594929d472806ca4c64d9906d9903a96de111a0","modified":1554342395000},{"_id":"themes/beantech/layout/_widget/category.ejs","hash":"1cf485def07dc06e870dc9613767c6c614bcf428","modified":1554342395000},{"_id":"themes/beantech/layout/_widget/featured-tags.ejs","hash":"0c9ce1942f1943dc8891a9302a922ef1ffe300c5","modified":1554342395000},{"_id":"themes/beantech/layout/_widget/friends-blog.ejs","hash":"734d3775017aedac185028924baf890a71a74548","modified":1554342395000},{"_id":"themes/beantech/layout/_widget/recent-posts.ejs","hash":"e08ab8ba60e31638006acf27f066b989a0a3c433","modified":1554342395000},{"_id":"themes/beantech/layout/_widget/short-about.ejs","hash":"3b10bd768f6ef30a42b1703fbc9a88627f9bfdf1","modified":1554342395000},{"_id":"themes/beantech/source/css/archive.styl","hash":"715bcbd085eb95ec26c9805c11c374919cde971c","modified":1554342395000},{"_id":"themes/beantech/source/css/beantech.css","hash":"4c361354fd8e9851923fb21a620bc079380ebcd8","modified":1554342395000},{"_id":"themes/beantech/source/css/beantech.min.css","hash":"05a06230b1a9eca0b30cece54a397008cb77dc50","modified":1554342395000},{"_id":"themes/beantech/source/css/highlight.styl","hash":"e842080e6d580f0f70a7df71fbde3c4e49463c19","modified":1554342395000},{"_id":"themes/beantech/source/css/hux-blog.min.css","hash":"1baef04de262aeb7023d835429b49a805ac4ab40","modified":1554342395000},{"_id":"themes/beantech/source/css/rocket.styl","hash":"e15c51c8566ecd943112e57592888dd318b6fa6a","modified":1554342395000},{"_id":"themes/beantech/source/css/signature.styl","hash":"88159b31c59d59c01a0b534af57242662a2a3969","modified":1554342395000},{"_id":"themes/beantech/source/css/toc.styl","hash":"6c9a2d5f6f981624e0c4b64323493e8614efea29","modified":1554342395000},{"_id":"themes/beantech/source/css/widget.styl","hash":"7a9f735f5ef323dc2950fbd9d76daa16c9a0f1a9","modified":1554342395000},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1554342395000},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1554342395000},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1554342395000},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1554342395000},{"_id":"themes/beantech/source/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1554342395000},{"_id":"themes/beantech/source/js/hux-blog.js","hash":"4b4d3c557405d04c3087d36c13e2834fe05c0f73","modified":1554342395000},{"_id":"themes/beantech/source/js/hux-blog.min.js","hash":"1563e7f70550ac6b30803d6f449719b853200e35","modified":1554342395000},{"_id":"themes/beantech/source/js/jquery.nav.js","hash":"ef2160a456176a4d09cc0b95d52b27dfbbadf2d8","modified":1554342395000},{"_id":"themes/beantech/source/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1554342395000},{"_id":"themes/beantech/source/js/toc.js","hash":"41e52551731854224c249d53010c1bae5aa92ffa","modified":1554342395000},{"_id":"themes/beantech/source/js/totop.js","hash":"c05360f6fc699ac12e794b1764b4a952713a3017","modified":1554342395000},{"_id":"source/_posts/deploy-a-react-app-in-kubernetes/tree.jpg","hash":"1b05174884398fc960c31afb46be1b65ce07b56d","modified":1554342395000},{"_id":"source/_posts/一次关于networking的对话/lighthouse3.jpg","hash":"ceb795e0bd1278ea08a987560cb20fe4c76ae0c3","modified":1554342395000},{"_id":"source/img/self.jpg","hash":"80719b5a0facd80782a2b4b40a5f9252f4bf7a7d","modified":1554342395000},{"_id":"themes/beantech/source/css/bootstrap.min.css","hash":"fec7b176a4b9a67c0eb5d184f57b84297efc23aa","modified":1554342395000},{"_id":"themes/beantech/source/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1554342395000},{"_id":"themes/beantech/source/js/bootstrap.js","hash":"f8752e9ae24daec0a0baffd7819122f8c6fd9103","modified":1554342395000},{"_id":"themes/beantech/source/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1554342395000},{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP/cron_job.png","hash":"606e13cd06cbaae383f1616ce4426a30fae556a6","modified":1554342395000},{"_id":"source/img/header_img/about.jpg","hash":"82119e22e74e38efe67164aecdd7fa27af723539","modified":1554342395000},{"_id":"source/img/header_img/reservoir.jpg","hash":"7f3809e40a441de3bd981142309ab4493b16ba95","modified":1554342395000},{"_id":"source/img/contact-bg.jpg","hash":"6af63305c923899017e727b5ca968a2703bc08cf","modified":1554342395000},{"_id":"themes/beantech/source/css/bootstrap.css","hash":"41c54bf695145ae0b4d9020a1da308ceb05dcaf3","modified":1554342395000},{"_id":"themes/beantech/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1554342395000},{"_id":"themes/beantech/source/css/images/ironman.png","hash":"2f0db0ab15d466c4065d9f6102fdf829726d9e3f","modified":1554342395000},{"_id":"source/_posts/Automatically-create-merge-request-through-gitlab-api/gitlab-blog-cover.png","hash":"cbc7f1915bd89ba995f307c23286c20c630a028d","modified":1566005768430},{"_id":"source/_posts/Treechart-In-D3/tree.jpg","hash":"18d56421dbd919c24bd2a30c9a3b36a877ec1e6d","modified":1554342395000},{"_id":"source/img/header_img/home_bg_ud_night.jpg","hash":"dc6080e554fdce64335d200ccd5695af22962255","modified":1554342395000},{"_id":"themes/beantech/source/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1554342395000},{"_id":"source/_posts/Python-Collections-And-Tricks/us_map.JPG","hash":"c50e5bd601645aa85b19b446ce7d9b4afef3d8e9","modified":1554342395000},{"_id":"source/img/header_img/ud_night2.jpg","hash":"d16ed7cb22e2148059d67089115e261d29941226","modified":1554342395000},{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP/longwood.JPG","hash":"30217bf68187255925358b0ffa62d595d124a7b6","modified":1554342395000},{"_id":"source/_posts/Interesting-Software-Names/trigger.png","hash":"66c8293e05ced4bd71becc1d61d8df2c44868165","modified":1554342395000},{"_id":"source/_posts/JavaScript-Flaws/centralPark.jpg","hash":"248b59bc027479570f45496ef4c6a351bd9ff675","modified":1554342395000},{"_id":"source/_posts/Interesting-Software-Names/trip.JPG","hash":"f11b206240db202379386f0a0d979db53a88e009","modified":1554342395000},{"_id":"source/_posts/To-My-Graduation/campus.JPG","hash":"ca0deccc7b6030d32a3d310ed8e268766b0527b5","modified":1554342395000},{"_id":"source/img/header_img/tag-bg.png","hash":"e83cd7b04ff85bcbc9bd3ebf5e57a55166e82568","modified":1554342395000},{"_id":"source/_posts/react-global-state-management/sunset.JPG","hash":"262924f7cb9e2cf17d9f6081cc3024b1fefb4d61","modified":1554342395000},{"_id":"source/img/header_img/home-bg-o.png","hash":"134ece4cb4c49c7ca1403a5afe7f46d0e2f9ecbb","modified":1554342395000},{"_id":"source/img/header_img/home-bg-2-dark.png","hash":"da6a3d5ca787bdc25e69655abd879b4f821aeb30","modified":1554342395000},{"_id":"source/_posts/To-My-Graduation/andy.jpg","hash":"2ab4ac4daf86d0102acbd51647bf5e866d9ce059","modified":1554342395000},{"_id":"source/_posts/To-My-Graduation/graduation.jpg","hash":"aaa88d0aa7be8ebc8e9b8c1494145a6f447e39e7","modified":1554342395000},{"_id":"source/_posts/To-My-Graduation/mac_room.JPG","hash":"d8fa6d41c1c73401f7cce66b551d1c1d17fce931","modified":1554342395000},{"_id":"source/_posts/python-leetcode-trick/antelope_valley.JPG","hash":"d736acdeaaf4c6b1f30afea574d1dfe1c6c22ebd","modified":1566006195760},{"_id":"public/post-sitemap.xml","hash":"518882fd08039b0bd727b3d825cf5019038567ab","modified":1566083674427},{"_id":"public/page-sitemap.xml","hash":"ce1fa04dbaed268133189ae57313bff334f3998f","modified":1566083674428},{"_id":"public/category-sitemap.xml","hash":"118086f4c86debf5a67b6fe3efa90888c8e922b0","modified":1566083674628},{"_id":"public/tag-sitemap.xml","hash":"991951452776849eccbeb9d9febdfc998921d98b","modified":1566083674629},{"_id":"public/sitemap.xsl","hash":"4321fa69dc1b8811d32b7a1478e5603e038cea1a","modified":1566083674718},{"_id":"public/sitemap.xml","hash":"0d35e75c1e7cbd78cab6481ef337e3e6724956d9","modified":1566083674721},{"_id":"public/404.html","hash":"b36c68e2f922e56293c77caed61e92d544258cf7","modified":1566083674734},{"_id":"public/archives/2/index.html","hash":"1386d263e1a0c727d2600e314dd248c50b03972a","modified":1566083674734},{"_id":"public/tags/index.html","hash":"cb23f6155a637c372be9d95971b40fb8dbaceaaa","modified":1566083674734},{"_id":"public/2019/08/16/python-leetcode-trick/index.html","hash":"6aec0f1d92a493ca52cc7d381e9d68462e32e0b5","modified":1566083674735},{"_id":"public/2018/05/07/Treechart-In-D3/index.html","hash":"f6a1301c3da8df42b2ee8599894eafb8b5544e7e","modified":1566083674735},{"_id":"public/2019/04/03/Automatically-create-merge-request-through-gitlab-api/index.html","hash":"7e76baf9ae2876c6af0174ce42516d0748505a05","modified":1566083674735},{"_id":"public/2018/03/08/react-global-state-management/index.html","hash":"bec43639719e84bc164985fffa5856bfcd9730c4","modified":1566083674735},{"_id":"public/2018/04/02/Interesting-Software-Names/index.html","hash":"8b36b9da806e77056963c1639ebd8f49da25cea8","modified":1566083674735},{"_id":"public/2018/01/13/deploy-a-react-app-in-kubernetes/index.html","hash":"2cc9f1fbc35244759a75d25aee64269c1ef3d360","modified":1566083674735},{"_id":"public/2017/12/25/一次关于networking的对话/index.html","hash":"2d7e685019a6102fcab6aa0d3ee0676b4844630c","modified":1566083674735},{"_id":"public/2017/11/18/Cloud-Based-Web-Tools-For-VIP/index.html","hash":"059bdc740f179a0067c417c8bbc59e19576a5cd6","modified":1566083674735},{"_id":"public/2017/05/27/To-My-Graduation/index.html","hash":"f53029e5b323b773997873104314da7027207526","modified":1566083674735},{"_id":"public/2017/05/22/Python-Collections-And-Tricks/index.html","hash":"9360ce66d1ea1290ad0b8feff09bd5317b768c55","modified":1566083674736},{"_id":"public/2017/02/07/JavaScript-Flaws/index.html","hash":"a7e2117b02c2d25150274e5b3ce15f6e5954c38f","modified":1566083674736},{"_id":"public/archive/index.html","hash":"84c7160693d2bd0ae352d7b557f22458d6fc2c23","modified":1566083674736},{"_id":"public/about/index.html","hash":"e99824df907f918ee4fd342d0a7f0b8c22bac624","modified":1566083674736},{"_id":"public/categories/Projects/index.html","hash":"dc047c3c1da3ef28cc9f80b4767e1beaa4cb6cd1","modified":1566083674736},{"_id":"public/index.html","hash":"b1490408039eaf6465e2efe28d1324940001683f","modified":1566083674736},{"_id":"public/archives/index.html","hash":"4d7dd1c8285e49d8ed01ec86709a7e05b397ecab","modified":1566083674736},{"_id":"public/archives/archives/2/index.html","hash":"6196fa959081cb2c52a86ff8936c3d9fe99a1b47","modified":1566083674736},{"_id":"public/archives/2017/index.html","hash":"b67e226b3ea08db24baf8ab763a52657f80d6456","modified":1566083674736},{"_id":"public/archives/2017/02/index.html","hash":"620bbf4734d15540d0ac4248ca706662cbd2525a","modified":1566083674736},{"_id":"public/archives/2017/05/index.html","hash":"3ee011de7347879cc9705dd5f8d8f9b8844b9105","modified":1566083674736},{"_id":"public/archives/2017/11/index.html","hash":"f97b81215d203953bbc16fea64f0a2899ab841a6","modified":1566083674737},{"_id":"public/archives/2017/12/index.html","hash":"984c4aa8f24bb72f87c3d7c2b4a23dbb8a6b963e","modified":1566083674737},{"_id":"public/archives/2018/index.html","hash":"ef196ad9f504f1d52054af63cbbc16801cbf6ac2","modified":1566083674737},{"_id":"public/archives/2018/01/index.html","hash":"40f465722176691a92edef7159b63614bbd5bc93","modified":1566083674737},{"_id":"public/archives/2018/03/index.html","hash":"4ea6bda2a705234b9263848dfecf0961473ef96b","modified":1566083674737},{"_id":"public/archives/2018/04/index.html","hash":"2877fd888e66ed7b7eb1b749cac21dbbaa584b2a","modified":1566083674737},{"_id":"public/archives/2018/05/index.html","hash":"eb60fb86c7fda89e27549db99487b704f6a0f272","modified":1566083674737},{"_id":"public/archives/2019/04/index.html","hash":"cd73a38127cd3fac69bd3d258b434f6581126363","modified":1566083674737},{"_id":"public/archives/2019/index.html","hash":"b353162cba6676fee6dc662860320516857528a8","modified":1566083674737},{"_id":"public/archives/2019/08/index.html","hash":"f576e0f5cd29c2d8d0825e1d8091c44fd473f236","modified":1566083674737},{"_id":"public/tags/Cloud/index.html","hash":"35b0f34858a114e2ce35aa1e585586163e074b8a","modified":1566083674737},{"_id":"public/tags/React-js/index.html","hash":"38fd8ed92f10fb7b1b7c167df9388714f97dcc9a","modified":1566083674737},{"_id":"public/tags/Firebase/index.html","hash":"f79d88f50e4348b98dd280b7f4c3bc41ffc63583","modified":1566083674737},{"_id":"public/tags/CockroachDB/index.html","hash":"ec4ce52c0e8a72f6bd8db7a1fba62cfc5dc45430","modified":1566083674737},{"_id":"public/tags/Google/index.html","hash":"00ebab3e5549ca7880d72fcfa3585689878eedeb","modified":1566083674737},{"_id":"public/tags/Kubernetes/index.html","hash":"01c6f83f9ca2c4791d55fa88b05abcc66d135047","modified":1566083674737},{"_id":"public/tags/Docker/index.html","hash":"4152f5c3f209816f0f652ffd4b7e307afbf2a752","modified":1566083674738},{"_id":"public/tags/JavaScript/index.html","hash":"4b96cfb45d8400284a7518b9288f2b71866d51f2","modified":1566083674738},{"_id":"public/tags/python/index.html","hash":"4089bdaf49fba71da0059ed401b35b50871be27d","modified":1566083674738},{"_id":"public/tags/Thoughts/index.html","hash":"aa659e75af61b96b0ff58d757e5cba00227c21a8","modified":1566083674738},{"_id":"public/tags/D3-js/index.html","hash":"c932d62fb54680a26d209ca8403f08185782527f","modified":1566083674738},{"_id":"public/tags/gitlab/index.html","hash":"ddb0465ae324ed12ba3d0190ecabcf4f2dd62467","modified":1566083674738},{"_id":"public/tags/bash/index.html","hash":"47132984e590756bb7f0cb4eb305532c7393fba7","modified":1566083674738},{"_id":"public/tags/node/index.html","hash":"7d465008b5602f64e56979a3cfe0b3744e32f7ce","modified":1566083674738},{"_id":"public/tags/leetcode/index.html","hash":"e48a73229e27e026c04326639dcba9c1dbc55bf2","modified":1566083674739},{"_id":"public/tags/algorithm/index.html","hash":"7f5290a0e9551103ffcb9020b7221241f2adb18a","modified":1566083674739},{"_id":"public/tags/React/index.html","hash":"5b2c241a69b2974cb04abdb5a4aada6a48ab4f90","modified":1566083674739},{"_id":"public/tags/Redux/index.html","hash":"a38ed1010eb728f0790a89b4a7cfa4063fa4ae56","modified":1566083674739},{"_id":"public/tags/Mobx/index.html","hash":"5bae93253c3249d8a271be9de3e8db2dfa114f1f","modified":1566083674739}],"Category":[{"name":"Projects","_id":"cjzg5rxxi0007x18lywu2klz6"}],"Data":[],"Page":[{"layout":"404","description":"No resource here :(","header-img":"img/404-bg.jpg","_content":"","source":"404.md","raw":"---\nlayout: 404\ndescription: \"No resource here :(\"\nheader-img: \"img/404-bg.jpg\"\n---\n","date":"2019-08-14T23:31:16.499Z","updated":"2019-04-04T01:46:35.000Z","path":"404.html","title":"","comments":1,"_id":"cjzg5rxw70000x18ldwdvejaq","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"archive","title":"Archives","header-img":"img/header_img/ud_night2.jpg","comments":0,"date":"2017-03-21T00:49:56.000Z","description":" ","_content":"","source":"archive/index.md","raw":"---\nlayout: \"archive\"\ntitle: \"Archives\"\nheader-img: \"img/header_img/ud_night2.jpg\"\ncomments: false\ndate: 2017-03-20 20:49:56\ndescription: \" \"\n---\n","updated":"2019-04-04T01:46:35.000Z","path":"archive/index.html","_id":"cjzg5rxxa0002x18lf0ehnc93","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"about","title":"About","date":"2017-11-09T03:48:33.000Z","description":"Finish each day and be done with it","header-img":"img/header_img/about.jpg","comments":1,"_content":"\n I’m a software engineer at [SevOne](https://www.sevone.com/).\n\n My interest lies from the front end to the back end, from the code to the design, from the beauty of arts to the logic of science, from the photography to all kinds of sports and everything in between.\n","source":"about/index.md","raw":"---\nlayout: \"about\"\ntitle: \"About\"\ndate: 2017-11-8 22:48:33\ndescription: \"Finish each day and be done with it\"\nheader-img: \"img/header_img/about.jpg\"\ncomments: true\n---\n\n I’m a software engineer at [SevOne](https://www.sevone.com/).\n\n My interest lies from the front end to the back end, from the code to the design, from the beauty of arts to the logic of science, from the photography to all kinds of sports and everything in between.\n","updated":"2019-04-04T01:46:35.000Z","path":"about/index.html","_id":"cjzg5rxxc0004x18l0u4rriux","content":"<p>I’m a software engineer at <a href=\"https://www.sevone.com/\" target=\"_blank\" rel=\"noopener\">SevOne</a>.</p>\n<p>My interest lies from the front end to the back end, from the code to the design, from the beauty of arts to the logic of science, from the photography to all kinds of sports and everything in between.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>I’m a software engineer at <a href=\"https://www.sevone.com/\" target=\"_blank\" rel=\"noopener\">SevOne</a>.</p>\n<p>My interest lies from the front end to the back end, from the code to the design, from the beauty of arts to the logic of science, from the photography to all kinds of sports and everything in between.</p>\n"},{"layout":"tags","title":"Tags","description":" ","header-img":"img/header_img/reservoir.jpg","_content":"","source":"tags/index.md","raw":"---\nlayout: \"tags\"\ntitle: \"Tags\"\ndescription: \" \"\nheader-img: \"img/header_img/reservoir.jpg\"\n---\n","date":"2019-08-14T23:31:16.961Z","updated":"2019-04-04T01:46:35.000Z","path":"tags/index.html","comments":1,"_id":"cjzg5rxxf0006x18lwu2r7959","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"a","catalog":true,"subtitle":null,"header-img":null,"_content":"### test draft post\n\n{% codeblock lang:javascript %}\nvar a = function(a, b) {\n    console.log(\"hi\")；\n}\n{% endcodeblock %}","source":"_drafts/a.md","raw":"---\ntitle: a\ncatalog: true\nsubtitle:\nheader-img:\ntags:\n---\n### test draft post\n\n{% codeblock lang:javascript %}\nvar a = function(a, b) {\n    console.log(\"hi\")；\n}\n{% endcodeblock %}","slug":"a","published":0,"date":"2019-04-04T01:46:35.000Z","updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxx50001x18lz655jtyv","content":"<h3 id=\"test-draft-post\">test draft post</h3>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"hi\"</span>)；</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h3>test draft post</h3>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"hi\"</span>)；</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Cloud Based Web Tools For VIP","catalog":true,"date":"2017-11-19T02:10:56.000Z","subtitle":null,"header-img":"longwood.JPG","_content":"\n\n> Reactjs, Firebase, Cloud Functions, serverless architecture, material ui\n\n\nThe project that I have been working on recently is a cloud-based web tool for ASU to manage new teams, announcements, student/project application and peer evaluation. [Github link](https://github.com/HanchengZhao/VIP-web)\n\nSo it is basically a CMS(content management system), but far more lightweight than Drupal, Sharepoint or WordPress. It is still an SPA (single page application), yet a huge upgrade of my last year's peer evaluation tool for UD.\n\nIt has been a fun journey so far and I have tried many brand new things and received new experience, so it is worth recording some thoughts along the way.\n\n## Why cloud-based serverless architecture?\n\nThis is a fundamental question why we choose firebase as our backend or even infrastructure. \nFirst of all, serveless does not mean **\"no server at all\"**, it only means that end users or developers no longer need to build or maintain their own servers. Rather, they borrow microservices that are wrapped from those giant tech companies servers, like Amazon Web Service(AWS) or Google Cloud Platform. Thus, developers can focus only on the app logic or ui side, which saves so much money and time especially for startups. Those platform usually provide all kinds of services from database storage to monitoring/testing, web hosting, email/message notification and cloud functions. This 'all in one' solution is so much more handy for developers. \n\nBesides, the selling point of serverless is that **\"you only pay the compute that you need\"**. There is no waiting time for servers to start, they are just constantly running and you only account for the computing power that you need. Nowadays, people share cars, houses, now even the computing power. \nOf course serverless architecture is not a panacea, but it meets our needs so far.\n\n## Then why Firebase?\n\nSimply because it provides the exact service that we need for our app. We need a Nosql database, a secure authentication system to implement role-based access control, a storage service to save posters or team logos, an easy-to-deploy hosting service, and backend cloud functions to handle light logic, sanitize data or send emails for us. Besides, it has nice ui and easy-to-use command line tool. After being acquired by Google last summer, it has stronger back and is well integrated into google cloud platform.\n\n## Implementations\n\n### Schedule (Cron) tasks with Cloud Functions\n\nCloud functions are so powerful that they can serve as a fast-loading server to deal with database and storage. However, they are usually triggered by events, such as `onWrite` action.\n\nFirebase blog has a article explaining using App Engine from google cloud platform to do it:\n> [How to Schedule (Cron) Jobs with Cloud Functions for Firebase](https://firebase.googleblog.com/2017/03/how-to-schedule-cron-jobs-with-cloud.html)\n\nHere, we choose the site [Cron Job](https://cron-job.org/en/) to handle cron work for us. It has user-friendly interface and is easy to configure cron jobs. \n\n![cron job](cron_job.png)\n\nHere we set the cron job to run once a day to remove overdue announcement and put scheduled ones in the page. It is important to add a key parameter after the url to avoid malicious access.\n\n### Render elements iteratively in React\n\nIn React, components can be saved and passed as variables. It gives us a more flexible way to loop elements in an array, and interatively render components in the same format. Here is an example of 'formItem' component:\n\n```js\n\nlet formItem = keys.map((key) => (\n    <tr key = {key}>\n        <td><Link to={`${team}/${key}`}>{forms[key].formName}</Link></td>\n        <td>{forms[key].startDate.substr(0,15)}</td>\n        <td>{forms[key].endDate.substr(0,15)}</td>\n        <td>{forms[key].editDate.substr(0,15)}</td>\n        <td>{key === defaultId ? 'default' : <a href=\"#\" onClick = {(e) => this.setAsDefault(team, key,e) }>set as default</a>}</td>\n        <td><i className =\"glyphicon glyphicon-remove\" style = {{cursor:\"pointer\"}} id = {key} onClick = {() => this.handleRemove(team, key)}/></td>\n    </tr>\n    ));\n\n```\nIn es6, `()` after `=>` will be returned directly.\nThen it wraps the component inside a table:\n```\n<tbody>\n {formItem}\n</tbody>\n```\nafter this, return the whole component inside a function called `teamTablegenerate`, then generating a table for each team is possible inside render function:\n```js\n\nObject.keys(this.state.questions).map((team) => {\n    return this.teamTablegenerate(team)\n})\n\n```\n\n![FormList](formlist.png)\n\n\n<!-- ### deploy\n### pagination\n### auth\n- only redirect in the first login  \n    - sessionstorage \n- \n\n## react-router\n### conditional rendering\n- how to go back to last path with last state\n\n## mobx\n\n## announcement\n### debounce -->\n","source":"_posts/Cloud-Based-Web-Tools-For-VIP.md","raw":"---\ntitle: Cloud Based Web Tools For VIP\ncatalog: true\ndate: 2017-11-18 21:10:56\nsubtitle:\nheader-img: \"longwood.JPG\"\ntags:\n- Cloud\n- React.js\n- Firebase\ncategories:\n- Projects\n---\n\n\n> Reactjs, Firebase, Cloud Functions, serverless architecture, material ui\n\n\nThe project that I have been working on recently is a cloud-based web tool for ASU to manage new teams, announcements, student/project application and peer evaluation. [Github link](https://github.com/HanchengZhao/VIP-web)\n\nSo it is basically a CMS(content management system), but far more lightweight than Drupal, Sharepoint or WordPress. It is still an SPA (single page application), yet a huge upgrade of my last year's peer evaluation tool for UD.\n\nIt has been a fun journey so far and I have tried many brand new things and received new experience, so it is worth recording some thoughts along the way.\n\n## Why cloud-based serverless architecture?\n\nThis is a fundamental question why we choose firebase as our backend or even infrastructure. \nFirst of all, serveless does not mean **\"no server at all\"**, it only means that end users or developers no longer need to build or maintain their own servers. Rather, they borrow microservices that are wrapped from those giant tech companies servers, like Amazon Web Service(AWS) or Google Cloud Platform. Thus, developers can focus only on the app logic or ui side, which saves so much money and time especially for startups. Those platform usually provide all kinds of services from database storage to monitoring/testing, web hosting, email/message notification and cloud functions. This 'all in one' solution is so much more handy for developers. \n\nBesides, the selling point of serverless is that **\"you only pay the compute that you need\"**. There is no waiting time for servers to start, they are just constantly running and you only account for the computing power that you need. Nowadays, people share cars, houses, now even the computing power. \nOf course serverless architecture is not a panacea, but it meets our needs so far.\n\n## Then why Firebase?\n\nSimply because it provides the exact service that we need for our app. We need a Nosql database, a secure authentication system to implement role-based access control, a storage service to save posters or team logos, an easy-to-deploy hosting service, and backend cloud functions to handle light logic, sanitize data or send emails for us. Besides, it has nice ui and easy-to-use command line tool. After being acquired by Google last summer, it has stronger back and is well integrated into google cloud platform.\n\n## Implementations\n\n### Schedule (Cron) tasks with Cloud Functions\n\nCloud functions are so powerful that they can serve as a fast-loading server to deal with database and storage. However, they are usually triggered by events, such as `onWrite` action.\n\nFirebase blog has a article explaining using App Engine from google cloud platform to do it:\n> [How to Schedule (Cron) Jobs with Cloud Functions for Firebase](https://firebase.googleblog.com/2017/03/how-to-schedule-cron-jobs-with-cloud.html)\n\nHere, we choose the site [Cron Job](https://cron-job.org/en/) to handle cron work for us. It has user-friendly interface and is easy to configure cron jobs. \n\n![cron job](cron_job.png)\n\nHere we set the cron job to run once a day to remove overdue announcement and put scheduled ones in the page. It is important to add a key parameter after the url to avoid malicious access.\n\n### Render elements iteratively in React\n\nIn React, components can be saved and passed as variables. It gives us a more flexible way to loop elements in an array, and interatively render components in the same format. Here is an example of 'formItem' component:\n\n```js\n\nlet formItem = keys.map((key) => (\n    <tr key = {key}>\n        <td><Link to={`${team}/${key}`}>{forms[key].formName}</Link></td>\n        <td>{forms[key].startDate.substr(0,15)}</td>\n        <td>{forms[key].endDate.substr(0,15)}</td>\n        <td>{forms[key].editDate.substr(0,15)}</td>\n        <td>{key === defaultId ? 'default' : <a href=\"#\" onClick = {(e) => this.setAsDefault(team, key,e) }>set as default</a>}</td>\n        <td><i className =\"glyphicon glyphicon-remove\" style = {{cursor:\"pointer\"}} id = {key} onClick = {() => this.handleRemove(team, key)}/></td>\n    </tr>\n    ));\n\n```\nIn es6, `()` after `=>` will be returned directly.\nThen it wraps the component inside a table:\n```\n<tbody>\n {formItem}\n</tbody>\n```\nafter this, return the whole component inside a function called `teamTablegenerate`, then generating a table for each team is possible inside render function:\n```js\n\nObject.keys(this.state.questions).map((team) => {\n    return this.teamTablegenerate(team)\n})\n\n```\n\n![FormList](formlist.png)\n\n\n<!-- ### deploy\n### pagination\n### auth\n- only redirect in the first login  \n    - sessionstorage \n- \n\n## react-router\n### conditional rendering\n- how to go back to last path with last state\n\n## mobx\n\n## announcement\n### debounce -->\n","slug":"Cloud-Based-Web-Tools-For-VIP","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxb0003x18lwphdkh5f","content":"<blockquote>\n<p>Reactjs, Firebase, Cloud Functions, serverless architecture, material ui</p>\n</blockquote>\n<p>The project that I have been working on recently is a cloud-based web tool for ASU to manage new teams, announcements, student/project application and peer evaluation. <a href=\"https://github.com/HanchengZhao/VIP-web\" target=\"_blank\" rel=\"noopener\">Github link</a></p>\n<p>So it is basically a CMS(content management system), but far more lightweight than Drupal, Sharepoint or WordPress. It is still an SPA (single page application), yet a huge upgrade of my last year’s peer evaluation tool for UD.</p>\n<p>It has been a fun journey so far and I have tried many brand new things and received new experience, so it is worth recording some thoughts along the way.</p>\n<h2 id=\"why-cloud-based-serverless-architecture\">Why cloud-based serverless architecture?</h2>\n<p>This is a fundamental question why we choose firebase as our backend or even infrastructure.<br>\nFirst of all, serveless does not mean <strong>“no server at all”</strong>, it only means that end users or developers no longer need to build or maintain their own servers. Rather, they borrow microservices that are wrapped from those giant tech companies servers, like Amazon Web Service(AWS) or Google Cloud Platform. Thus, developers can focus only on the app logic or ui side, which saves so much money and time especially for startups. Those platform usually provide all kinds of services from database storage to monitoring/testing, web hosting, email/message notification and cloud functions. This ‘all in one’ solution is so much more handy for developers.</p>\n<p>Besides, the selling point of serverless is that <strong>“you only pay the compute that you need”</strong>. There is no waiting time for servers to start, they are just constantly running and you only account for the computing power that you need. Nowadays, people share cars, houses, now even the computing power.<br>\nOf course serverless architecture is not a panacea, but it meets our needs so far.</p>\n<h2 id=\"then-why-firebase\">Then why Firebase?</h2>\n<p>Simply because it provides the exact service that we need for our app. We need a Nosql database, a secure authentication system to implement role-based access control, a storage service to save posters or team logos, an easy-to-deploy hosting service, and backend cloud functions to handle light logic, sanitize data or send emails for us. Besides, it has nice ui and easy-to-use command line tool. After being acquired by Google last summer, it has stronger back and is well integrated into google cloud platform.</p>\n<h2 id=\"implementations\">Implementations</h2>\n<h3 id=\"schedule-cron-tasks-with-cloud-functions\">Schedule (Cron) tasks with Cloud Functions</h3>\n<p>Cloud functions are so powerful that they can serve as a fast-loading server to deal with database and storage. However, they are usually triggered by events, such as <code>onWrite</code> action.</p>\n<p>Firebase blog has a article explaining using App Engine from google cloud platform to do it:</p>\n<blockquote>\n<p><a href=\"https://firebase.googleblog.com/2017/03/how-to-schedule-cron-jobs-with-cloud.html\" target=\"_blank\" rel=\"noopener\">How to Schedule (Cron) Jobs with Cloud Functions for Firebase</a></p>\n</blockquote>\n<p>Here, we choose the site <a href=\"https://cron-job.org/en/\" target=\"_blank\" rel=\"noopener\">Cron Job</a> to handle cron work for us. It has user-friendly interface and is easy to configure cron jobs.</p>\n<p><img src=\"cron_job.png\" alt=\"cron job\"></p>\n<p>Here we set the cron job to run once a day to remove overdue announcement and put scheduled ones in the page. It is important to add a key parameter after the url to avoid malicious access.</p>\n<h3 id=\"render-elements-iteratively-in-react\">Render elements iteratively in React</h3>\n<p>In React, components can be saved and passed as variables. It gives us a more flexible way to loop elements in an array, and interatively render components in the same format. Here is an example of ‘formItem’ component:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> formItem = keys.map(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> (</span><br><span class=\"line\">    &lt;tr key = &#123;key&#125;&gt;</span><br><span class=\"line\">        &lt;td&gt;&lt;Link to=&#123;`$&#123;team&#125;/$&#123;key&#125;`&#125;&gt;&#123;forms[key].formName&#125;&lt;/Link&gt;&lt;/td&gt;</span><br><span class=\"line\">        &lt;td&gt;&#123;forms[key].startDate.substr(<span class=\"number\">0</span>,<span class=\"number\">15</span>)&#125;&lt;<span class=\"regexp\">/td&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;td&gt;&#123;forms[key].endDate.substr(0,15)&#125;&lt;/</span>td&gt;</span><br><span class=\"line\">        &lt;td&gt;&#123;forms[key].editDate.substr(<span class=\"number\">0</span>,<span class=\"number\">15</span>)&#125;&lt;<span class=\"regexp\">/td&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;td&gt;&#123;key === defaultId ? 'default' : &lt;a href=\"#\" onClick = &#123;(e) =&gt; this.setAsDefault(team, key,e) &#125;&gt;set as default&lt;/</span>a&gt;&#125;&lt;<span class=\"regexp\">/td&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;td&gt;&lt;i className =\"glyphicon glyphicon-remove\" style = &#123;&#123;cursor:\"pointer\"&#125;&#125; id = &#123;key&#125; onClick = &#123;() =&gt; this.handleRemove(team, key)&#125;/</span>&gt;&lt;/td&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/tr&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    ));</span></span><br></pre></td></tr></table></figure>\n<p>In es6, <code>()</code> after <code>=&gt;</code> will be returned directly.<br>\nThen it wraps the component inside a table:</p>\n<figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"> </span><span class=\"template-variable\">&#123;formItem&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>after this, return the whole component inside a function called <code>teamTablegenerate</code>, then generating a table for each team is possible inside render function:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.state.questions).map(<span class=\"function\">(<span class=\"params\">team</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.teamTablegenerate(team)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><img src=\"formlist.png\" alt=\"FormList\"></p>\n<!-- ### deploy\n### pagination\n### auth\n- only redirect in the first login  \n    - sessionstorage \n- \n\n## react-router\n### conditional rendering\n- how to go back to last path with last state\n\n## mobx\n\n## announcement\n### debounce -->\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Reactjs, Firebase, Cloud Functions, serverless architecture, material ui</p>\n</blockquote>\n<p>The project that I have been working on recently is a cloud-based web tool for ASU to manage new teams, announcements, student/project application and peer evaluation. <a href=\"https://github.com/HanchengZhao/VIP-web\" target=\"_blank\" rel=\"noopener\">Github link</a></p>\n<p>So it is basically a CMS(content management system), but far more lightweight than Drupal, Sharepoint or WordPress. It is still an SPA (single page application), yet a huge upgrade of my last year’s peer evaluation tool for UD.</p>\n<p>It has been a fun journey so far and I have tried many brand new things and received new experience, so it is worth recording some thoughts along the way.</p>\n<h2>Why cloud-based serverless architecture?</h2>\n<p>This is a fundamental question why we choose firebase as our backend or even infrastructure.<br>\nFirst of all, serveless does not mean <strong>“no server at all”</strong>, it only means that end users or developers no longer need to build or maintain their own servers. Rather, they borrow microservices that are wrapped from those giant tech companies servers, like Amazon Web Service(AWS) or Google Cloud Platform. Thus, developers can focus only on the app logic or ui side, which saves so much money and time especially for startups. Those platform usually provide all kinds of services from database storage to monitoring/testing, web hosting, email/message notification and cloud functions. This ‘all in one’ solution is so much more handy for developers.</p>\n<p>Besides, the selling point of serverless is that <strong>“you only pay the compute that you need”</strong>. There is no waiting time for servers to start, they are just constantly running and you only account for the computing power that you need. Nowadays, people share cars, houses, now even the computing power.<br>\nOf course serverless architecture is not a panacea, but it meets our needs so far.</p>\n<h2>Then why Firebase?</h2>\n<p>Simply because it provides the exact service that we need for our app. We need a Nosql database, a secure authentication system to implement role-based access control, a storage service to save posters or team logos, an easy-to-deploy hosting service, and backend cloud functions to handle light logic, sanitize data or send emails for us. Besides, it has nice ui and easy-to-use command line tool. After being acquired by Google last summer, it has stronger back and is well integrated into google cloud platform.</p>\n<h2>Implementations</h2>\n<h3>Schedule (Cron) tasks with Cloud Functions</h3>\n<p>Cloud functions are so powerful that they can serve as a fast-loading server to deal with database and storage. However, they are usually triggered by events, such as <code>onWrite</code> action.</p>\n<p>Firebase blog has a article explaining using App Engine from google cloud platform to do it:</p>\n<blockquote>\n<p><a href=\"https://firebase.googleblog.com/2017/03/how-to-schedule-cron-jobs-with-cloud.html\" target=\"_blank\" rel=\"noopener\">How to Schedule (Cron) Jobs with Cloud Functions for Firebase</a></p>\n</blockquote>\n<p>Here, we choose the site <a href=\"https://cron-job.org/en/\" target=\"_blank\" rel=\"noopener\">Cron Job</a> to handle cron work for us. It has user-friendly interface and is easy to configure cron jobs.</p>\n<p><img src=\"cron_job.png\" alt=\"cron job\"></p>\n<p>Here we set the cron job to run once a day to remove overdue announcement and put scheduled ones in the page. It is important to add a key parameter after the url to avoid malicious access.</p>\n<h3>Render elements iteratively in React</h3>\n<p>In React, components can be saved and passed as variables. It gives us a more flexible way to loop elements in an array, and interatively render components in the same format. Here is an example of ‘formItem’ component:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> formItem = keys.map(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> (</span><br><span class=\"line\">    &lt;tr key = &#123;key&#125;&gt;</span><br><span class=\"line\">        &lt;td&gt;&lt;Link to=&#123;`$&#123;team&#125;/$&#123;key&#125;`&#125;&gt;&#123;forms[key].formName&#125;&lt;/Link&gt;&lt;/td&gt;</span><br><span class=\"line\">        &lt;td&gt;&#123;forms[key].startDate.substr(<span class=\"number\">0</span>,<span class=\"number\">15</span>)&#125;&lt;<span class=\"regexp\">/td&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;td&gt;&#123;forms[key].endDate.substr(0,15)&#125;&lt;/</span>td&gt;</span><br><span class=\"line\">        &lt;td&gt;&#123;forms[key].editDate.substr(<span class=\"number\">0</span>,<span class=\"number\">15</span>)&#125;&lt;<span class=\"regexp\">/td&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;td&gt;&#123;key === defaultId ? 'default' : &lt;a href=\"#\" onClick = &#123;(e) =&gt; this.setAsDefault(team, key,e) &#125;&gt;set as default&lt;/</span>a&gt;&#125;&lt;<span class=\"regexp\">/td&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;td&gt;&lt;i className =\"glyphicon glyphicon-remove\" style = &#123;&#123;cursor:\"pointer\"&#125;&#125; id = &#123;key&#125; onClick = &#123;() =&gt; this.handleRemove(team, key)&#125;/</span>&gt;&lt;/td&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/tr&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    ));</span></span><br></pre></td></tr></table></figure>\n<p>In es6, <code>()</code> after <code>=&gt;</code> will be returned directly.<br>\nThen it wraps the component inside a table:</p>\n<figure class=\"highlight dust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">tbody</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"> </span><span class=\"template-variable\">&#123;formItem&#125;</span><span class=\"xml\"></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">tbody</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>after this, return the whole component inside a function called <code>teamTablegenerate</code>, then generating a table for each team is possible inside render function:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.keys(<span class=\"keyword\">this</span>.state.questions).map(<span class=\"function\">(<span class=\"params\">team</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.teamTablegenerate(team)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><img src=\"formlist.png\" alt=\"FormList\"></p>\n<!-- ### deploy\n### pagination\n### auth\n- only redirect in the first login  \n    - sessionstorage \n- \n\n## react-router\n### conditional rendering\n- how to go back to last path with last state\n\n## mobx\n\n## announcement\n### debounce -->\n"},{"title":"一些有趣的软件名","catalog":true,"date":"2018-04-03T02:46:01.000Z","subtitle":"无厘头，不代码","header-img":"trip.JPG","_content":"\n缘起一个关于 CockroachDB 的吐槽：\n<img src=\"./trigger.png\" style=\"max-width: 50%\" alt=\"trigger\" />\n\n然后觉得这名字起得实在太好。细想了一下，程序猿确实是一个极其有才华（闷骚）的群体，在软件领域，很多取名极富内涵且有趣。\n\n### CockroachDB\n\n一个专为云服务和分布式设计的数据库, 可以存储 nosql 的数据，又支持 SQL 语言，很受关注。但是同事抱怨每次看到这个名字，心里还是发毛。细想了一下，以 cockroach(小强)作为一个分布式数据库，简直是形象地表露了好几个重要特征：\n\n- 分布式，无处不在\n- 高可用性，极其难杀死\n- 非常灵活\n\n### Java & Kotlin\n\n众所周知，Java 是以 Java 岛来命名的。JetBrains 团队在开发了十几年 IntelliJ IDEA 之后，爱恨交加，决定开发一门自己的语言，然后为了效仿 Java 一样用岛来命名，于是找到了位于圣彼得堡以西 30 公里处芬兰湾的一个科特林岛，英文就是 Kotlin，一门新的编程语言诞生了。\n\n### Google, Hadoop\n\n这两个都是生造出来的，原本并不存在。根据斯坦福教授 David Koller[回忆](https://graphics.stanford.edu/~dk/google_name_origin.html)，谷歌一开始的搜索引擎叫\"BackRub\", 因其能分析 web 的\"back links\"。后来拉里佩奇一伙人在白板上尝试想出一个与大量数据索引有关的词。有人提出了\"googolplex\"，拉里佩奇觉得缩写\"googol\"（词意大概是 10^100)更好，然后他同事 Sean Anderson 就去搜新的域名是否被注册了。但是，他在搜索的时候拼成了“google.com”，发现可以用，后来拉里佩奇觉得这名字也不错，于是注册了这个域名。\n\n这也是为什么一直以来都有人质疑 google 的名字是打错了。\n\n而 Hadoop 更无厘头，根据作者 Doug Cutting 所说，这名字就是他儿子给一个毛绒象取得，但是觉得简短，好记，从没在别的地方用过，于是就拿来用了。\n\n### kubernetes & helm\n\nKubernetes 是这两年大火的自动化部署、管理容器应用的系统，一般简称 k8s。这个名字由来应该和 Docker 本身很有关系。Docker 的 logo 是一条鲸鱼顶着一堆集装箱的图案,容器在这里被看成一个个的集装箱，相互独立隔绝。\n\n<img src=\"https://tr4.cbsistatic.com/hub/i/r/2016/10/18/831f017c-ee68-4bd6-8a5c-ab31b4d35d6d/resize/770x/1cedcf2f03388a9720835a628a8a9765/dockerhero.jpg\" style=\"max-width: 50%\" alt=\"docker\" />\n\nKubernetes 在希腊语里面是舵手的意思，英文 helmsman，象征掌管、运输着一个个集装箱，这也就是为什么我们会有`kubectl`（kubernetes control) 和 `helm`，而 logo 就是一个船的舵把。\n\n<img src=\"https://kubernetes.io/images/favicon.png\" style=\"max-width: 50%\" alt=\"kubernetes\" />\n\n### GNU’s Not Unix\n\n作为开源世界大名鼎鼎的操作系统以及项目，GNU 的命名也是很极客范，全称是 GNU 的递归形式——GNU's Not Unix, 无限自我调用展开。\n\n### Ruby & gem:\n\nRuby 就是红宝石的意思，而作为它的包管理器和命令行工具，叫 gem(宝石)也不奇怪啦。\n\n### Vue & React:\n\n这两个前端框架（也许应该叫库）的取名直接就体现了他们自己代表的特点：\n\n- Vue 是 View 的法语，诞生之初就是基于 MVVM 的思想设计，但是强调核心库专注于 view 这一层，因此库如其名。\n\n- React 也强调自己仅仅是 View 层，但是因为其强烈受函数式编程的思想，所以突出自己响应式，声明式，自然名字也是很符合了。\n\n一直不知道 Angular(有角的)取这名是为什么，难道想说明自己更迭并不平滑:)，相信从 Angular.js 到 Angular 的经历大家都能体会。\n\n### camel case\n\n驼峰命名法，其实这个名字也很形象了。因为变量命名一直是老大难，为了形象说明这个变量啥意思，经常要用好几个单词，所以一般把除掉第一个单词的首字母大写，比如 thisVariableSucks, 中间两个字母耸起，宛如驼峰，因此得名。\n\n### Android\n\n安卓就是机器人的意思，但比较有意思的是它每一个版本代号的起名，基本都是谷歌公司一种糖果的名字：\n\n| Name                                | Version                |\n| ----------------------------------- | ---------------------- |\n| Cupcake(纸杯蛋糕)                   | 1.5                    |\n| Donut(甜甜圈)                       | 1.6                    |\n| Eclair(长形松饼)                    | 2.0–2.1                |\n| Froyo(冻酸奶)                       | 2.2–2.2.3              |\n| Gingerbread(姜饼)                   | 2.3–2.3.7              |\n| Honeycomb（蜂窝）                   | 3.0–3.2.6              |\n| Ice Cream Sandwich （冰淇淋三明治） | 4.0–4.0.4              |\n| Jelly Bean （果冻豆）               | 4.1–4.3.1              |\n| KitKat（奇巧巧克力）                | 4.4–4.4.4, 4.4W–4.4W.2 |\n| Lollipop（棒棒糖）                  | 5.0–5.1.1              |\n| Marshmallow（棉花糖）               | 6.0–6.0.1              |\n| Nougat（牛轧糖）                    | 7                      |\n| Oreo（奥利奥）                      | 8                      |\n| P （据说是 Pistachio Ice Cream？）  | 9                      |\n\n当然，还有很多取名也非常有意思，比如\n\n- [Yahoo!](https://www.yahoo.com/)\n- [Python](https://www.python.org/)\n- [Postman](https://www.getpostman.com/)\n- [Prometheus](https://prometheus.io/)\n- [codepen](https://codepen.io/)\n\n因为懒，不一一赘述。\n","source":"_posts/Interesting-Software-Names.md","raw":"---\ntitle: 一些有趣的软件名\ncatalog: true\ndate: 2018-04-02 22:46:01\nsubtitle: 无厘头，不代码\nheader-img: \"trip.JPG\"\ntags:\n  - CockroachDB\n  - Google\n  - Kubernetes\n  - Docker\n  - React.js\n---\n\n缘起一个关于 CockroachDB 的吐槽：\n<img src=\"./trigger.png\" style=\"max-width: 50%\" alt=\"trigger\" />\n\n然后觉得这名字起得实在太好。细想了一下，程序猿确实是一个极其有才华（闷骚）的群体，在软件领域，很多取名极富内涵且有趣。\n\n### CockroachDB\n\n一个专为云服务和分布式设计的数据库, 可以存储 nosql 的数据，又支持 SQL 语言，很受关注。但是同事抱怨每次看到这个名字，心里还是发毛。细想了一下，以 cockroach(小强)作为一个分布式数据库，简直是形象地表露了好几个重要特征：\n\n- 分布式，无处不在\n- 高可用性，极其难杀死\n- 非常灵活\n\n### Java & Kotlin\n\n众所周知，Java 是以 Java 岛来命名的。JetBrains 团队在开发了十几年 IntelliJ IDEA 之后，爱恨交加，决定开发一门自己的语言，然后为了效仿 Java 一样用岛来命名，于是找到了位于圣彼得堡以西 30 公里处芬兰湾的一个科特林岛，英文就是 Kotlin，一门新的编程语言诞生了。\n\n### Google, Hadoop\n\n这两个都是生造出来的，原本并不存在。根据斯坦福教授 David Koller[回忆](https://graphics.stanford.edu/~dk/google_name_origin.html)，谷歌一开始的搜索引擎叫\"BackRub\", 因其能分析 web 的\"back links\"。后来拉里佩奇一伙人在白板上尝试想出一个与大量数据索引有关的词。有人提出了\"googolplex\"，拉里佩奇觉得缩写\"googol\"（词意大概是 10^100)更好，然后他同事 Sean Anderson 就去搜新的域名是否被注册了。但是，他在搜索的时候拼成了“google.com”，发现可以用，后来拉里佩奇觉得这名字也不错，于是注册了这个域名。\n\n这也是为什么一直以来都有人质疑 google 的名字是打错了。\n\n而 Hadoop 更无厘头，根据作者 Doug Cutting 所说，这名字就是他儿子给一个毛绒象取得，但是觉得简短，好记，从没在别的地方用过，于是就拿来用了。\n\n### kubernetes & helm\n\nKubernetes 是这两年大火的自动化部署、管理容器应用的系统，一般简称 k8s。这个名字由来应该和 Docker 本身很有关系。Docker 的 logo 是一条鲸鱼顶着一堆集装箱的图案,容器在这里被看成一个个的集装箱，相互独立隔绝。\n\n<img src=\"https://tr4.cbsistatic.com/hub/i/r/2016/10/18/831f017c-ee68-4bd6-8a5c-ab31b4d35d6d/resize/770x/1cedcf2f03388a9720835a628a8a9765/dockerhero.jpg\" style=\"max-width: 50%\" alt=\"docker\" />\n\nKubernetes 在希腊语里面是舵手的意思，英文 helmsman，象征掌管、运输着一个个集装箱，这也就是为什么我们会有`kubectl`（kubernetes control) 和 `helm`，而 logo 就是一个船的舵把。\n\n<img src=\"https://kubernetes.io/images/favicon.png\" style=\"max-width: 50%\" alt=\"kubernetes\" />\n\n### GNU’s Not Unix\n\n作为开源世界大名鼎鼎的操作系统以及项目，GNU 的命名也是很极客范，全称是 GNU 的递归形式——GNU's Not Unix, 无限自我调用展开。\n\n### Ruby & gem:\n\nRuby 就是红宝石的意思，而作为它的包管理器和命令行工具，叫 gem(宝石)也不奇怪啦。\n\n### Vue & React:\n\n这两个前端框架（也许应该叫库）的取名直接就体现了他们自己代表的特点：\n\n- Vue 是 View 的法语，诞生之初就是基于 MVVM 的思想设计，但是强调核心库专注于 view 这一层，因此库如其名。\n\n- React 也强调自己仅仅是 View 层，但是因为其强烈受函数式编程的思想，所以突出自己响应式，声明式，自然名字也是很符合了。\n\n一直不知道 Angular(有角的)取这名是为什么，难道想说明自己更迭并不平滑:)，相信从 Angular.js 到 Angular 的经历大家都能体会。\n\n### camel case\n\n驼峰命名法，其实这个名字也很形象了。因为变量命名一直是老大难，为了形象说明这个变量啥意思，经常要用好几个单词，所以一般把除掉第一个单词的首字母大写，比如 thisVariableSucks, 中间两个字母耸起，宛如驼峰，因此得名。\n\n### Android\n\n安卓就是机器人的意思，但比较有意思的是它每一个版本代号的起名，基本都是谷歌公司一种糖果的名字：\n\n| Name                                | Version                |\n| ----------------------------------- | ---------------------- |\n| Cupcake(纸杯蛋糕)                   | 1.5                    |\n| Donut(甜甜圈)                       | 1.6                    |\n| Eclair(长形松饼)                    | 2.0–2.1                |\n| Froyo(冻酸奶)                       | 2.2–2.2.3              |\n| Gingerbread(姜饼)                   | 2.3–2.3.7              |\n| Honeycomb（蜂窝）                   | 3.0–3.2.6              |\n| Ice Cream Sandwich （冰淇淋三明治） | 4.0–4.0.4              |\n| Jelly Bean （果冻豆）               | 4.1–4.3.1              |\n| KitKat（奇巧巧克力）                | 4.4–4.4.4, 4.4W–4.4W.2 |\n| Lollipop（棒棒糖）                  | 5.0–5.1.1              |\n| Marshmallow（棉花糖）               | 6.0–6.0.1              |\n| Nougat（牛轧糖）                    | 7                      |\n| Oreo（奥利奥）                      | 8                      |\n| P （据说是 Pistachio Ice Cream？）  | 9                      |\n\n当然，还有很多取名也非常有意思，比如\n\n- [Yahoo!](https://www.yahoo.com/)\n- [Python](https://www.python.org/)\n- [Postman](https://www.getpostman.com/)\n- [Prometheus](https://prometheus.io/)\n- [codepen](https://codepen.io/)\n\n因为懒，不一一赘述。\n","slug":"Interesting-Software-Names","published":1,"updated":"2019-08-17T01:54:29.794Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxd0005x18l8ztycm94","content":"<p>缘起一个关于 CockroachDB 的吐槽：<br>\n<img src=\"./trigger.png\" style=\"max-width: 50%\" alt=\"trigger\"></p>\n<p>然后觉得这名字起得实在太好。细想了一下，程序猿确实是一个极其有才华（闷骚）的群体，在软件领域，很多取名极富内涵且有趣。</p>\n<h3 id=\"cockroachdb\">CockroachDB</h3>\n<p>一个专为云服务和分布式设计的数据库, 可以存储 nosql 的数据，又支持 SQL 语言，很受关注。但是同事抱怨每次看到这个名字，心里还是发毛。细想了一下，以 cockroach(小强)作为一个分布式数据库，简直是形象地表露了好几个重要特征：</p>\n<ul>\n<li>分布式，无处不在</li>\n<li>高可用性，极其难杀死</li>\n<li>非常灵活</li>\n</ul>\n<h3 id=\"java-amp-kotlin\">Java &amp; Kotlin</h3>\n<p>众所周知，Java 是以 Java 岛来命名的。JetBrains 团队在开发了十几年 IntelliJ IDEA 之后，爱恨交加，决定开发一门自己的语言，然后为了效仿 Java 一样用岛来命名，于是找到了位于圣彼得堡以西 30 公里处芬兰湾的一个科特林岛，英文就是 Kotlin，一门新的编程语言诞生了。</p>\n<h3 id=\"google-hadoop\">Google, Hadoop</h3>\n<p>这两个都是生造出来的，原本并不存在。根据斯坦福教授 David Koller<a href=\"https://graphics.stanford.edu/~dk/google_name_origin.html\" target=\"_blank\" rel=\"noopener\">回忆</a>，谷歌一开始的搜索引擎叫&quot;BackRub&quot;, 因其能分析 web 的&quot;back links&quot;。后来拉里佩奇一伙人在白板上尝试想出一个与大量数据索引有关的词。有人提出了&quot;googolplex&quot;，拉里佩奇觉得缩写&quot;googol&quot;（词意大概是 10^100)更好，然后他同事 Sean Anderson 就去搜新的域名是否被注册了。但是，他在搜索的时候拼成了“<a href=\"http://google.com\" target=\"_blank\" rel=\"noopener\">google.com</a>”，发现可以用，后来拉里佩奇觉得这名字也不错，于是注册了这个域名。</p>\n<p>这也是为什么一直以来都有人质疑 google 的名字是打错了。</p>\n<p>而 Hadoop 更无厘头，根据作者 Doug Cutting 所说，这名字就是他儿子给一个毛绒象取得，但是觉得简短，好记，从没在别的地方用过，于是就拿来用了。</p>\n<h3 id=\"kubernetes-amp-helm\">kubernetes &amp; helm</h3>\n<p>Kubernetes 是这两年大火的自动化部署、管理容器应用的系统，一般简称 k8s。这个名字由来应该和 Docker 本身很有关系。Docker 的 logo 是一条鲸鱼顶着一堆集装箱的图案,容器在这里被看成一个个的集装箱，相互独立隔绝。</p>\n<img src=\"https://tr4.cbsistatic.com/hub/i/r/2016/10/18/831f017c-ee68-4bd6-8a5c-ab31b4d35d6d/resize/770x/1cedcf2f03388a9720835a628a8a9765/dockerhero.jpg\" style=\"max-width: 50%\" alt=\"docker\">\n<p>Kubernetes 在希腊语里面是舵手的意思，英文 helmsman，象征掌管、运输着一个个集装箱，这也就是为什么我们会有<code>kubectl</code>（kubernetes control) 和 <code>helm</code>，而 logo 就是一个船的舵把。</p>\n<img src=\"https://kubernetes.io/images/favicon.png\" style=\"max-width: 50%\" alt=\"kubernetes\">\n<h3 id=\"gnus-not-unix\">GNU’s Not Unix</h3>\n<p>作为开源世界大名鼎鼎的操作系统以及项目，GNU 的命名也是很极客范，全称是 GNU 的递归形式——GNU’s Not Unix, 无限自我调用展开。</p>\n<h3 id=\"ruby-amp-gem\">Ruby &amp; gem:</h3>\n<p>Ruby 就是红宝石的意思，而作为它的包管理器和命令行工具，叫 gem(宝石)也不奇怪啦。</p>\n<h3 id=\"vue-amp-react\">Vue &amp; React:</h3>\n<p>这两个前端框架（也许应该叫库）的取名直接就体现了他们自己代表的特点：</p>\n<ul>\n<li>\n<p>Vue 是 View 的法语，诞生之初就是基于 MVVM 的思想设计，但是强调核心库专注于 view 这一层，因此库如其名。</p>\n</li>\n<li>\n<p>React 也强调自己仅仅是 View 层，但是因为其强烈受函数式编程的思想，所以突出自己响应式，声明式，自然名字也是很符合了。</p>\n</li>\n</ul>\n<p>一直不知道 Angular(有角的)取这名是为什么，难道想说明自己更迭并不平滑:)，相信从 Angular.js 到 Angular 的经历大家都能体会。</p>\n<h3 id=\"camel-case\">camel case</h3>\n<p>驼峰命名法，其实这个名字也很形象了。因为变量命名一直是老大难，为了形象说明这个变量啥意思，经常要用好几个单词，所以一般把除掉第一个单词的首字母大写，比如 thisVariableSucks, 中间两个字母耸起，宛如驼峰，因此得名。</p>\n<h3 id=\"android\">Android</h3>\n<p>安卓就是机器人的意思，但比较有意思的是它每一个版本代号的起名，基本都是谷歌公司一种糖果的名字：</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cupcake(纸杯蛋糕)</td>\n<td>1.5</td>\n</tr>\n<tr>\n<td>Donut(甜甜圈)</td>\n<td>1.6</td>\n</tr>\n<tr>\n<td>Eclair(长形松饼)</td>\n<td>2.0–2.1</td>\n</tr>\n<tr>\n<td>Froyo(冻酸奶)</td>\n<td>2.2–2.2.3</td>\n</tr>\n<tr>\n<td>Gingerbread(姜饼)</td>\n<td>2.3–2.3.7</td>\n</tr>\n<tr>\n<td>Honeycomb（蜂窝）</td>\n<td>3.0–3.2.6</td>\n</tr>\n<tr>\n<td>Ice Cream Sandwich （冰淇淋三明治）</td>\n<td>4.0–4.0.4</td>\n</tr>\n<tr>\n<td>Jelly Bean （果冻豆）</td>\n<td>4.1–4.3.1</td>\n</tr>\n<tr>\n<td>KitKat（奇巧巧克力）</td>\n<td>4.4–4.4.4, 4.4W–4.4W.2</td>\n</tr>\n<tr>\n<td>Lollipop（棒棒糖）</td>\n<td>5.0–5.1.1</td>\n</tr>\n<tr>\n<td>Marshmallow（棉花糖）</td>\n<td>6.0–6.0.1</td>\n</tr>\n<tr>\n<td>Nougat（牛轧糖）</td>\n<td>7</td>\n</tr>\n<tr>\n<td>Oreo（奥利奥）</td>\n<td>8</td>\n</tr>\n<tr>\n<td>P （据说是 Pistachio Ice Cream？）</td>\n<td>9</td>\n</tr>\n</tbody>\n</table>\n<p>当然，还有很多取名也非常有意思，比如</p>\n<ul>\n<li><a href=\"https://www.yahoo.com/\" target=\"_blank\" rel=\"noopener\">Yahoo!</a></li>\n<li><a href=\"https://www.python.org/\" target=\"_blank\" rel=\"noopener\">Python</a></li>\n<li><a href=\"https://www.getpostman.com/\" target=\"_blank\" rel=\"noopener\">Postman</a></li>\n<li><a href=\"https://prometheus.io/\" target=\"_blank\" rel=\"noopener\">Prometheus</a></li>\n<li><a href=\"https://codepen.io/\" target=\"_blank\" rel=\"noopener\">codepen</a></li>\n</ul>\n<p>因为懒，不一一赘述。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>缘起一个关于 CockroachDB 的吐槽：<br>\n<img src=\"./trigger.png\" style=\"max-width: 50%\" alt=\"trigger\"></p>\n<p>然后觉得这名字起得实在太好。细想了一下，程序猿确实是一个极其有才华（闷骚）的群体，在软件领域，很多取名极富内涵且有趣。</p>\n<h3>CockroachDB</h3>\n<p>一个专为云服务和分布式设计的数据库, 可以存储 nosql 的数据，又支持 SQL 语言，很受关注。但是同事抱怨每次看到这个名字，心里还是发毛。细想了一下，以 cockroach(小强)作为一个分布式数据库，简直是形象地表露了好几个重要特征：</p>\n<ul>\n<li>分布式，无处不在</li>\n<li>高可用性，极其难杀死</li>\n<li>非常灵活</li>\n</ul>\n<h3>Java &amp; Kotlin</h3>\n<p>众所周知，Java 是以 Java 岛来命名的。JetBrains 团队在开发了十几年 IntelliJ IDEA 之后，爱恨交加，决定开发一门自己的语言，然后为了效仿 Java 一样用岛来命名，于是找到了位于圣彼得堡以西 30 公里处芬兰湾的一个科特林岛，英文就是 Kotlin，一门新的编程语言诞生了。</p>\n<h3>Google, Hadoop</h3>\n<p>这两个都是生造出来的，原本并不存在。根据斯坦福教授 David Koller<a href=\"https://graphics.stanford.edu/~dk/google_name_origin.html\" target=\"_blank\" rel=\"noopener\">回忆</a>，谷歌一开始的搜索引擎叫&quot;BackRub&quot;, 因其能分析 web 的&quot;back links&quot;。后来拉里佩奇一伙人在白板上尝试想出一个与大量数据索引有关的词。有人提出了&quot;googolplex&quot;，拉里佩奇觉得缩写&quot;googol&quot;（词意大概是 10^100)更好，然后他同事 Sean Anderson 就去搜新的域名是否被注册了。但是，他在搜索的时候拼成了“<a href=\"http://google.com\" target=\"_blank\" rel=\"noopener\">google.com</a>”，发现可以用，后来拉里佩奇觉得这名字也不错，于是注册了这个域名。</p>\n<p>这也是为什么一直以来都有人质疑 google 的名字是打错了。</p>\n<p>而 Hadoop 更无厘头，根据作者 Doug Cutting 所说，这名字就是他儿子给一个毛绒象取得，但是觉得简短，好记，从没在别的地方用过，于是就拿来用了。</p>\n<h3>kubernetes &amp; helm</h3>\n<p>Kubernetes 是这两年大火的自动化部署、管理容器应用的系统，一般简称 k8s。这个名字由来应该和 Docker 本身很有关系。Docker 的 logo 是一条鲸鱼顶着一堆集装箱的图案,容器在这里被看成一个个的集装箱，相互独立隔绝。</p>\n<img src=\"https://tr4.cbsistatic.com/hub/i/r/2016/10/18/831f017c-ee68-4bd6-8a5c-ab31b4d35d6d/resize/770x/1cedcf2f03388a9720835a628a8a9765/dockerhero.jpg\" style=\"max-width: 50%\" alt=\"docker\">\n<p>Kubernetes 在希腊语里面是舵手的意思，英文 helmsman，象征掌管、运输着一个个集装箱，这也就是为什么我们会有<code>kubectl</code>（kubernetes control) 和 <code>helm</code>，而 logo 就是一个船的舵把。</p>\n<img src=\"https://kubernetes.io/images/favicon.png\" style=\"max-width: 50%\" alt=\"kubernetes\">\n<h3>GNU’s Not Unix</h3>\n<p>作为开源世界大名鼎鼎的操作系统以及项目，GNU 的命名也是很极客范，全称是 GNU 的递归形式——GNU’s Not Unix, 无限自我调用展开。</p>\n<h3>Ruby &amp; gem:</h3>\n<p>Ruby 就是红宝石的意思，而作为它的包管理器和命令行工具，叫 gem(宝石)也不奇怪啦。</p>\n<h3>Vue &amp; React:</h3>\n<p>这两个前端框架（也许应该叫库）的取名直接就体现了他们自己代表的特点：</p>\n<ul>\n<li>\n<p>Vue 是 View 的法语，诞生之初就是基于 MVVM 的思想设计，但是强调核心库专注于 view 这一层，因此库如其名。</p>\n</li>\n<li>\n<p>React 也强调自己仅仅是 View 层，但是因为其强烈受函数式编程的思想，所以突出自己响应式，声明式，自然名字也是很符合了。</p>\n</li>\n</ul>\n<p>一直不知道 Angular(有角的)取这名是为什么，难道想说明自己更迭并不平滑:)，相信从 Angular.js 到 Angular 的经历大家都能体会。</p>\n<h3>camel case</h3>\n<p>驼峰命名法，其实这个名字也很形象了。因为变量命名一直是老大难，为了形象说明这个变量啥意思，经常要用好几个单词，所以一般把除掉第一个单词的首字母大写，比如 thisVariableSucks, 中间两个字母耸起，宛如驼峰，因此得名。</p>\n<h3>Android</h3>\n<p>安卓就是机器人的意思，但比较有意思的是它每一个版本代号的起名，基本都是谷歌公司一种糖果的名字：</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Cupcake(纸杯蛋糕)</td>\n<td>1.5</td>\n</tr>\n<tr>\n<td>Donut(甜甜圈)</td>\n<td>1.6</td>\n</tr>\n<tr>\n<td>Eclair(长形松饼)</td>\n<td>2.0–2.1</td>\n</tr>\n<tr>\n<td>Froyo(冻酸奶)</td>\n<td>2.2–2.2.3</td>\n</tr>\n<tr>\n<td>Gingerbread(姜饼)</td>\n<td>2.3–2.3.7</td>\n</tr>\n<tr>\n<td>Honeycomb（蜂窝）</td>\n<td>3.0–3.2.6</td>\n</tr>\n<tr>\n<td>Ice Cream Sandwich （冰淇淋三明治）</td>\n<td>4.0–4.0.4</td>\n</tr>\n<tr>\n<td>Jelly Bean （果冻豆）</td>\n<td>4.1–4.3.1</td>\n</tr>\n<tr>\n<td>KitKat（奇巧巧克力）</td>\n<td>4.4–4.4.4, 4.4W–4.4W.2</td>\n</tr>\n<tr>\n<td>Lollipop（棒棒糖）</td>\n<td>5.0–5.1.1</td>\n</tr>\n<tr>\n<td>Marshmallow（棉花糖）</td>\n<td>6.0–6.0.1</td>\n</tr>\n<tr>\n<td>Nougat（牛轧糖）</td>\n<td>7</td>\n</tr>\n<tr>\n<td>Oreo（奥利奥）</td>\n<td>8</td>\n</tr>\n<tr>\n<td>P （据说是 Pistachio Ice Cream？）</td>\n<td>9</td>\n</tr>\n</tbody>\n</table>\n<p>当然，还有很多取名也非常有意思，比如</p>\n<ul>\n<li><a href=\"https://www.yahoo.com/\" target=\"_blank\" rel=\"noopener\">Yahoo!</a></li>\n<li><a href=\"https://www.python.org/\" target=\"_blank\" rel=\"noopener\">Python</a></li>\n<li><a href=\"https://www.getpostman.com/\" target=\"_blank\" rel=\"noopener\">Postman</a></li>\n<li><a href=\"https://prometheus.io/\" target=\"_blank\" rel=\"noopener\">Prometheus</a></li>\n<li><a href=\"https://codepen.io/\" target=\"_blank\" rel=\"noopener\">codepen</a></li>\n</ul>\n<p>因为懒，不一一赘述。</p>\n"},{"title":"JavaScript-Flaws","catalog":true,"date":"2017-02-08T01:49:46.000Z","subtitle":"The bad parts","header-img":"centralPark.jpg","_content":"\n\n> Javascript design flaws and wired parts\n\n### JavaScript flaws\n\nJavaScript is the most dominant programming language for the web. Powerful as it is, JavaScript has many design flaws that may cause confusions for both newbie and seasoned developers . So it's worth making a summary here.\n\n### Data type and variables\n\n* `NaN` can not be compared with any number, like ` NaN === NaN; // false`, the only way to check is by using `isNaN()`: \n\n```js \nisNaN(NaN); // true \n```\n\n* `null` and `undefined`: The undefined value is a primitive value used when a variable has not been assigned a value. The null value is a primitive value that represents the null, empty, or non-existent reference.\n\n* If a variable is defined without `var`, it is set to be a global variable, which may cause some errors that are hard to debug. This problem can be solved by adding `'use strict';` in the first line\n\n\n### Strings\nStrings are imutable, like\n```js\nvar s = 'Test';\ns[0] = 'X';     \nalert(s); // s is still 'Test'    \n```\n\n\n### in operator\n\n**in** can only be used to check whether a prop is in an object like:\n\n```js\n// Arrays\nvar trees = ['redwood', 'bay', 'cedar', 'oak', 'maple'];\n0 in trees        // returns true\n3 in trees        // returns true\n6 in trees        // returns false\n'bay' in trees    // returns false (you must specify the \n                  // index number, not the value at that index)\n'length' in trees // returns true (length is an Array property)\nSymbol.iterator in trees // returns true (arrays are iterable, works only in ES2015+)\n\n// Predefined objects\n'PI' in Math          // returns true\n\n// Custom objects\nvar mycar = {make: 'Honda', model: 'Accord', year: 1998};\n'make' in mycar  // returns true   \n```\nIt has different function than 'in' in Python, whether **in** can be used to check element existence.\n\n### Conditions\nJavaScript uses `if () { ... } else { ... }` to set conditions. But if there is only one statement in a block, `{}` can be removed. like\n```js\nvar age = 20;\nif (age >= 18)\n    alert('adult');\nelse\n    alert('teenager');\n```\nHowever, there are risks doing this:\n```js\nvar age = 20;\nif (age >= 18)\n    alert('adult');\nelse\n    console.log('age < 18');\n    alert('teenager'); // this line is actually not inside else\n```\nSo it is better to always include `{}`\n\n### Loops\n\n- \"foreach\" vs \"for of\" vs \"for in\"\n    - `foreach` is an method that is available only in Array objects. It allows you to iterate through elements of an array. When invoked it takes a callback function and invokes the callback once for every array element. The callback can access both index and value of the array elements. foreach is available only for looping arrays.\n    -  `for of` is a new way for iterating collections. Its introduced in ES6. Earlier you had to use for or while loop to iterate through elements of an collection. For for of to work on an collection, the collection must have an [Symbol.iterator] property.\n    - `for in` is used to loop through properties of an object. It can be any object. for in allows you to access the keys of the object but doesn’t provide reference to the values. In JavaScript object properties themselves have internal properties. One of the internal properties is [[Enumerable]]. for in will only walkthrough a property if it has [[Enumerbale]] set to true. It not used to iterate elements of an collection rather used to iterate properties of objects. For example:\n        ```js\n        var a = ['A', 'B', 'C'];\n        for (var i in a) {\n            alert(i); // '0', '1', '2'\n            alert(a[i]); // 'A', 'B', 'C'\n        }\n        \n        ```\n\n### Map and Set\nIn JavaScript, Map can be inplemented with Object`{}`, buy the key has to be a string. So ES6 introduced a new type `Map`.\n[Map Reference](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map)\n\n\n### Objects\nThe property name has to be a valid name in order to let `Objects.property` to access. For example,\n```js\nvar me = {\n    name: 'henry'\n    \"university\": \"UD\"\n}\n```\n`\"university\"` is not a valid property name here, so it has to be accessed by\n`me['university']`. But name can be accessed by `me.name`\n\n- \"this\" key word:\n    The this object is bound at runtime based on the context in which a function is executed:\n    - when used inside global functions,this is equal to window in nostrict mode and undefinedin strict mode.\n    - whereas this is equal to the object when called as an object method.\n    - as a constructor\n    - call and apply\n    - bound functions\n    - as dom event handler\n\nthis will point to global object:\n```js\nfunction a() {\n    console.log(this);\n    this.newvariable = 'hello';\n}\n\nvar b = function() {\n    console.log(this);   \n}\n\na();\nconsole.log(newvariable);\n```\nWhen a global function is called, `this`will point to the window. Likewise, 'this' inside a function which is inside another function will be attached to the global object. \n\nIn order to solve this problem, \"self\" or \"that\" is introduced:\n```js\nvar c = {\n    name: 'The c object',\n    log: function() {\n        var self = this;\n        \n        self.name = 'Updated c object';\n        console.log(self);\n        \n        var setname = function(newname) {\n            self.name = newname;   \n        }\n        setname('Updated again! The c object');\n        console.log(self);\n    }\n}\n\nc.log();\n```\nSelf points to the object c. When ‘setname’ is called, the js will look at the scope chain and find c.\n\n\n\n","source":"_posts/JavaScript-Flaws.md","raw":"---\ntitle: JavaScript-Flaws\ncatalog: true\ndate: 2017-2-7 20:49:46\nsubtitle: The bad parts\nheader-img: \"centralPark.jpg\"\ntags:\n- JavaScript\n---\n\n\n> Javascript design flaws and wired parts\n\n### JavaScript flaws\n\nJavaScript is the most dominant programming language for the web. Powerful as it is, JavaScript has many design flaws that may cause confusions for both newbie and seasoned developers . So it's worth making a summary here.\n\n### Data type and variables\n\n* `NaN` can not be compared with any number, like ` NaN === NaN; // false`, the only way to check is by using `isNaN()`: \n\n```js \nisNaN(NaN); // true \n```\n\n* `null` and `undefined`: The undefined value is a primitive value used when a variable has not been assigned a value. The null value is a primitive value that represents the null, empty, or non-existent reference.\n\n* If a variable is defined without `var`, it is set to be a global variable, which may cause some errors that are hard to debug. This problem can be solved by adding `'use strict';` in the first line\n\n\n### Strings\nStrings are imutable, like\n```js\nvar s = 'Test';\ns[0] = 'X';     \nalert(s); // s is still 'Test'    \n```\n\n\n### in operator\n\n**in** can only be used to check whether a prop is in an object like:\n\n```js\n// Arrays\nvar trees = ['redwood', 'bay', 'cedar', 'oak', 'maple'];\n0 in trees        // returns true\n3 in trees        // returns true\n6 in trees        // returns false\n'bay' in trees    // returns false (you must specify the \n                  // index number, not the value at that index)\n'length' in trees // returns true (length is an Array property)\nSymbol.iterator in trees // returns true (arrays are iterable, works only in ES2015+)\n\n// Predefined objects\n'PI' in Math          // returns true\n\n// Custom objects\nvar mycar = {make: 'Honda', model: 'Accord', year: 1998};\n'make' in mycar  // returns true   \n```\nIt has different function than 'in' in Python, whether **in** can be used to check element existence.\n\n### Conditions\nJavaScript uses `if () { ... } else { ... }` to set conditions. But if there is only one statement in a block, `{}` can be removed. like\n```js\nvar age = 20;\nif (age >= 18)\n    alert('adult');\nelse\n    alert('teenager');\n```\nHowever, there are risks doing this:\n```js\nvar age = 20;\nif (age >= 18)\n    alert('adult');\nelse\n    console.log('age < 18');\n    alert('teenager'); // this line is actually not inside else\n```\nSo it is better to always include `{}`\n\n### Loops\n\n- \"foreach\" vs \"for of\" vs \"for in\"\n    - `foreach` is an method that is available only in Array objects. It allows you to iterate through elements of an array. When invoked it takes a callback function and invokes the callback once for every array element. The callback can access both index and value of the array elements. foreach is available only for looping arrays.\n    -  `for of` is a new way for iterating collections. Its introduced in ES6. Earlier you had to use for or while loop to iterate through elements of an collection. For for of to work on an collection, the collection must have an [Symbol.iterator] property.\n    - `for in` is used to loop through properties of an object. It can be any object. for in allows you to access the keys of the object but doesn’t provide reference to the values. In JavaScript object properties themselves have internal properties. One of the internal properties is [[Enumerable]]. for in will only walkthrough a property if it has [[Enumerbale]] set to true. It not used to iterate elements of an collection rather used to iterate properties of objects. For example:\n        ```js\n        var a = ['A', 'B', 'C'];\n        for (var i in a) {\n            alert(i); // '0', '1', '2'\n            alert(a[i]); // 'A', 'B', 'C'\n        }\n        \n        ```\n\n### Map and Set\nIn JavaScript, Map can be inplemented with Object`{}`, buy the key has to be a string. So ES6 introduced a new type `Map`.\n[Map Reference](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map)\n\n\n### Objects\nThe property name has to be a valid name in order to let `Objects.property` to access. For example,\n```js\nvar me = {\n    name: 'henry'\n    \"university\": \"UD\"\n}\n```\n`\"university\"` is not a valid property name here, so it has to be accessed by\n`me['university']`. But name can be accessed by `me.name`\n\n- \"this\" key word:\n    The this object is bound at runtime based on the context in which a function is executed:\n    - when used inside global functions,this is equal to window in nostrict mode and undefinedin strict mode.\n    - whereas this is equal to the object when called as an object method.\n    - as a constructor\n    - call and apply\n    - bound functions\n    - as dom event handler\n\nthis will point to global object:\n```js\nfunction a() {\n    console.log(this);\n    this.newvariable = 'hello';\n}\n\nvar b = function() {\n    console.log(this);   \n}\n\na();\nconsole.log(newvariable);\n```\nWhen a global function is called, `this`will point to the window. Likewise, 'this' inside a function which is inside another function will be attached to the global object. \n\nIn order to solve this problem, \"self\" or \"that\" is introduced:\n```js\nvar c = {\n    name: 'The c object',\n    log: function() {\n        var self = this;\n        \n        self.name = 'Updated c object';\n        console.log(self);\n        \n        var setname = function(newname) {\n            self.name = newname;   \n        }\n        setname('Updated again! The c object');\n        console.log(self);\n    }\n}\n\nc.log();\n```\nSelf points to the object c. When ‘setname’ is called, the js will look at the scope chain and find c.\n\n\n\n","slug":"JavaScript-Flaws","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxn0009x18lp39rdjhl","content":"<blockquote>\n<p>Javascript design flaws and wired parts</p>\n</blockquote>\n<h3 id=\"javascript-flaws\">JavaScript flaws</h3>\n<p>JavaScript is the most dominant programming language for the web. Powerful as it is, JavaScript has many design flaws that may cause confusions for both newbie and seasoned developers . So it’s worth making a summary here.</p>\n<h3 id=\"data-type-and-variables\">Data type and variables</h3>\n<ul>\n<li><code>NaN</code> can not be compared with any number, like <code>NaN === NaN; // false</code>, the only way to check is by using <code>isNaN()</code>:</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">isNaN</span>(<span class=\"literal\">NaN</span>); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p><code>null</code> and <code>undefined</code>: The undefined value is a primitive value used when a variable has not been assigned a value. The null value is a primitive value that represents the null, empty, or non-existent reference.</p>\n</li>\n<li>\n<p>If a variable is defined without <code>var</code>, it is set to be a global variable, which may cause some errors that are hard to debug. This problem can be solved by adding <code>'use strict';</code> in the first line</p>\n</li>\n</ul>\n<h3 id=\"strings\">Strings</h3>\n<p>Strings are imutable, like</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> s = <span class=\"string\">'Test'</span>;</span><br><span class=\"line\">s[<span class=\"number\">0</span>] = <span class=\"string\">'X'</span>;     </span><br><span class=\"line\">alert(s); <span class=\"comment\">// s is still 'Test'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"in-operator\">in operator</h3>\n<p><strong>in</strong> can only be used to check whether a prop is in an object like:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Arrays</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> trees = [<span class=\"string\">'redwood'</span>, <span class=\"string\">'bay'</span>, <span class=\"string\">'cedar'</span>, <span class=\"string\">'oak'</span>, <span class=\"string\">'maple'</span>];</span><br><span class=\"line\"><span class=\"number\">0</span> <span class=\"keyword\">in</span> trees        <span class=\"comment\">// returns true</span></span><br><span class=\"line\"><span class=\"number\">3</span> <span class=\"keyword\">in</span> trees        <span class=\"comment\">// returns true</span></span><br><span class=\"line\"><span class=\"number\">6</span> <span class=\"keyword\">in</span> trees        <span class=\"comment\">// returns false</span></span><br><span class=\"line\"><span class=\"string\">'bay'</span> <span class=\"keyword\">in</span> trees    <span class=\"comment\">// returns false (you must specify the </span></span><br><span class=\"line\">                  <span class=\"comment\">// index number, not the value at that index)</span></span><br><span class=\"line\"><span class=\"string\">'length'</span> <span class=\"keyword\">in</span> trees <span class=\"comment\">// returns true (length is an Array property)</span></span><br><span class=\"line\"><span class=\"built_in\">Symbol</span>.iterator <span class=\"keyword\">in</span> trees <span class=\"comment\">// returns true (arrays are iterable, works only in ES2015+)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Predefined objects</span></span><br><span class=\"line\"><span class=\"string\">'PI'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">Math</span>          <span class=\"comment\">// returns true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Custom objects</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> mycar = &#123;<span class=\"attr\">make</span>: <span class=\"string\">'Honda'</span>, <span class=\"attr\">model</span>: <span class=\"string\">'Accord'</span>, <span class=\"attr\">year</span>: <span class=\"number\">1998</span>&#125;;</span><br><span class=\"line\"><span class=\"string\">'make'</span> <span class=\"keyword\">in</span> mycar  <span class=\"comment\">// returns true</span></span><br></pre></td></tr></table></figure>\n<p>It has different function than ‘in’ in Python, whether <strong>in</strong> can be used to check element existence.</p>\n<h3 id=\"conditions\">Conditions</h3>\n<p>JavaScript uses <code>if () { ... } else { ... }</code> to set conditions. But if there is only one statement in a block, <code>{}</code> can be removed. like</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (age &gt;= <span class=\"number\">18</span>)</span><br><span class=\"line\">    alert(<span class=\"string\">'adult'</span>);</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    alert(<span class=\"string\">'teenager'</span>);</span><br></pre></td></tr></table></figure>\n<p>However, there are risks doing this:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (age &gt;= <span class=\"number\">18</span>)</span><br><span class=\"line\">    alert(<span class=\"string\">'adult'</span>);</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'age &lt; 18'</span>);</span><br><span class=\"line\">    alert(<span class=\"string\">'teenager'</span>); <span class=\"comment\">// this line is actually not inside else</span></span><br></pre></td></tr></table></figure>\n<p>So it is better to always include <code>{}</code></p>\n<h3 id=\"loops\">Loops</h3>\n<ul>\n<li>“foreach” vs “for of” vs “for in”\n<ul>\n<li><code>foreach</code> is an method that is available only in Array objects. It allows you to iterate through elements of an array. When invoked it takes a callback function and invokes the callback once for every array element. The callback can access both index and value of the array elements. foreach is available only for looping arrays.</li>\n<li><code>for of</code> is a new way for iterating collections. Its introduced in ES6. Earlier you had to use for or while loop to iterate through elements of an collection. For for of to work on an collection, the collection must have an [Symbol.iterator] property.</li>\n<li><code>for in</code> is used to loop through properties of an object. It can be any object. for in allows you to access the keys of the object but doesn’t provide reference to the values. In JavaScript object properties themselves have internal properties. One of the internal properties is [[Enumerable]]. for in will only walkthrough a property if it has [[Enumerbale]] set to true. It not used to iterate elements of an collection rather used to iterate properties of objects. For example:  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"string\">'A'</span>, <span class=\"string\">'B'</span>, <span class=\"string\">'C'</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> a) &#123;</span><br><span class=\"line\">    alert(i); <span class=\"comment\">// '0', '1', '2'</span></span><br><span class=\"line\">    alert(a[i]); <span class=\"comment\">// 'A', 'B', 'C'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"map-and-set\">Map and Set</h3>\n<p>In JavaScript, Map can be inplemented with Object<code>{}</code>, buy the key has to be a string. So ES6 introduced a new type <code>Map</code>.<br>\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\" target=\"_blank\" rel=\"noopener\">Map Reference</a></p>\n<h3 id=\"objects\">Objects</h3>\n<p>The property name has to be a valid name in order to let <code>Objects.property</code> to access. For example,</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> me = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'henry'</span></span><br><span class=\"line\">    <span class=\"string\">\"university\"</span>: <span class=\"string\">\"UD\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>&quot;university&quot;</code> is not a valid property name here, so it has to be accessed by<br>\n<code>me['university']</code>. But name can be accessed by <code>me.name</code></p>\n<ul>\n<li>“this” key word:<br>\nThe this object is bound at runtime based on the context in which a function is executed:\n<ul>\n<li>when used inside global functions,this is equal to window in nostrict mode and undefinedin strict mode.</li>\n<li>whereas this is equal to the object when called as an object method.</li>\n<li>as a constructor</li>\n<li>call and apply</li>\n<li>bound functions</li>\n<li>as dom event handler</li>\n</ul>\n</li>\n</ul>\n<p>this will point to global object:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.newvariable = <span class=\"string\">'hello'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);   </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">a();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newvariable);</span><br></pre></td></tr></table></figure>\n<p>When a global function is called, <code>this</code>will point to the window. Likewise, ‘this’ inside a function which is inside another function will be attached to the global object.</p>\n<p>In order to solve this problem, “self” or “that” is introduced:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'The c object'</span>,</span><br><span class=\"line\">    log: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        self.name = <span class=\"string\">'Updated c object'</span>;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(self);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> setname = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newname</span>) </span>&#123;</span><br><span class=\"line\">            self.name = newname;   </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        setname(<span class=\"string\">'Updated again! The c object'</span>);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(self);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">c.log();</span><br></pre></td></tr></table></figure>\n<p>Self points to the object c. When ‘setname’ is called, the js will look at the scope chain and find c.</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Javascript design flaws and wired parts</p>\n</blockquote>\n<h3>JavaScript flaws</h3>\n<p>JavaScript is the most dominant programming language for the web. Powerful as it is, JavaScript has many design flaws that may cause confusions for both newbie and seasoned developers . So it’s worth making a summary here.</p>\n<h3>Data type and variables</h3>\n<ul>\n<li><code>NaN</code> can not be compared with any number, like <code>NaN === NaN; // false</code>, the only way to check is by using <code>isNaN()</code>:</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">isNaN</span>(<span class=\"literal\">NaN</span>); <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p><code>null</code> and <code>undefined</code>: The undefined value is a primitive value used when a variable has not been assigned a value. The null value is a primitive value that represents the null, empty, or non-existent reference.</p>\n</li>\n<li>\n<p>If a variable is defined without <code>var</code>, it is set to be a global variable, which may cause some errors that are hard to debug. This problem can be solved by adding <code>'use strict';</code> in the first line</p>\n</li>\n</ul>\n<h3>Strings</h3>\n<p>Strings are imutable, like</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> s = <span class=\"string\">'Test'</span>;</span><br><span class=\"line\">s[<span class=\"number\">0</span>] = <span class=\"string\">'X'</span>;     </span><br><span class=\"line\">alert(s); <span class=\"comment\">// s is still 'Test'</span></span><br></pre></td></tr></table></figure>\n<h3>in operator</h3>\n<p><strong>in</strong> can only be used to check whether a prop is in an object like:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Arrays</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> trees = [<span class=\"string\">'redwood'</span>, <span class=\"string\">'bay'</span>, <span class=\"string\">'cedar'</span>, <span class=\"string\">'oak'</span>, <span class=\"string\">'maple'</span>];</span><br><span class=\"line\"><span class=\"number\">0</span> <span class=\"keyword\">in</span> trees        <span class=\"comment\">// returns true</span></span><br><span class=\"line\"><span class=\"number\">3</span> <span class=\"keyword\">in</span> trees        <span class=\"comment\">// returns true</span></span><br><span class=\"line\"><span class=\"number\">6</span> <span class=\"keyword\">in</span> trees        <span class=\"comment\">// returns false</span></span><br><span class=\"line\"><span class=\"string\">'bay'</span> <span class=\"keyword\">in</span> trees    <span class=\"comment\">// returns false (you must specify the </span></span><br><span class=\"line\">                  <span class=\"comment\">// index number, not the value at that index)</span></span><br><span class=\"line\"><span class=\"string\">'length'</span> <span class=\"keyword\">in</span> trees <span class=\"comment\">// returns true (length is an Array property)</span></span><br><span class=\"line\"><span class=\"built_in\">Symbol</span>.iterator <span class=\"keyword\">in</span> trees <span class=\"comment\">// returns true (arrays are iterable, works only in ES2015+)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Predefined objects</span></span><br><span class=\"line\"><span class=\"string\">'PI'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">Math</span>          <span class=\"comment\">// returns true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Custom objects</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> mycar = &#123;<span class=\"attr\">make</span>: <span class=\"string\">'Honda'</span>, <span class=\"attr\">model</span>: <span class=\"string\">'Accord'</span>, <span class=\"attr\">year</span>: <span class=\"number\">1998</span>&#125;;</span><br><span class=\"line\"><span class=\"string\">'make'</span> <span class=\"keyword\">in</span> mycar  <span class=\"comment\">// returns true</span></span><br></pre></td></tr></table></figure>\n<p>It has different function than ‘in’ in Python, whether <strong>in</strong> can be used to check element existence.</p>\n<h3>Conditions</h3>\n<p>JavaScript uses <code>if () { ... } else { ... }</code> to set conditions. But if there is only one statement in a block, <code>{}</code> can be removed. like</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (age &gt;= <span class=\"number\">18</span>)</span><br><span class=\"line\">    alert(<span class=\"string\">'adult'</span>);</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    alert(<span class=\"string\">'teenager'</span>);</span><br></pre></td></tr></table></figure>\n<p>However, there are risks doing this:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> age = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (age &gt;= <span class=\"number\">18</span>)</span><br><span class=\"line\">    alert(<span class=\"string\">'adult'</span>);</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'age &lt; 18'</span>);</span><br><span class=\"line\">    alert(<span class=\"string\">'teenager'</span>); <span class=\"comment\">// this line is actually not inside else</span></span><br></pre></td></tr></table></figure>\n<p>So it is better to always include <code>{}</code></p>\n<h3>Loops</h3>\n<ul>\n<li>“foreach” vs “for of” vs “for in”\n<ul>\n<li><code>foreach</code> is an method that is available only in Array objects. It allows you to iterate through elements of an array. When invoked it takes a callback function and invokes the callback once for every array element. The callback can access both index and value of the array elements. foreach is available only for looping arrays.</li>\n<li><code>for of</code> is a new way for iterating collections. Its introduced in ES6. Earlier you had to use for or while loop to iterate through elements of an collection. For for of to work on an collection, the collection must have an [Symbol.iterator] property.</li>\n<li><code>for in</code> is used to loop through properties of an object. It can be any object. for in allows you to access the keys of the object but doesn’t provide reference to the values. In JavaScript object properties themselves have internal properties. One of the internal properties is [[Enumerable]]. for in will only walkthrough a property if it has [[Enumerbale]] set to true. It not used to iterate elements of an collection rather used to iterate properties of objects. For example:  <figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"string\">'A'</span>, <span class=\"string\">'B'</span>, <span class=\"string\">'C'</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> a) &#123;</span><br><span class=\"line\">    alert(i); <span class=\"comment\">// '0', '1', '2'</span></span><br><span class=\"line\">    alert(a[i]); <span class=\"comment\">// 'A', 'B', 'C'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<h3>Map and Set</h3>\n<p>In JavaScript, Map can be inplemented with Object<code>{}</code>, buy the key has to be a string. So ES6 introduced a new type <code>Map</code>.<br>\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\" target=\"_blank\" rel=\"noopener\">Map Reference</a></p>\n<h3>Objects</h3>\n<p>The property name has to be a valid name in order to let <code>Objects.property</code> to access. For example,</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> me = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'henry'</span></span><br><span class=\"line\">    <span class=\"string\">\"university\"</span>: <span class=\"string\">\"UD\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><code>&quot;university&quot;</code> is not a valid property name here, so it has to be accessed by<br>\n<code>me['university']</code>. But name can be accessed by <code>me.name</code></p>\n<ul>\n<li>“this” key word:<br>\nThe this object is bound at runtime based on the context in which a function is executed:\n<ul>\n<li>when used inside global functions,this is equal to window in nostrict mode and undefinedin strict mode.</li>\n<li>whereas this is equal to the object when called as an object method.</li>\n<li>as a constructor</li>\n<li>call and apply</li>\n<li>bound functions</li>\n<li>as dom event handler</li>\n</ul>\n</li>\n</ul>\n<p>this will point to global object:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.newvariable = <span class=\"string\">'hello'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);   </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">a();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(newvariable);</span><br></pre></td></tr></table></figure>\n<p>When a global function is called, <code>this</code>will point to the window. Likewise, ‘this’ inside a function which is inside another function will be attached to the global object.</p>\n<p>In order to solve this problem, “self” or “that” is introduced:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> c = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'The c object'</span>,</span><br><span class=\"line\">    log: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        self.name = <span class=\"string\">'Updated c object'</span>;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(self);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">var</span> setname = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">newname</span>) </span>&#123;</span><br><span class=\"line\">            self.name = newname;   </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        setname(<span class=\"string\">'Updated again! The c object'</span>);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(self);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">c.log();</span><br></pre></td></tr></table></figure>\n<p>Self points to the object c. When ‘setname’ is called, the js will look at the scope chain and find c.</p>\n"},{"title":"Python-Collections-And-Tricks","catalog":true,"date":"2017-05-23T01:01:50.000Z","subtitle":"Being pythonic","header-img":"us_map.JPG","_content":"\n> Introduction of Python unique data structures of high performance and summary of pythonic ways of coding\n\n## Python collections\n> Here is [collection ducumentation](https://docs.python.org/2.7/library/collections.html#collections.ChainMap)\n\nBesides `list`, `dictionary`, `tuple`, python provides some high-performance container datatypes in the module `collections`, which I find extremely useful when dealing with hashtable or stack problems. You can always implement these by using basic `list` or `dictionary`, but it really eases your life if you know their existence and are familiar with their APIs beforehand.\n\n### deque (pronounced \"deck\", not \"D-queue\")\nDeque is basically a double-ended-queue structure and supports efficient operations like appends and pops from both sides. It has totally same operations as `list`, but runs in O(1) in operations like pop(0), appendleft(x).\n\n**To initialize**: It takes a iterable and a maxlen. From official document:\n\n>If maxlen is not specified or is None, deques may grow to an arbitrary length. Otherwise, the deque is bounded to the specified maximum length. Once a bounded length deque is full, when new items are added, a corresponding number of items are discarded from the opposite end.\n\n```py\ndeque = collections.deque([],maxlen=3)\nfor i in range(4):\n    deque.append(i)\nprint deque # deque([1, 2, 3], maxlen=3)    \n```\n\n**List of methods from official document**:\n\n- append(x): Add x to the right side of the deque.\n\n- appendleft(x): Add x to the left side of the deque.\n\n- clear():Remove all elements from the deque leaving it with length 0.\n\n- count(x): Count the number of deque elements equal to x.\n\n- extend(iterable): Extend the right side of the deque by appending elements from the iterable argument.\n\n  - if you extend a string, it will treat every char as an element\n```py\nfor i in range(4):\n    deque.append(i)\ndeque.extend(\"[4,5,6]\")\nprint deque # deque([0, 1, 2, 3, '[', '4', ',', '5', ',', '6', ']'])\n```\n\n- extendleft(iterable):\nExtend the left side of the deque by appending elements from iterable. Note, the series of left appends results in reversing the order of elements in the iterable argument.\n\n- pop(): Remove and return an element from the right side of the deque. If no elements are present, raises an IndexError.\n\n- popleft(): Remove and return an element from the left side of the deque. If no elements are present, raises an IndexError.\n\n- remove(value): Removed the first occurrence of value. If not found, raises a ValueError.\n\n- reverse(): Reverse the elements of the deque in-place and then return None.\n\n- rotate(n): Rotate the deque n steps to the right. If n is negative, rotate to the left. Rotating one step to the right is equivalent to: d.appendleft(d.pop()).\n\n### OrderedDict\nIf you want to keep the order of the items you insert into a dictionary, `OrderedDict` is the one you need.\n\n ```py\n>>> # regular unsorted dictionary\n>>> d = {'banana': 3, 'apple': 4, 'pear': 1, 'orange': 2}\n\n>>> # dictionary sorted by key\n>>> OrderedDict(sorted(d.items(), key=lambda t: t[0]))\nOrderedDict([('apple', 4), ('banana', 3), ('orange', 2), ('pear', 1)])\n\n>>> # dictionary sorted by value\n>>> OrderedDict(sorted(d.items(), key=lambda t: t[1]))\nOrderedDict([('pear', 1), ('orange', 2), ('banana', 3), ('apple', 4)])\n\n>>> # dictionary sorted by length of the key string\n>>> OrderedDict(sorted(d.items(), key=lambda t: len(t[0])))\nOrderedDict([('pear', 1), ('apple', 4), ('orange', 2), ('banana', 3)])\n```\n\n**OrderedDict.popitem(last=True)**\nThe popitem() method for ordered dictionaries returns and removes a (key, value) pair. The pairs are returned in LIFO order if last is true or FIFO order if false.\n(This method could be very useful in LRU cache design)\n\n### defaultdict\nThis datatype provides a factory function to store customized key-value pairs into dictionaries.\nFrom doc:\n\nIt is easy to group a sequence of key-value pairs into a dictionary of lists:\n```py\n>>> s = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]\n>>> d = defaultdict(list)\n>>> for k, v in s:\n...     d[k].append(v)\n...\n>>> d.items()\n[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]\n```\n\nThis technique is simpler and faster than an equivalent technique using dict.setdefault():\n\n```py\n>>> d = {}\n>>> for k, v in s:\n...     d.setdefault(k, []).append(v)\n...\n>>> d.items()\n[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]\n```\n\n### heapq\n\n\n\n## Tricks\n(to be filled)\n\n### sorted()\n\n### enumerate()\n\nIt is an efficient way to loop through a list and get the index and value at the same time.\n\n```py\nenumerate(sequence, start=0) # start is optional, from 0 as default\n>>> seasons = ['Spring', 'Summer', 'Fall', 'Winter']\n>>> list(enumerate(seasons))\n[(0, 'Spring'), (1, 'Summer'), (2, 'Fall'), (3, 'Winter')]\n>>> list(enumerate(seasons, start=1))\n[(1, 'Spring'), (2, 'Summer'), (3, 'Fall'), (4, 'Winter')]\n\n```\n\n### zip()\n\n### list comprehesion\n\nPython provides a very natural way to construct list, no matter what dimension.\n\n##### Basic syntax:\n\n```py\n[ expression for item in list if conditional ]\n```\n\nwhich is equivalent to\n\n```py\n\nfor item in list:\n    if conditional:\n        expression\n\n```\n\nso to initialize an empty 2D array in python is:\n```py\n\n# Creates a list containing 5 lists, each of 8 items, all set to 0\nw, h = 8, 5;\nMatrix = [[0 for x in range(w)] for y in range(h)]\n\n```\n\nbut note here, *append* does not work as expected in list comprehension, it only mutates array rather than returns value:\n```py\na = [[1,2],[3,4],[5,6]]\na = [x.append('a') for x in a]\n# return  [None,None,None]\n```\n\nanother example:\n<script src=\"https://gist.github.com/HanchengZhao/69e152c12509806653061c95c66d0ada.js\"></script>\n\nHere it returns the first node in a value list of a dictionary that has more than 1 node. `if node[1]` will cause `IndexError: list index out of range`, but `if node[1:]` works.\n\n### sort() and sorted()\nsort() sorts objects of list, it does not return list. So you can not use `''.join(list(str).sort())` to sort string. Instead, you can try `''.join(sorted(str))` because sorted will return a new sorted list from the items in iterable.","source":"_posts/Python-Collections-And-Tricks.md","raw":"---\ntitle: Python-Collections-And-Tricks\ncatalog: true\ndate: 2017-5-22 21:01:50\nsubtitle: Being pythonic\nheader-img: \"us_map.JPG\"\ntags:\n- python\n---\n\n> Introduction of Python unique data structures of high performance and summary of pythonic ways of coding\n\n## Python collections\n> Here is [collection ducumentation](https://docs.python.org/2.7/library/collections.html#collections.ChainMap)\n\nBesides `list`, `dictionary`, `tuple`, python provides some high-performance container datatypes in the module `collections`, which I find extremely useful when dealing with hashtable or stack problems. You can always implement these by using basic `list` or `dictionary`, but it really eases your life if you know their existence and are familiar with their APIs beforehand.\n\n### deque (pronounced \"deck\", not \"D-queue\")\nDeque is basically a double-ended-queue structure and supports efficient operations like appends and pops from both sides. It has totally same operations as `list`, but runs in O(1) in operations like pop(0), appendleft(x).\n\n**To initialize**: It takes a iterable and a maxlen. From official document:\n\n>If maxlen is not specified or is None, deques may grow to an arbitrary length. Otherwise, the deque is bounded to the specified maximum length. Once a bounded length deque is full, when new items are added, a corresponding number of items are discarded from the opposite end.\n\n```py\ndeque = collections.deque([],maxlen=3)\nfor i in range(4):\n    deque.append(i)\nprint deque # deque([1, 2, 3], maxlen=3)    \n```\n\n**List of methods from official document**:\n\n- append(x): Add x to the right side of the deque.\n\n- appendleft(x): Add x to the left side of the deque.\n\n- clear():Remove all elements from the deque leaving it with length 0.\n\n- count(x): Count the number of deque elements equal to x.\n\n- extend(iterable): Extend the right side of the deque by appending elements from the iterable argument.\n\n  - if you extend a string, it will treat every char as an element\n```py\nfor i in range(4):\n    deque.append(i)\ndeque.extend(\"[4,5,6]\")\nprint deque # deque([0, 1, 2, 3, '[', '4', ',', '5', ',', '6', ']'])\n```\n\n- extendleft(iterable):\nExtend the left side of the deque by appending elements from iterable. Note, the series of left appends results in reversing the order of elements in the iterable argument.\n\n- pop(): Remove and return an element from the right side of the deque. If no elements are present, raises an IndexError.\n\n- popleft(): Remove and return an element from the left side of the deque. If no elements are present, raises an IndexError.\n\n- remove(value): Removed the first occurrence of value. If not found, raises a ValueError.\n\n- reverse(): Reverse the elements of the deque in-place and then return None.\n\n- rotate(n): Rotate the deque n steps to the right. If n is negative, rotate to the left. Rotating one step to the right is equivalent to: d.appendleft(d.pop()).\n\n### OrderedDict\nIf you want to keep the order of the items you insert into a dictionary, `OrderedDict` is the one you need.\n\n ```py\n>>> # regular unsorted dictionary\n>>> d = {'banana': 3, 'apple': 4, 'pear': 1, 'orange': 2}\n\n>>> # dictionary sorted by key\n>>> OrderedDict(sorted(d.items(), key=lambda t: t[0]))\nOrderedDict([('apple', 4), ('banana', 3), ('orange', 2), ('pear', 1)])\n\n>>> # dictionary sorted by value\n>>> OrderedDict(sorted(d.items(), key=lambda t: t[1]))\nOrderedDict([('pear', 1), ('orange', 2), ('banana', 3), ('apple', 4)])\n\n>>> # dictionary sorted by length of the key string\n>>> OrderedDict(sorted(d.items(), key=lambda t: len(t[0])))\nOrderedDict([('pear', 1), ('apple', 4), ('orange', 2), ('banana', 3)])\n```\n\n**OrderedDict.popitem(last=True)**\nThe popitem() method for ordered dictionaries returns and removes a (key, value) pair. The pairs are returned in LIFO order if last is true or FIFO order if false.\n(This method could be very useful in LRU cache design)\n\n### defaultdict\nThis datatype provides a factory function to store customized key-value pairs into dictionaries.\nFrom doc:\n\nIt is easy to group a sequence of key-value pairs into a dictionary of lists:\n```py\n>>> s = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]\n>>> d = defaultdict(list)\n>>> for k, v in s:\n...     d[k].append(v)\n...\n>>> d.items()\n[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]\n```\n\nThis technique is simpler and faster than an equivalent technique using dict.setdefault():\n\n```py\n>>> d = {}\n>>> for k, v in s:\n...     d.setdefault(k, []).append(v)\n...\n>>> d.items()\n[('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]\n```\n\n### heapq\n\n\n\n## Tricks\n(to be filled)\n\n### sorted()\n\n### enumerate()\n\nIt is an efficient way to loop through a list and get the index and value at the same time.\n\n```py\nenumerate(sequence, start=0) # start is optional, from 0 as default\n>>> seasons = ['Spring', 'Summer', 'Fall', 'Winter']\n>>> list(enumerate(seasons))\n[(0, 'Spring'), (1, 'Summer'), (2, 'Fall'), (3, 'Winter')]\n>>> list(enumerate(seasons, start=1))\n[(1, 'Spring'), (2, 'Summer'), (3, 'Fall'), (4, 'Winter')]\n\n```\n\n### zip()\n\n### list comprehesion\n\nPython provides a very natural way to construct list, no matter what dimension.\n\n##### Basic syntax:\n\n```py\n[ expression for item in list if conditional ]\n```\n\nwhich is equivalent to\n\n```py\n\nfor item in list:\n    if conditional:\n        expression\n\n```\n\nso to initialize an empty 2D array in python is:\n```py\n\n# Creates a list containing 5 lists, each of 8 items, all set to 0\nw, h = 8, 5;\nMatrix = [[0 for x in range(w)] for y in range(h)]\n\n```\n\nbut note here, *append* does not work as expected in list comprehension, it only mutates array rather than returns value:\n```py\na = [[1,2],[3,4],[5,6]]\na = [x.append('a') for x in a]\n# return  [None,None,None]\n```\n\nanother example:\n<script src=\"https://gist.github.com/HanchengZhao/69e152c12509806653061c95c66d0ada.js\"></script>\n\nHere it returns the first node in a value list of a dictionary that has more than 1 node. `if node[1]` will cause `IndexError: list index out of range`, but `if node[1:]` works.\n\n### sort() and sorted()\nsort() sorts objects of list, it does not return list. So you can not use `''.join(list(str).sort())` to sort string. Instead, you can try `''.join(sorted(str))` because sorted will return a new sorted list from the items in iterable.","slug":"Python-Collections-And-Tricks","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxo000ax18ltaq431q7","content":"<blockquote>\n<p>Introduction of Python unique data structures of high performance and summary of pythonic ways of coding</p>\n</blockquote>\n<h2 id=\"python-collections\">Python collections</h2>\n<blockquote>\n<p>Here is <a href=\"https://docs.python.org/2.7/library/collections.html#collections.ChainMap\" target=\"_blank\" rel=\"noopener\">collection ducumentation</a></p>\n</blockquote>\n<p>Besides <code>list</code>, <code>dictionary</code>, <code>tuple</code>, python provides some high-performance container datatypes in the module <code>collections</code>, which I find extremely useful when dealing with hashtable or stack problems. You can always implement these by using basic <code>list</code> or <code>dictionary</code>, but it really eases your life if you know their existence and are familiar with their APIs beforehand.</p>\n<h3 id=\"deque-pronounced-deck-not-d-queue\">deque (pronounced “deck”, not “D-queue”)</h3>\n<p>Deque is basically a double-ended-queue structure and supports efficient operations like appends and pops from both sides. It has totally same operations as <code>list</code>, but runs in O(1) in operations like pop(0), appendleft(x).</p>\n<p><strong>To initialize</strong>: It takes a iterable and a maxlen. From official document:</p>\n<blockquote>\n<p>If maxlen is not specified or is None, deques may grow to an arbitrary length. Otherwise, the deque is bounded to the specified maximum length. Once a bounded length deque is full, when new items are added, a corresponding number of items are discarded from the opposite end.</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deque = collections.deque([],maxlen=<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">4</span>):</span><br><span class=\"line\">    deque.append(i)</span><br><span class=\"line\"><span class=\"keyword\">print</span> deque <span class=\"comment\"># deque([1, 2, 3], maxlen=3)</span></span><br></pre></td></tr></table></figure>\n<p><strong>List of methods from official document</strong>:</p>\n<ul>\n<li>\n<p>append(x): Add x to the right side of the deque.</p>\n</li>\n<li>\n<p>appendleft(x): Add x to the left side of the deque.</p>\n</li>\n<li>\n<p>clear():Remove all elements from the deque leaving it with length 0.</p>\n</li>\n<li>\n<p>count(x): Count the number of deque elements equal to x.</p>\n</li>\n<li>\n<p>extend(iterable): Extend the right side of the deque by appending elements from the iterable argument.</p>\n<ul>\n<li>if you extend a string, it will treat every char as an element</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">4</span>):</span><br><span class=\"line\">    deque.append(i)</span><br><span class=\"line\">deque.extend(<span class=\"string\">\"[4,5,6]\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">print</span> deque <span class=\"comment\"># deque([0, 1, 2, 3, '[', '4', ',', '5', ',', '6', ']'])</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>extendleft(iterable):<br>\nExtend the left side of the deque by appending elements from iterable. Note, the series of left appends results in reversing the order of elements in the iterable argument.</p>\n</li>\n<li>\n<p>pop(): Remove and return an element from the right side of the deque. If no elements are present, raises an IndexError.</p>\n</li>\n<li>\n<p>popleft(): Remove and return an element from the left side of the deque. If no elements are present, raises an IndexError.</p>\n</li>\n<li>\n<p>remove(value): Removed the first occurrence of value. If not found, raises a ValueError.</p>\n</li>\n<li>\n<p>reverse(): Reverse the elements of the deque in-place and then return None.</p>\n</li>\n<li>\n<p>rotate(n): Rotate the deque n steps to the right. If n is negative, rotate to the left. Rotating one step to the right is equivalent to: d.appendleft(d.pop()).</p>\n</li>\n</ul>\n<h3 id=\"ordereddict\">OrderedDict</h3>\n<p>If you want to keep the order of the items you insert into a dictionary, <code>OrderedDict</code> is the one you need.</p>\n <figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># regular unsorted dictionary</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = &#123;<span class=\"string\">'banana'</span>: <span class=\"number\">3</span>, <span class=\"string\">'apple'</span>: <span class=\"number\">4</span>, <span class=\"string\">'pear'</span>: <span class=\"number\">1</span>, <span class=\"string\">'orange'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># dictionary sorted by key</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>OrderedDict(sorted(d.items(), key=<span class=\"keyword\">lambda</span> t: t[<span class=\"number\">0</span>]))</span><br><span class=\"line\">OrderedDict([(<span class=\"string\">'apple'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'banana'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'orange'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'pear'</span>, <span class=\"number\">1</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># dictionary sorted by value</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>OrderedDict(sorted(d.items(), key=<span class=\"keyword\">lambda</span> t: t[<span class=\"number\">1</span>]))</span><br><span class=\"line\">OrderedDict([(<span class=\"string\">'pear'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'orange'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'banana'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'apple'</span>, <span class=\"number\">4</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># dictionary sorted by length of the key string</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>OrderedDict(sorted(d.items(), key=<span class=\"keyword\">lambda</span> t: len(t[<span class=\"number\">0</span>])))</span><br><span class=\"line\">OrderedDict([(<span class=\"string\">'pear'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'apple'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'orange'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'banana'</span>, <span class=\"number\">3</span>)])</span><br></pre></td></tr></table></figure>\n<p><strong>OrderedDict.popitem(last=True)</strong><br>\nThe popitem() method for ordered dictionaries returns and removes a (key, value) pair. The pairs are returned in LIFO order if last is true or FIFO order if false.<br>\n(This method could be very useful in LRU cache design)</p>\n<h3 id=\"defaultdict\">defaultdict</h3>\n<p>This datatype provides a factory function to store customized key-value pairs into dictionaries.<br>\nFrom doc:</p>\n<p>It is easy to group a sequence of key-value pairs into a dictionary of lists:</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = [(<span class=\"string\">'yellow'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'yellow'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'red'</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = defaultdict(list)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> s:</span><br><span class=\"line\"><span class=\"meta\">... </span>    d[k].append(v)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.items()</span><br><span class=\"line\">[(<span class=\"string\">'blue'</span>, [<span class=\"number\">2</span>, <span class=\"number\">4</span>]), (<span class=\"string\">'red'</span>, [<span class=\"number\">1</span>]), (<span class=\"string\">'yellow'</span>, [<span class=\"number\">1</span>, <span class=\"number\">3</span>])]</span><br></pre></td></tr></table></figure>\n<p>This technique is simpler and faster than an equivalent technique using dict.setdefault():</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = &#123;&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> s:</span><br><span class=\"line\"><span class=\"meta\">... </span>    d.setdefault(k, []).append(v)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.items()</span><br><span class=\"line\">[(<span class=\"string\">'blue'</span>, [<span class=\"number\">2</span>, <span class=\"number\">4</span>]), (<span class=\"string\">'red'</span>, [<span class=\"number\">1</span>]), (<span class=\"string\">'yellow'</span>, [<span class=\"number\">1</span>, <span class=\"number\">3</span>])]</span><br></pre></td></tr></table></figure>\n<h3 id=\"heapq\">heapq</h3>\n<h2 id=\"tricks\">Tricks</h2>\n<p>(to be filled)</p>\n<h3 id=\"sorted\">sorted()</h3>\n<h3 id=\"enumerate\">enumerate()</h3>\n<p>It is an efficient way to loop through a list and get the index and value at the same time.</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">enumerate(sequence, start=<span class=\"number\">0</span>) <span class=\"comment\"># start is optional, from 0 as default</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>seasons = [<span class=\"string\">'Spring'</span>, <span class=\"string\">'Summer'</span>, <span class=\"string\">'Fall'</span>, <span class=\"string\">'Winter'</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>list(enumerate(seasons))</span><br><span class=\"line\">[(<span class=\"number\">0</span>, <span class=\"string\">'Spring'</span>), (<span class=\"number\">1</span>, <span class=\"string\">'Summer'</span>), (<span class=\"number\">2</span>, <span class=\"string\">'Fall'</span>), (<span class=\"number\">3</span>, <span class=\"string\">'Winter'</span>)]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>list(enumerate(seasons, start=<span class=\"number\">1</span>))</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"string\">'Spring'</span>), (<span class=\"number\">2</span>, <span class=\"string\">'Summer'</span>), (<span class=\"number\">3</span>, <span class=\"string\">'Fall'</span>), (<span class=\"number\">4</span>, <span class=\"string\">'Winter'</span>)]</span><br></pre></td></tr></table></figure>\n<h3 id=\"zip\">zip()</h3>\n<h3 id=\"list-comprehesion\">list comprehesion</h3>\n<p>Python provides a very natural way to construct list, no matter what dimension.</p>\n<h5 id=\"basic-syntax\">Basic syntax:</h5>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ expression <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> list <span class=\"keyword\">if</span> conditional ]</span><br></pre></td></tr></table></figure>\n<p>which is equivalent to</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> list:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> conditional:</span><br><span class=\"line\">        expression</span><br></pre></td></tr></table></figure>\n<p>so to initialize an empty 2D array in python is:</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Creates a list containing 5 lists, each of 8 items, all set to 0</span></span><br><span class=\"line\">w, h = <span class=\"number\">8</span>, <span class=\"number\">5</span>;</span><br><span class=\"line\">Matrix = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(w)] <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> range(h)]</span><br></pre></td></tr></table></figure>\n<p>but note here, <em>append</em> does not work as expected in list comprehension, it only mutates array rather than returns value:</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [[<span class=\"number\">1</span>,<span class=\"number\">2</span>],[<span class=\"number\">3</span>,<span class=\"number\">4</span>],[<span class=\"number\">5</span>,<span class=\"number\">6</span>]]</span><br><span class=\"line\">a = [x.append(<span class=\"string\">'a'</span>) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> a]</span><br><span class=\"line\"><span class=\"comment\"># return  [None,None,None]</span></span><br></pre></td></tr></table></figure>\n<p>another example:</p>\n<script src=\"https://gist.github.com/HanchengZhao/69e152c12509806653061c95c66d0ada.js\"></script>\n<p>Here it returns the first node in a value list of a dictionary that has more than 1 node. <code>if node[1]</code> will cause <code>IndexError: list index out of range</code>, but <code>if node[1:]</code> works.</p>\n<h3 id=\"sort-and-sorted\">sort() and sorted()</h3>\n<p>sort() sorts objects of list, it does not return list. So you can not use <code>''.join(list(str).sort())</code> to sort string. Instead, you can try <code>''.join(sorted(str))</code> because sorted will return a new sorted list from the items in iterable.</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Introduction of Python unique data structures of high performance and summary of pythonic ways of coding</p>\n</blockquote>\n<h2>Python collections</h2>\n<blockquote>\n<p>Here is <a href=\"https://docs.python.org/2.7/library/collections.html#collections.ChainMap\" target=\"_blank\" rel=\"noopener\">collection ducumentation</a></p>\n</blockquote>\n<p>Besides <code>list</code>, <code>dictionary</code>, <code>tuple</code>, python provides some high-performance container datatypes in the module <code>collections</code>, which I find extremely useful when dealing with hashtable or stack problems. You can always implement these by using basic <code>list</code> or <code>dictionary</code>, but it really eases your life if you know their existence and are familiar with their APIs beforehand.</p>\n<h3>deque (pronounced “deck”, not “D-queue”)</h3>\n<p>Deque is basically a double-ended-queue structure and supports efficient operations like appends and pops from both sides. It has totally same operations as <code>list</code>, but runs in O(1) in operations like pop(0), appendleft(x).</p>\n<p><strong>To initialize</strong>: It takes a iterable and a maxlen. From official document:</p>\n<blockquote>\n<p>If maxlen is not specified or is None, deques may grow to an arbitrary length. Otherwise, the deque is bounded to the specified maximum length. Once a bounded length deque is full, when new items are added, a corresponding number of items are discarded from the opposite end.</p>\n</blockquote>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deque = collections.deque([],maxlen=<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">4</span>):</span><br><span class=\"line\">    deque.append(i)</span><br><span class=\"line\"><span class=\"keyword\">print</span> deque <span class=\"comment\"># deque([1, 2, 3], maxlen=3)</span></span><br></pre></td></tr></table></figure>\n<p><strong>List of methods from official document</strong>:</p>\n<ul>\n<li>\n<p>append(x): Add x to the right side of the deque.</p>\n</li>\n<li>\n<p>appendleft(x): Add x to the left side of the deque.</p>\n</li>\n<li>\n<p>clear():Remove all elements from the deque leaving it with length 0.</p>\n</li>\n<li>\n<p>count(x): Count the number of deque elements equal to x.</p>\n</li>\n<li>\n<p>extend(iterable): Extend the right side of the deque by appending elements from the iterable argument.</p>\n<ul>\n<li>if you extend a string, it will treat every char as an element</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">4</span>):</span><br><span class=\"line\">    deque.append(i)</span><br><span class=\"line\">deque.extend(<span class=\"string\">\"[4,5,6]\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">print</span> deque <span class=\"comment\"># deque([0, 1, 2, 3, '[', '4', ',', '5', ',', '6', ']'])</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>extendleft(iterable):<br>\nExtend the left side of the deque by appending elements from iterable. Note, the series of left appends results in reversing the order of elements in the iterable argument.</p>\n</li>\n<li>\n<p>pop(): Remove and return an element from the right side of the deque. If no elements are present, raises an IndexError.</p>\n</li>\n<li>\n<p>popleft(): Remove and return an element from the left side of the deque. If no elements are present, raises an IndexError.</p>\n</li>\n<li>\n<p>remove(value): Removed the first occurrence of value. If not found, raises a ValueError.</p>\n</li>\n<li>\n<p>reverse(): Reverse the elements of the deque in-place and then return None.</p>\n</li>\n<li>\n<p>rotate(n): Rotate the deque n steps to the right. If n is negative, rotate to the left. Rotating one step to the right is equivalent to: d.appendleft(d.pop()).</p>\n</li>\n</ul>\n<h3>OrderedDict</h3>\n<p>If you want to keep the order of the items you insert into a dictionary, <code>OrderedDict</code> is the one you need.</p>\n <figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># regular unsorted dictionary</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = &#123;<span class=\"string\">'banana'</span>: <span class=\"number\">3</span>, <span class=\"string\">'apple'</span>: <span class=\"number\">4</span>, <span class=\"string\">'pear'</span>: <span class=\"number\">1</span>, <span class=\"string\">'orange'</span>: <span class=\"number\">2</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># dictionary sorted by key</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>OrderedDict(sorted(d.items(), key=<span class=\"keyword\">lambda</span> t: t[<span class=\"number\">0</span>]))</span><br><span class=\"line\">OrderedDict([(<span class=\"string\">'apple'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'banana'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'orange'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'pear'</span>, <span class=\"number\">1</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># dictionary sorted by value</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>OrderedDict(sorted(d.items(), key=<span class=\"keyword\">lambda</span> t: t[<span class=\"number\">1</span>]))</span><br><span class=\"line\">OrderedDict([(<span class=\"string\">'pear'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'orange'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'banana'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'apple'</span>, <span class=\"number\">4</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"comment\"># dictionary sorted by length of the key string</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>OrderedDict(sorted(d.items(), key=<span class=\"keyword\">lambda</span> t: len(t[<span class=\"number\">0</span>])))</span><br><span class=\"line\">OrderedDict([(<span class=\"string\">'pear'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'apple'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'orange'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'banana'</span>, <span class=\"number\">3</span>)])</span><br></pre></td></tr></table></figure>\n<p><strong>OrderedDict.popitem(last=True)</strong><br>\nThe popitem() method for ordered dictionaries returns and removes a (key, value) pair. The pairs are returned in LIFO order if last is true or FIFO order if false.<br>\n(This method could be very useful in LRU cache design)</p>\n<h3>defaultdict</h3>\n<p>This datatype provides a factory function to store customized key-value pairs into dictionaries.<br>\nFrom doc:</p>\n<p>It is easy to group a sequence of key-value pairs into a dictionary of lists:</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>s = [(<span class=\"string\">'yellow'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'yellow'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'red'</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = defaultdict(list)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> s:</span><br><span class=\"line\"><span class=\"meta\">... </span>    d[k].append(v)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.items()</span><br><span class=\"line\">[(<span class=\"string\">'blue'</span>, [<span class=\"number\">2</span>, <span class=\"number\">4</span>]), (<span class=\"string\">'red'</span>, [<span class=\"number\">1</span>]), (<span class=\"string\">'yellow'</span>, [<span class=\"number\">1</span>, <span class=\"number\">3</span>])]</span><br></pre></td></tr></table></figure>\n<p>This technique is simpler and faster than an equivalent technique using dict.setdefault():</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = &#123;&#125;</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> s:</span><br><span class=\"line\"><span class=\"meta\">... </span>    d.setdefault(k, []).append(v)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.items()</span><br><span class=\"line\">[(<span class=\"string\">'blue'</span>, [<span class=\"number\">2</span>, <span class=\"number\">4</span>]), (<span class=\"string\">'red'</span>, [<span class=\"number\">1</span>]), (<span class=\"string\">'yellow'</span>, [<span class=\"number\">1</span>, <span class=\"number\">3</span>])]</span><br></pre></td></tr></table></figure>\n<h3>heapq</h3>\n<h2>Tricks</h2>\n<p>(to be filled)</p>\n<h3>sorted()</h3>\n<h3>enumerate()</h3>\n<p>It is an efficient way to loop through a list and get the index and value at the same time.</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">enumerate(sequence, start=<span class=\"number\">0</span>) <span class=\"comment\"># start is optional, from 0 as default</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>seasons = [<span class=\"string\">'Spring'</span>, <span class=\"string\">'Summer'</span>, <span class=\"string\">'Fall'</span>, <span class=\"string\">'Winter'</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>list(enumerate(seasons))</span><br><span class=\"line\">[(<span class=\"number\">0</span>, <span class=\"string\">'Spring'</span>), (<span class=\"number\">1</span>, <span class=\"string\">'Summer'</span>), (<span class=\"number\">2</span>, <span class=\"string\">'Fall'</span>), (<span class=\"number\">3</span>, <span class=\"string\">'Winter'</span>)]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>list(enumerate(seasons, start=<span class=\"number\">1</span>))</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"string\">'Spring'</span>), (<span class=\"number\">2</span>, <span class=\"string\">'Summer'</span>), (<span class=\"number\">3</span>, <span class=\"string\">'Fall'</span>), (<span class=\"number\">4</span>, <span class=\"string\">'Winter'</span>)]</span><br></pre></td></tr></table></figure>\n<h3>zip()</h3>\n<h3>list comprehesion</h3>\n<p>Python provides a very natural way to construct list, no matter what dimension.</p>\n<h5>Basic syntax:</h5>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ expression <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> list <span class=\"keyword\">if</span> conditional ]</span><br></pre></td></tr></table></figure>\n<p>which is equivalent to</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> list:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> conditional:</span><br><span class=\"line\">        expression</span><br></pre></td></tr></table></figure>\n<p>so to initialize an empty 2D array in python is:</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Creates a list containing 5 lists, each of 8 items, all set to 0</span></span><br><span class=\"line\">w, h = <span class=\"number\">8</span>, <span class=\"number\">5</span>;</span><br><span class=\"line\">Matrix = [[<span class=\"number\">0</span> <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(w)] <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> range(h)]</span><br></pre></td></tr></table></figure>\n<p>but note here, <em>append</em> does not work as expected in list comprehension, it only mutates array rather than returns value:</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [[<span class=\"number\">1</span>,<span class=\"number\">2</span>],[<span class=\"number\">3</span>,<span class=\"number\">4</span>],[<span class=\"number\">5</span>,<span class=\"number\">6</span>]]</span><br><span class=\"line\">a = [x.append(<span class=\"string\">'a'</span>) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> a]</span><br><span class=\"line\"><span class=\"comment\"># return  [None,None,None]</span></span><br></pre></td></tr></table></figure>\n<p>another example:</p>\n<script src=\"https://gist.github.com/HanchengZhao/69e152c12509806653061c95c66d0ada.js\"></script>\n<p>Here it returns the first node in a value list of a dictionary that has more than 1 node. <code>if node[1]</code> will cause <code>IndexError: list index out of range</code>, but <code>if node[1:]</code> works.</p>\n<h3>sort() and sorted()</h3>\n<p>sort() sorts objects of list, it does not return list. So you can not use <code>''.join(list(str).sort())</code> to sort string. Instead, you can try <code>''.join(sorted(str))</code> because sorted will return a new sorted list from the items in iterable.</p>\n"},{"title":"To my graduation","date":"2017-05-27T16:23:22.000Z","catalog":true,"header-img":"campus.JPG","catagories":["Thoughts"],"_content":">This is not the end, this is not even the beginning of the end, but perhaps it is the end of beginning.\n\n![Graduation](graduation.jpg)\n\nI tend to make a summary at major moments in my life. Convocation is at tonight and commencement is tomorrow, and this is it.\n\nIf I look back at myself 2 years ago, I would feel like looking at a different person in terms of things I am working on daily. I'm not saying I am so knowledgeable right now, I just knew nothing about programming at all. I still remember the first class I took in UD--I watched the professor ssh to a server, operate files using bash command and using Vim to edit codes fluently and I had no idea what it was. I learned a little bit C in my undergraduate, but I only knew you had to include a certain library to print \"hello world\". Our first assignment had to be submitted in tar file compressed using a command, I did not even know I had to cd into the file folder to do that, but actually, I did not know what tar file was. The course was mainly about high-performance computing and our final project was to parallelize radix sort on Cuda. It assumed that students knew basic algorithms and C programming, but I did not even know what radix sort was, let alone optimize it. To be honest, I did not know any other sorting algorithms until I took the algorithm class the second semester.\nBut after endless online tutorials and office hours, we finally turned in our report and got an A on that. Well, it is easy talking about the whole experience afterwards, but you know what you have been through.\n\nHowever, it was until the first winter session when Will took me to Andy's front-end class that I found this was what I was looking for. Nothing had been better than the instant response and sense of accomplishment you received when coding. Then I embarked on a wonderful journey of web development and for the first time, I realized I loved coding so much. Ever since then, the Mac room at the lower level of the library has been the place that I spent most of my spare time. Even now, I am typing these words here. Sometimes, I am the only one in the room, especially on Friday nights, and I enjoyed it. Certainly, I could and should go to more parties and make more friends, but I felt like that I didn't even have enough time for myself, I really could not afford time for someone I don't know. That being said, I did not feel lonely at all, I made a lot of incredible friends and had all kinds of brand new experience--like shooting guns, visiting countless museums and gazing at arts that I have only seen on books. Here is what I love here, you have a chance to do anything you love, of course legally, you do not have to worry about that you might miss something--it is always there, you only have to focus on the most important things right now and go for it whenever you like.\n\nI never regretted flying thousands of miles away from home and living in a completely new environment, cause I believed I would meet great people and I did. Nevertheless, I met some aimless people here, who claimed a goal but never fought for it. Most of the time, I was inspired by people surrounding me. In a data structure course I was auditing, the lecturer was a Ph.D. student in his 20s and an audience in the first row was a gray-haired gentleman perhaps in his 70s. It was just in harmony and no one doubted it.\n\n![Mac Room at library](mac_room.JPG)\n\nAnother person I respected the most was Andy Novocin. I considered him as my mentor though he was not technically my advisor. To a lot of people, being smart is an excuse for not being hard-working. Andy is never this type of person though he is one of the smartest guys I have ever seen. He got his doctor's degree at 24, but never stopped exploring and working. I feel like that the world would only be considered as fair when success only belongs to this type of person. Another thing I learned from him was that there is always a solution unless you don't want to find. Nowadays, there are really few problems you can not use Google to solve in daily life. I met a lot of people, who always asked others for help whenever encountering problems. I'm not saying this is a bad habit, especially after a long struggling, but at least, think about it, otherwise you'll never learn. When looking back at our life, we hardly remember the days when we laid on the sofa and watched TVs, but we had those struggling moments deep in memory. When those unsolved problems haunted us day and night, they became the most valuable recalls later in life.\n\n![Andy and I](andy.jpg)\n\n\n\nIf there is a lesson that I have learned in past 2 years, it must be--always keep an open mind to things you don't know before, you may love it in the end. People tend to judge emerging things based on their appearance, but when we take the time to think about what is behind, we will always explore something new and worthwhile.\n","source":"_posts/To-My-Graduation.markdown","raw":"---\ntitle:  \"To my graduation\"\ndate:   2017-5-27 12:23:22\ncatalog: true\nheader-img: \"campus.JPG\"\ntags: \n- Thoughts\ncatagories:\n- Thoughts\n---\n>This is not the end, this is not even the beginning of the end, but perhaps it is the end of beginning.\n\n![Graduation](graduation.jpg)\n\nI tend to make a summary at major moments in my life. Convocation is at tonight and commencement is tomorrow, and this is it.\n\nIf I look back at myself 2 years ago, I would feel like looking at a different person in terms of things I am working on daily. I'm not saying I am so knowledgeable right now, I just knew nothing about programming at all. I still remember the first class I took in UD--I watched the professor ssh to a server, operate files using bash command and using Vim to edit codes fluently and I had no idea what it was. I learned a little bit C in my undergraduate, but I only knew you had to include a certain library to print \"hello world\". Our first assignment had to be submitted in tar file compressed using a command, I did not even know I had to cd into the file folder to do that, but actually, I did not know what tar file was. The course was mainly about high-performance computing and our final project was to parallelize radix sort on Cuda. It assumed that students knew basic algorithms and C programming, but I did not even know what radix sort was, let alone optimize it. To be honest, I did not know any other sorting algorithms until I took the algorithm class the second semester.\nBut after endless online tutorials and office hours, we finally turned in our report and got an A on that. Well, it is easy talking about the whole experience afterwards, but you know what you have been through.\n\nHowever, it was until the first winter session when Will took me to Andy's front-end class that I found this was what I was looking for. Nothing had been better than the instant response and sense of accomplishment you received when coding. Then I embarked on a wonderful journey of web development and for the first time, I realized I loved coding so much. Ever since then, the Mac room at the lower level of the library has been the place that I spent most of my spare time. Even now, I am typing these words here. Sometimes, I am the only one in the room, especially on Friday nights, and I enjoyed it. Certainly, I could and should go to more parties and make more friends, but I felt like that I didn't even have enough time for myself, I really could not afford time for someone I don't know. That being said, I did not feel lonely at all, I made a lot of incredible friends and had all kinds of brand new experience--like shooting guns, visiting countless museums and gazing at arts that I have only seen on books. Here is what I love here, you have a chance to do anything you love, of course legally, you do not have to worry about that you might miss something--it is always there, you only have to focus on the most important things right now and go for it whenever you like.\n\nI never regretted flying thousands of miles away from home and living in a completely new environment, cause I believed I would meet great people and I did. Nevertheless, I met some aimless people here, who claimed a goal but never fought for it. Most of the time, I was inspired by people surrounding me. In a data structure course I was auditing, the lecturer was a Ph.D. student in his 20s and an audience in the first row was a gray-haired gentleman perhaps in his 70s. It was just in harmony and no one doubted it.\n\n![Mac Room at library](mac_room.JPG)\n\nAnother person I respected the most was Andy Novocin. I considered him as my mentor though he was not technically my advisor. To a lot of people, being smart is an excuse for not being hard-working. Andy is never this type of person though he is one of the smartest guys I have ever seen. He got his doctor's degree at 24, but never stopped exploring and working. I feel like that the world would only be considered as fair when success only belongs to this type of person. Another thing I learned from him was that there is always a solution unless you don't want to find. Nowadays, there are really few problems you can not use Google to solve in daily life. I met a lot of people, who always asked others for help whenever encountering problems. I'm not saying this is a bad habit, especially after a long struggling, but at least, think about it, otherwise you'll never learn. When looking back at our life, we hardly remember the days when we laid on the sofa and watched TVs, but we had those struggling moments deep in memory. When those unsolved problems haunted us day and night, they became the most valuable recalls later in life.\n\n![Andy and I](andy.jpg)\n\n\n\nIf there is a lesson that I have learned in past 2 years, it must be--always keep an open mind to things you don't know before, you may love it in the end. People tend to judge emerging things based on their appearance, but when we take the time to think about what is behind, we will always explore something new and worthwhile.\n","slug":"To-My-Graduation","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxq000bx18l5lwpp10t","content":"<blockquote>\n<p>This is not the end, this is not even the beginning of the end, but perhaps it is the end of beginning.</p>\n</blockquote>\n<p><img src=\"graduation.jpg\" alt=\"Graduation\"></p>\n<p>I tend to make a summary at major moments in my life. Convocation is at tonight and commencement is tomorrow, and this is it.</p>\n<p>If I look back at myself 2 years ago, I would feel like looking at a different person in terms of things I am working on daily. I’m not saying I am so knowledgeable right now, I just knew nothing about programming at all. I still remember the first class I took in UD–I watched the professor ssh to a server, operate files using bash command and using Vim to edit codes fluently and I had no idea what it was. I learned a little bit C in my undergraduate, but I only knew you had to include a certain library to print “hello world”. Our first assignment had to be submitted in tar file compressed using a command, I did not even know I had to cd into the file folder to do that, but actually, I did not know what tar file was. The course was mainly about high-performance computing and our final project was to parallelize radix sort on Cuda. It assumed that students knew basic algorithms and C programming, but I did not even know what radix sort was, let alone optimize it. To be honest, I did not know any other sorting algorithms until I took the algorithm class the second semester.<br>\nBut after endless online tutorials and office hours, we finally turned in our report and got an A on that. Well, it is easy talking about the whole experience afterwards, but you know what you have been through.</p>\n<p>However, it was until the first winter session when Will took me to Andy’s front-end class that I found this was what I was looking for. Nothing had been better than the instant response and sense of accomplishment you received when coding. Then I embarked on a wonderful journey of web development and for the first time, I realized I loved coding so much. Ever since then, the Mac room at the lower level of the library has been the place that I spent most of my spare time. Even now, I am typing these words here. Sometimes, I am the only one in the room, especially on Friday nights, and I enjoyed it. Certainly, I could and should go to more parties and make more friends, but I felt like that I didn’t even have enough time for myself, I really could not afford time for someone I don’t know. That being said, I did not feel lonely at all, I made a lot of incredible friends and had all kinds of brand new experience–like shooting guns, visiting countless museums and gazing at arts that I have only seen on books. Here is what I love here, you have a chance to do anything you love, of course legally, you do not have to worry about that you might miss something–it is always there, you only have to focus on the most important things right now and go for it whenever you like.</p>\n<p>I never regretted flying thousands of miles away from home and living in a completely new environment, cause I believed I would meet great people and I did. Nevertheless, I met some aimless people here, who claimed a goal but never fought for it. Most of the time, I was inspired by people surrounding me. In a data structure course I was auditing, the lecturer was a Ph.D. student in his 20s and an audience in the first row was a gray-haired gentleman perhaps in his 70s. It was just in harmony and no one doubted it.</p>\n<p><img src=\"mac_room.JPG\" alt=\"Mac Room at library\"></p>\n<p>Another person I respected the most was Andy Novocin. I considered him as my mentor though he was not technically my advisor. To a lot of people, being smart is an excuse for not being hard-working. Andy is never this type of person though he is one of the smartest guys I have ever seen. He got his doctor’s degree at 24, but never stopped exploring and working. I feel like that the world would only be considered as fair when success only belongs to this type of person. Another thing I learned from him was that there is always a solution unless you don’t want to find. Nowadays, there are really few problems you can not use Google to solve in daily life. I met a lot of people, who always asked others for help whenever encountering problems. I’m not saying this is a bad habit, especially after a long struggling, but at least, think about it, otherwise you’ll never learn. When looking back at our life, we hardly remember the days when we laid on the sofa and watched TVs, but we had those struggling moments deep in memory. When those unsolved problems haunted us day and night, they became the most valuable recalls later in life.</p>\n<p><img src=\"andy.jpg\" alt=\"Andy and I\"></p>\n<p>If there is a lesson that I have learned in past 2 years, it must be–always keep an open mind to things you don’t know before, you may love it in the end. People tend to judge emerging things based on their appearance, but when we take the time to think about what is behind, we will always explore something new and worthwhile.</p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>This is not the end, this is not even the beginning of the end, but perhaps it is the end of beginning.</p>\n</blockquote>\n<p><img src=\"graduation.jpg\" alt=\"Graduation\"></p>\n<p>I tend to make a summary at major moments in my life. Convocation is at tonight and commencement is tomorrow, and this is it.</p>\n<p>If I look back at myself 2 years ago, I would feel like looking at a different person in terms of things I am working on daily. I’m not saying I am so knowledgeable right now, I just knew nothing about programming at all. I still remember the first class I took in UD–I watched the professor ssh to a server, operate files using bash command and using Vim to edit codes fluently and I had no idea what it was. I learned a little bit C in my undergraduate, but I only knew you had to include a certain library to print “hello world”. Our first assignment had to be submitted in tar file compressed using a command, I did not even know I had to cd into the file folder to do that, but actually, I did not know what tar file was. The course was mainly about high-performance computing and our final project was to parallelize radix sort on Cuda. It assumed that students knew basic algorithms and C programming, but I did not even know what radix sort was, let alone optimize it. To be honest, I did not know any other sorting algorithms until I took the algorithm class the second semester.<br>\nBut after endless online tutorials and office hours, we finally turned in our report and got an A on that. Well, it is easy talking about the whole experience afterwards, but you know what you have been through.</p>\n<p>However, it was until the first winter session when Will took me to Andy’s front-end class that I found this was what I was looking for. Nothing had been better than the instant response and sense of accomplishment you received when coding. Then I embarked on a wonderful journey of web development and for the first time, I realized I loved coding so much. Ever since then, the Mac room at the lower level of the library has been the place that I spent most of my spare time. Even now, I am typing these words here. Sometimes, I am the only one in the room, especially on Friday nights, and I enjoyed it. Certainly, I could and should go to more parties and make more friends, but I felt like that I didn’t even have enough time for myself, I really could not afford time for someone I don’t know. That being said, I did not feel lonely at all, I made a lot of incredible friends and had all kinds of brand new experience–like shooting guns, visiting countless museums and gazing at arts that I have only seen on books. Here is what I love here, you have a chance to do anything you love, of course legally, you do not have to worry about that you might miss something–it is always there, you only have to focus on the most important things right now and go for it whenever you like.</p>\n<p>I never regretted flying thousands of miles away from home and living in a completely new environment, cause I believed I would meet great people and I did. Nevertheless, I met some aimless people here, who claimed a goal but never fought for it. Most of the time, I was inspired by people surrounding me. In a data structure course I was auditing, the lecturer was a Ph.D. student in his 20s and an audience in the first row was a gray-haired gentleman perhaps in his 70s. It was just in harmony and no one doubted it.</p>\n<p><img src=\"mac_room.JPG\" alt=\"Mac Room at library\"></p>\n<p>Another person I respected the most was Andy Novocin. I considered him as my mentor though he was not technically my advisor. To a lot of people, being smart is an excuse for not being hard-working. Andy is never this type of person though he is one of the smartest guys I have ever seen. He got his doctor’s degree at 24, but never stopped exploring and working. I feel like that the world would only be considered as fair when success only belongs to this type of person. Another thing I learned from him was that there is always a solution unless you don’t want to find. Nowadays, there are really few problems you can not use Google to solve in daily life. I met a lot of people, who always asked others for help whenever encountering problems. I’m not saying this is a bad habit, especially after a long struggling, but at least, think about it, otherwise you’ll never learn. When looking back at our life, we hardly remember the days when we laid on the sofa and watched TVs, but we had those struggling moments deep in memory. When those unsolved problems haunted us day and night, they became the most valuable recalls later in life.</p>\n<p><img src=\"andy.jpg\" alt=\"Andy and I\"></p>\n<p>If there is a lesson that I have learned in past 2 years, it must be–always keep an open mind to things you don’t know before, you may love it in the end. People tend to judge emerging things based on their appearance, but when we take the time to think about what is behind, we will always explore something new and worthwhile.</p>\n"},{"title":"Treechart In D3","catalog":true,"date":"2018-05-08T02:57:12.000Z","subtitle":"Interactive and responsive","header-img":"tree.jpg","_content":"\n# Interactive and responsive Tree Diagram in D3.js\n\nThe tree diagram is a very intuitive visualization to display the structure and relation between parent and child nodes. To give users a better interaction between different nodes, we could utilize the diagram from [Interactive d3.js tree diagram](http://bl.ocks.org/d3noob/8375092#index.html), make it more interactive and responsive.\n\n\n<html>\n\n\n<p data-height=\"669\" data-theme-id=\"0\" data-slug-hash=\"KoYbav\" data-default-tab=\"result\" data-user=\"HanchengZhao-1471862086\" data-embed-version=\"2\" data-pen-title=\"tree diagram expand\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/HanchengZhao-1471862086/pen/KoYbav/\">tree diagram expand</a> by Henry_Z (<a href=\"https://codepen.io/HanchengZhao-1471862086\">@HanchengZhao-1471862086</a>) on <a href=\"https://codepen.io\">CodePen</a>.</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n\n</html>\n\n\n\n\n## Prepare hierarchical tree node structure\n\nThe [default hierarchy](https://github.com/d3/d3-hierarchy#hierarchy) of a tree structure would be :\n```\n {\n   \"name\": \"Top Level\",\n   \"children\": [\n     { \n       \"name\": \"Level 2: A\",\n       \"children\": [\n         { \"name\": \"Son of A\" },\n         { \"name\": \"Daughter of A\" }\n       ]\n     },\n     { \"name\": \"Level 2: B\",\n       \"children\":[\n         { \"name\": \"Son of B\" },\n         { \"name\": \"Daughter of B\" }\n       ]\n     }\n   ]\n };\n```\nthe default function to traverse the children is:\n\n```js\nfunction children(d) {\n  return d.children;\n}\n```\nso if we want to pass a different structure, we need to pass a different function accordingly.\n\nFor our use case, we have an array of tags\n```\nvar fields =  [\n        \"id\",\n        \"name\",\n        \"tag.analytics.aggname\",\n        \"tag.analytics.jobname\",\n        \"tag.analytics.metric\",\n        \"tag.kubernetes.namespace.creationTimestamp\",\n        \"tag.kubernetes.namespace.name\",\n        ...\n    ]\n```\nHere's our function to build a tree from it:\n\n```js\nconst buildTree = (fields) => {\n  let tree = {\n    \"name\": \"tags\",\n    \"children\": []\n  }\n  \n  const addNodes = (tag) => {\n    for (let i = 0; i < root.children.length; i++) {\n      if (tag === root.children[i].name) {\n        root = root.children[i];\n        return;\n      } \n    }\n    root.children.push({\n      'name': tag,\n      children: []\n    })\n    root = root.children[root.children.length-1]\n  }\n  \n  fields.forEach((field) => {\n    tags = field.split('.');\n    root = tree;\n    tags.forEach(addNodes)\n  })\n  return tree;\n}\n```\nOnce we have the requested tree data, we can initialize our tree:\n```js\nvar root = d3.hierarchy(treeData, function(d) { return d.children; });\n```\n\n\n## Normalize for the current depth\nIn the  [Interactive d3.js tree diagram](http://bl.ocks.org/d3noob/8375092#index.html), the height between the parent and child nodes would not change in regards to the tree height. As a result, the width of the tree chart will expand out of the screen width if there are too many layers. However, this is not responsive and we do not want a scroll bar at the bottom, so we want the whole tree to 'shrink' according to the tree height.\n\n### Get current tree depth\n\nWe need to know the tree depth if we want to change the width dynamically. We could do this by a quick top-down traversal:\n\n```js\n/*\nroot.children are expanded children,\nroot._children are collapsed ones,\nwe only need to calculate expanded children when counting the tree height\n*/\nfunction getHeight(root) {\n  if (!root) {\n    return 0\n  }\n  let expandChildren = [0]\n  // if has expanded children\n  if (root.children) { \n    expandChildren = root.children.map(ea => getHeight(ea))\n  }\n  const max = expandChildren.reduce((a, b) => Math.max(a,b))\n  return 1 + max\n}\n```\n\n### Set each node's y position based on its current depth\n\n```js\n// inside update function\n\nvar currentHeight = getHeight(root);\n// Normalize for current-depth.\nnodes.forEach(function(d){ \n  d.y = d.depth * window.innerWidth / (currentHeight+ Math.log(currentHeight-1))\n});\n```\n## Handle window resize\n\nThe tree chart should resize when we change the inner window size. Firstly, we set the tree chart width to be \n```\nvar width = window.innerWidth - margin.left - margin.right\n```\nThen we add a listener to the window resizing, we can debounce it a little by using `_.debounce` from `lodash.js`\n\n```\nwindow.addEventListener('resize', _.debounce(function(){\n  update(root)\n}, 500));\n```\n## Handle collapse\n\nWe could collapse all but root node:\n\n```\n// Collapse the node and all it's children\nfunction collapse(d) {\n  if (d.children) {\n    d._children = d.children;\n    d._children.forEach(collapse);\n    d.children = null;\n  }\n}\ncollapse(root)\n```\n\nThen expand the nodes on the given path or key:\n\n```js\n//Expand the tree based on key\nfunction expandOnKey(key, root) {\n  var node = root;\n  var tags = key.split(\".\");\n  while (tags.length > 0) {\n    var found = false;\n    var next = tags[0]\n    if (node._children) {\n      node._children.forEach((child) => {\n        if (child.data.name === next) {\n          // expand this node\n          node.children = node._children;\n          node._children = null;\n          node = child;\n          found = true;\n        }\n      })\n    }\n    if (found) {\n      tags.shift()\n    } else {\n      return;\n    }\n  }\n}\n```\n\n## Handle click\n\nWe want to display 2 effects:\n* highlight the path and node when clicking on the leaf node\n* expand/collapse the subtree when clicking on non-leaf nodes\n\n```\n// Toggle children on click.\n  const click = d => {\n    if (!d.children && !d._children) {\n      //leaf node\n      const key = getPath(d);\n      this.setState({ key });\n      d.path = key;\n      this.fetchAvailableValues(key);\n    }\n    //d.children is collapsed children\n    //d._children is expanded children\n    if (d.children) {\n      d._children = d.children;\n      d.children = null;\n    } else {\n      d.children = d._children;\n      d._children = null;\n    }\n    update(d);\n     };\n```\n### Get path\n\n```\n// return the path from root to this node\n  function getPath(d) {\n    var path = [];\n    while (d.parent !== null) {\n      path.unshift(d.data.name);\n      d = d.parent;\n    }\n    return path.join('.');\n  }\n```\n\n### Highlight the clicked node\n```\n// Update the node attributes and style\n  nodeUpdate.select('circle.node')\n    .attr('r', 10)\n    .style(\"fill\", function(d) {\n        if (getPath(d) === key) {\n            // clicked leaf node\n            return '#F88C36';\n          } \n        return d._children ? \"lightsteelblue\" : \"#fff\";\n    })\n    .attr('cursor', 'pointer');\n```\n\n### Highlight the matched path\n\nIf we are given a path `var key = \"tag.kubernetes.pod.label.release\";`, we could mark each node on the path as `node.class = 'match'` when we expand the tree. Then we highlight the link between those marked nodes:\n```\n// Transition back to the parent element position\n  linkUpdate.transition()\n      .duration(duration)\n      .attr('d', function(d){ return diagonal(d, d.parent) })\n      .style(\"stroke\", function(d){\n          if(d.class === 'match') {\n            return '#3fb986'\n          }\n        });\n```\n\n## Integrate D3 with react\n\nA lot of web apps are built with react, what if you want to render a D3 chart inside react app?\n\nBoth libraries are declarative and provide a wrapper on top of native dom. We might have conflicts when we are trying to integrate them. So a common way to do is to expose dom through `ref` in react to D3. It's like isolating a land for D3 to play with itself.\n\nIn the meantime, we can put some attributes in theReact state to trigger re-rendering when necessary.\n\nInside `render()` function, set\n\n```html\n <div ref={node => (this.node = node)} />\n```\n\nthen in d3:\n\n```js\ncreateTreeChart = fields => {\n    const node = this.node;\n    ...\n}\n```","source":"_posts/Treechart-In-D3.md","raw":"---\ntitle: Treechart In D3\ncatalog: true\ndate: 2018-05-07 22:57:12\nsubtitle: Interactive and responsive\nheader-img: tree.jpg\ntags: \n- D3.js\n- React.js\n---\n\n# Interactive and responsive Tree Diagram in D3.js\n\nThe tree diagram is a very intuitive visualization to display the structure and relation between parent and child nodes. To give users a better interaction between different nodes, we could utilize the diagram from [Interactive d3.js tree diagram](http://bl.ocks.org/d3noob/8375092#index.html), make it more interactive and responsive.\n\n\n<html>\n\n\n<p data-height=\"669\" data-theme-id=\"0\" data-slug-hash=\"KoYbav\" data-default-tab=\"result\" data-user=\"HanchengZhao-1471862086\" data-embed-version=\"2\" data-pen-title=\"tree diagram expand\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/HanchengZhao-1471862086/pen/KoYbav/\">tree diagram expand</a> by Henry_Z (<a href=\"https://codepen.io/HanchengZhao-1471862086\">@HanchengZhao-1471862086</a>) on <a href=\"https://codepen.io\">CodePen</a>.</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n\n</html>\n\n\n\n\n## Prepare hierarchical tree node structure\n\nThe [default hierarchy](https://github.com/d3/d3-hierarchy#hierarchy) of a tree structure would be :\n```\n {\n   \"name\": \"Top Level\",\n   \"children\": [\n     { \n       \"name\": \"Level 2: A\",\n       \"children\": [\n         { \"name\": \"Son of A\" },\n         { \"name\": \"Daughter of A\" }\n       ]\n     },\n     { \"name\": \"Level 2: B\",\n       \"children\":[\n         { \"name\": \"Son of B\" },\n         { \"name\": \"Daughter of B\" }\n       ]\n     }\n   ]\n };\n```\nthe default function to traverse the children is:\n\n```js\nfunction children(d) {\n  return d.children;\n}\n```\nso if we want to pass a different structure, we need to pass a different function accordingly.\n\nFor our use case, we have an array of tags\n```\nvar fields =  [\n        \"id\",\n        \"name\",\n        \"tag.analytics.aggname\",\n        \"tag.analytics.jobname\",\n        \"tag.analytics.metric\",\n        \"tag.kubernetes.namespace.creationTimestamp\",\n        \"tag.kubernetes.namespace.name\",\n        ...\n    ]\n```\nHere's our function to build a tree from it:\n\n```js\nconst buildTree = (fields) => {\n  let tree = {\n    \"name\": \"tags\",\n    \"children\": []\n  }\n  \n  const addNodes = (tag) => {\n    for (let i = 0; i < root.children.length; i++) {\n      if (tag === root.children[i].name) {\n        root = root.children[i];\n        return;\n      } \n    }\n    root.children.push({\n      'name': tag,\n      children: []\n    })\n    root = root.children[root.children.length-1]\n  }\n  \n  fields.forEach((field) => {\n    tags = field.split('.');\n    root = tree;\n    tags.forEach(addNodes)\n  })\n  return tree;\n}\n```\nOnce we have the requested tree data, we can initialize our tree:\n```js\nvar root = d3.hierarchy(treeData, function(d) { return d.children; });\n```\n\n\n## Normalize for the current depth\nIn the  [Interactive d3.js tree diagram](http://bl.ocks.org/d3noob/8375092#index.html), the height between the parent and child nodes would not change in regards to the tree height. As a result, the width of the tree chart will expand out of the screen width if there are too many layers. However, this is not responsive and we do not want a scroll bar at the bottom, so we want the whole tree to 'shrink' according to the tree height.\n\n### Get current tree depth\n\nWe need to know the tree depth if we want to change the width dynamically. We could do this by a quick top-down traversal:\n\n```js\n/*\nroot.children are expanded children,\nroot._children are collapsed ones,\nwe only need to calculate expanded children when counting the tree height\n*/\nfunction getHeight(root) {\n  if (!root) {\n    return 0\n  }\n  let expandChildren = [0]\n  // if has expanded children\n  if (root.children) { \n    expandChildren = root.children.map(ea => getHeight(ea))\n  }\n  const max = expandChildren.reduce((a, b) => Math.max(a,b))\n  return 1 + max\n}\n```\n\n### Set each node's y position based on its current depth\n\n```js\n// inside update function\n\nvar currentHeight = getHeight(root);\n// Normalize for current-depth.\nnodes.forEach(function(d){ \n  d.y = d.depth * window.innerWidth / (currentHeight+ Math.log(currentHeight-1))\n});\n```\n## Handle window resize\n\nThe tree chart should resize when we change the inner window size. Firstly, we set the tree chart width to be \n```\nvar width = window.innerWidth - margin.left - margin.right\n```\nThen we add a listener to the window resizing, we can debounce it a little by using `_.debounce` from `lodash.js`\n\n```\nwindow.addEventListener('resize', _.debounce(function(){\n  update(root)\n}, 500));\n```\n## Handle collapse\n\nWe could collapse all but root node:\n\n```\n// Collapse the node and all it's children\nfunction collapse(d) {\n  if (d.children) {\n    d._children = d.children;\n    d._children.forEach(collapse);\n    d.children = null;\n  }\n}\ncollapse(root)\n```\n\nThen expand the nodes on the given path or key:\n\n```js\n//Expand the tree based on key\nfunction expandOnKey(key, root) {\n  var node = root;\n  var tags = key.split(\".\");\n  while (tags.length > 0) {\n    var found = false;\n    var next = tags[0]\n    if (node._children) {\n      node._children.forEach((child) => {\n        if (child.data.name === next) {\n          // expand this node\n          node.children = node._children;\n          node._children = null;\n          node = child;\n          found = true;\n        }\n      })\n    }\n    if (found) {\n      tags.shift()\n    } else {\n      return;\n    }\n  }\n}\n```\n\n## Handle click\n\nWe want to display 2 effects:\n* highlight the path and node when clicking on the leaf node\n* expand/collapse the subtree when clicking on non-leaf nodes\n\n```\n// Toggle children on click.\n  const click = d => {\n    if (!d.children && !d._children) {\n      //leaf node\n      const key = getPath(d);\n      this.setState({ key });\n      d.path = key;\n      this.fetchAvailableValues(key);\n    }\n    //d.children is collapsed children\n    //d._children is expanded children\n    if (d.children) {\n      d._children = d.children;\n      d.children = null;\n    } else {\n      d.children = d._children;\n      d._children = null;\n    }\n    update(d);\n     };\n```\n### Get path\n\n```\n// return the path from root to this node\n  function getPath(d) {\n    var path = [];\n    while (d.parent !== null) {\n      path.unshift(d.data.name);\n      d = d.parent;\n    }\n    return path.join('.');\n  }\n```\n\n### Highlight the clicked node\n```\n// Update the node attributes and style\n  nodeUpdate.select('circle.node')\n    .attr('r', 10)\n    .style(\"fill\", function(d) {\n        if (getPath(d) === key) {\n            // clicked leaf node\n            return '#F88C36';\n          } \n        return d._children ? \"lightsteelblue\" : \"#fff\";\n    })\n    .attr('cursor', 'pointer');\n```\n\n### Highlight the matched path\n\nIf we are given a path `var key = \"tag.kubernetes.pod.label.release\";`, we could mark each node on the path as `node.class = 'match'` when we expand the tree. Then we highlight the link between those marked nodes:\n```\n// Transition back to the parent element position\n  linkUpdate.transition()\n      .duration(duration)\n      .attr('d', function(d){ return diagonal(d, d.parent) })\n      .style(\"stroke\", function(d){\n          if(d.class === 'match') {\n            return '#3fb986'\n          }\n        });\n```\n\n## Integrate D3 with react\n\nA lot of web apps are built with react, what if you want to render a D3 chart inside react app?\n\nBoth libraries are declarative and provide a wrapper on top of native dom. We might have conflicts when we are trying to integrate them. So a common way to do is to expose dom through `ref` in react to D3. It's like isolating a land for D3 to play with itself.\n\nIn the meantime, we can put some attributes in theReact state to trigger re-rendering when necessary.\n\nInside `render()` function, set\n\n```html\n <div ref={node => (this.node = node)} />\n```\n\nthen in d3:\n\n```js\ncreateTreeChart = fields => {\n    const node = this.node;\n    ...\n}\n```","slug":"Treechart-In-D3","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxr000dx18ldf1vbphn","content":"<h1 id=\"interactive-and-responsive-tree-diagram-in-d3js\">Interactive and responsive Tree Diagram in D3.js</h1>\n<p>The tree diagram is a very intuitive visualization to display the structure and relation between parent and child nodes. To give users a better interaction between different nodes, we could utilize the diagram from <a href=\"http://bl.ocks.org/d3noob/8375092#index.html\" target=\"_blank\" rel=\"noopener\">Interactive d3.js tree diagram</a>, make it more interactive and responsive.</p>\n<html>\n<p data-height=\"669\" data-theme-id=\"0\" data-slug-hash=\"KoYbav\" data-default-tab=\"result\" data-user=\"HanchengZhao-1471862086\" data-embed-version=\"2\" data-pen-title=\"tree diagram expand\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/HanchengZhao-1471862086/pen/KoYbav/\" target=\"_blank\" rel=\"noopener\">tree diagram expand</a> by Henry_Z (<a href=\"https://codepen.io/HanchengZhao-1471862086\" target=\"_blank\" rel=\"noopener\">@HanchengZhao-1471862086</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n</html>\n<h2 id=\"prepare-hierarchical-tree-node-structure\">Prepare hierarchical tree node structure</h2>\n<p>The <a href=\"https://github.com/d3/d3-hierarchy#hierarchy\" target=\"_blank\" rel=\"noopener\">default hierarchy</a> of a tree structure would be :</p>\n<figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Top Level\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"children\"</span>: [</span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Level 2: A\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"children\"</span>: [</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Son of A\"</span> &#125;,</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Daughter of A\"</span> &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Level 2: B\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"children\"</span>:[</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Son of B\"</span> &#125;,</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Daughter of B\"</span> &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<p>the default function to traverse the children is:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">children</span>(<span class=\"params\">d</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> d.children;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>so if we want to pass a different structure, we need to pass a different function accordingly.</p>\n<p>For our use case, we have an array of tags</p>\n<figure class=\"highlight lasso\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">var</span> fields =  <span class=\"meta\">[</span></span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"name\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.analytics.aggname\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.analytics.jobname\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.analytics.metric\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.kubernetes.namespace.creationTimestamp\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.kubernetes.namespace.name\"</span>,</span><br><span class=\"line\">        <span class=\"params\">...</span></span><br><span class=\"line\">    <span class=\"meta\">]</span></span><br></pre></td></tr></table></figure>\n<p>Here’s our function to build a tree from it:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> buildTree = <span class=\"function\">(<span class=\"params\">fields</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> tree = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"name\"</span>: <span class=\"string\">\"tags\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"children\"</span>: []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">const</span> addNodes = <span class=\"function\">(<span class=\"params\">tag</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; root.children.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (tag === root.children[i].name) &#123;</span><br><span class=\"line\">        root = root.children[i];</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    root.children.push(&#123;</span><br><span class=\"line\">      <span class=\"string\">'name'</span>: tag,</span><br><span class=\"line\">      children: []</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    root = root.children[root.children.length<span class=\"number\">-1</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  fields.forEach(<span class=\"function\">(<span class=\"params\">field</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    tags = field.split(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">    root = tree;</span><br><span class=\"line\">    tags.forEach(addNodes)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> tree;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Once we have the requested tree data, we can initialize our tree:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> root = d3.hierarchy(treeData, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">d</span>) </span>&#123; <span class=\"keyword\">return</span> d.children; &#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"normalize-for-the-current-depth\">Normalize for the current depth</h2>\n<p>In the  <a href=\"http://bl.ocks.org/d3noob/8375092#index.html\" target=\"_blank\" rel=\"noopener\">Interactive d3.js tree diagram</a>, the height between the parent and child nodes would not change in regards to the tree height. As a result, the width of the tree chart will expand out of the screen width if there are too many layers. However, this is not responsive and we do not want a scroll bar at the bottom, so we want the whole tree to ‘shrink’ according to the tree height.</p>\n<h3 id=\"get-current-tree-depth\">Get current tree depth</h3>\n<p>We need to know the tree depth if we want to change the width dynamically. We could do this by a quick top-down traversal:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">root.children are expanded children,</span></span><br><span class=\"line\"><span class=\"comment\">root._children are collapsed ones,</span></span><br><span class=\"line\"><span class=\"comment\">we only need to calculate expanded children when counting the tree height</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getHeight</span>(<span class=\"params\">root</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!root) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> expandChildren = [<span class=\"number\">0</span>]</span><br><span class=\"line\">  <span class=\"comment\">// if has expanded children</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (root.children) &#123; </span><br><span class=\"line\">    expandChildren = root.children.map(<span class=\"function\"><span class=\"params\">ea</span> =&gt;</span> getHeight(ea))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> max = expandChildren.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> <span class=\"built_in\">Math</span>.max(a,b))</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span> + max</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"set-each-nodes-y-position-based-on-its-current-depth\">Set each node’s y position based on its current depth</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// inside update function</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> currentHeight = getHeight(root);</span><br><span class=\"line\"><span class=\"comment\">// Normalize for current-depth.</span></span><br><span class=\"line\">nodes.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">d</span>)</span>&#123; </span><br><span class=\"line\">  d.y = d.depth * <span class=\"built_in\">window</span>.innerWidth / (currentHeight+ <span class=\"built_in\">Math</span>.log(currentHeight<span class=\"number\">-1</span>))</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"handle-window-resize\">Handle window resize</h2>\n<p>The tree chart should resize when we change the inner window size. Firstly, we set the tree chart width to be</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> width = window.innerWidth - margin.<span class=\"keyword\">left</span> - margin.<span class=\"keyword\">right</span></span><br></pre></td></tr></table></figure>\n<p>Then we add a listener to the window resizing, we can debounce it a little by using <code>_.debounce</code> from <code>lodash.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, _.debounce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  update(root)</span><br><span class=\"line\">&#125;, <span class=\"number\">500</span>));</span><br></pre></td></tr></table></figure>\n<h2 id=\"handle-collapse\">Handle collapse</h2>\n<p>We could collapse all but root node:</p>\n<figure class=\"highlight openscad\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Collapse the node and all it's children</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">collapse</span><span class=\"params\">(d)</span> &#123;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (d.<span class=\"built_in\">children</span>) &#123;</span><br><span class=\"line\">    d._children = d.<span class=\"built_in\">children</span>;</span><br><span class=\"line\">    d._children.forEach(collapse);</span><br><span class=\"line\">    d.<span class=\"built_in\">children</span> = null;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">collapse(root)</span><br></pre></td></tr></table></figure>\n<p>Then expand the nodes on the given path or key:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Expand the tree based on key</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">expandOnKey</span>(<span class=\"params\">key, root</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> node = root;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tags = key.split(<span class=\"string\">\".\"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (tags.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> found = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> next = tags[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node._children) &#123;</span><br><span class=\"line\">      node._children.forEach(<span class=\"function\">(<span class=\"params\">child</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (child.data.name === next) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// expand this node</span></span><br><span class=\"line\">          node.children = node._children;</span><br><span class=\"line\">          node._children = <span class=\"literal\">null</span>;</span><br><span class=\"line\">          node = child;</span><br><span class=\"line\">          found = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (found) &#123;</span><br><span class=\"line\">      tags.shift()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"handle-click\">Handle click</h2>\n<p>We want to display 2 effects:</p>\n<ul>\n<li>highlight the path and node when clicking on the leaf node</li>\n<li>expand/collapse the subtree when clicking on non-leaf nodes</li>\n</ul>\n<figure class=\"highlight processing\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Toggle children on click.</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> click = d =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!d.children &amp;&amp; !d._children) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//leaf node</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> <span class=\"built_in\">key</span> = getPath(d);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123; <span class=\"built_in\">key</span> &#125;);</span><br><span class=\"line\">      d.path = <span class=\"built_in\">key</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.fetchAvailableValues(<span class=\"built_in\">key</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//d.children is collapsed children</span></span><br><span class=\"line\">    <span class=\"comment\">//d._children is expanded children</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d.children) &#123;</span><br><span class=\"line\">      d._children = d.children;</span><br><span class=\"line\">      d.children = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      d.children = d._children;</span><br><span class=\"line\">      d._children = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    update(d);</span><br><span class=\"line\">     &#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"get-path\">Get path</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// return the path from root to this node</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPath</span><span class=\"params\">(d)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> path = [];</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (d.<span class=\"keyword\">parent</span> !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      path.unshift(d.data.name);</span><br><span class=\"line\">      d = d.<span class=\"keyword\">parent</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> path.join(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"highlight-the-clicked-node\">Highlight the clicked node</h3>\n<figure class=\"highlight scilab\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Update the node attributes and style</span></span><br><span class=\"line\">  nodeUpdate.<span class=\"keyword\">select</span>(<span class=\"string\">'circle.node'</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">'r'</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">    .style(<span class=\"string\">\"fill\"</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span> &#123;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getPath(d) === key) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// clicked leaf node</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">'#F88C36'</span>;</span><br><span class=\"line\">          &#125; </span><br><span class=\"line\">        <span class=\"keyword\">return</span> d._children ? <span class=\"string\">\"lightsteelblue\"</span> : <span class=\"string\">\"#fff\"</span>;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .attr(<span class=\"string\">'cursor'</span>, <span class=\"string\">'pointer'</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"highlight-the-matched-path\">Highlight the matched path</h3>\n<p>If we are given a path <code>var key = &quot;tag.kubernetes.pod.label.release&quot;;</code>, we could mark each node on the path as <code>node.class = 'match'</code> when we expand the tree. Then we highlight the link between those marked nodes:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Transition back to the parent element position</span></span><br><span class=\"line\">  linkUpdate.transition()</span><br><span class=\"line\">      .duration(duration)</span><br><span class=\"line\">      .attr(<span class=\"string\">'d'</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span></span>&#123; <span class=\"keyword\">return</span> diagonal(d, d.<span class=\"keyword\">parent</span>) &#125;)</span><br><span class=\"line\">      .style(<span class=\"string\">\"stroke\"</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span></span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(d.class === <span class=\"string\">'match'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">'#3fb986'</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"integrate-d3-with-react\">Integrate D3 with react</h2>\n<p>A lot of web apps are built with react, what if you want to render a D3 chart inside react app?</p>\n<p>Both libraries are declarative and provide a wrapper on top of native dom. We might have conflicts when we are trying to integrate them. So a common way to do is to expose dom through <code>ref</code> in react to D3. It’s like isolating a land for D3 to play with itself.</p>\n<p>In the meantime, we can put some attributes in theReact state to trigger re-rendering when necessary.</p>\n<p>Inside <code>render()</code> function, set</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;node</span> =&gt;</span> (this.node = node)&#125; /&gt;</span><br></pre></td></tr></table></figure>\n<p>then in d3:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">createTreeChart = <span class=\"function\"><span class=\"params\">fields</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"keyword\">this</span>.node;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1>Interactive and responsive Tree Diagram in D3.js</h1>\n<p>The tree diagram is a very intuitive visualization to display the structure and relation between parent and child nodes. To give users a better interaction between different nodes, we could utilize the diagram from <a href=\"http://bl.ocks.org/d3noob/8375092#index.html\" target=\"_blank\" rel=\"noopener\">Interactive d3.js tree diagram</a>, make it more interactive and responsive.</p>\n<html>\n<p data-height=\"669\" data-theme-id=\"0\" data-slug-hash=\"KoYbav\" data-default-tab=\"result\" data-user=\"HanchengZhao-1471862086\" data-embed-version=\"2\" data-pen-title=\"tree diagram expand\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/HanchengZhao-1471862086/pen/KoYbav/\" target=\"_blank\" rel=\"noopener\">tree diagram expand</a> by Henry_Z (<a href=\"https://codepen.io/HanchengZhao-1471862086\" target=\"_blank\" rel=\"noopener\">@HanchengZhao-1471862086</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.</p>\n<script async src=\"https://static.codepen.io/assets/embed/ei.js\"></script>\n</html>\n<h2>Prepare hierarchical tree node structure</h2>\n<p>The <a href=\"https://github.com/d3/d3-hierarchy#hierarchy\" target=\"_blank\" rel=\"noopener\">default hierarchy</a> of a tree structure would be :</p>\n<figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Top Level\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"children\"</span>: [</span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">      <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Level 2: A\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"children\"</span>: [</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Son of A\"</span> &#125;,</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Daughter of A\"</span> &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Level 2: B\"</span>,</span><br><span class=\"line\">      <span class=\"string\">\"children\"</span>:[</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Son of B\"</span> &#125;,</span><br><span class=\"line\">        &#123; <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Daughter of B\"</span> &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<p>the default function to traverse the children is:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">children</span>(<span class=\"params\">d</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> d.children;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>so if we want to pass a different structure, we need to pass a different function accordingly.</p>\n<p>For our use case, we have an array of tags</p>\n<figure class=\"highlight lasso\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">var</span> fields =  <span class=\"meta\">[</span></span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"name\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.analytics.aggname\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.analytics.jobname\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.analytics.metric\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.kubernetes.namespace.creationTimestamp\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"tag.kubernetes.namespace.name\"</span>,</span><br><span class=\"line\">        <span class=\"params\">...</span></span><br><span class=\"line\">    <span class=\"meta\">]</span></span><br></pre></td></tr></table></figure>\n<p>Here’s our function to build a tree from it:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> buildTree = <span class=\"function\">(<span class=\"params\">fields</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> tree = &#123;</span><br><span class=\"line\">    <span class=\"string\">\"name\"</span>: <span class=\"string\">\"tags\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"children\"</span>: []</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">const</span> addNodes = <span class=\"function\">(<span class=\"params\">tag</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; root.children.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (tag === root.children[i].name) &#123;</span><br><span class=\"line\">        root = root.children[i];</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    root.children.push(&#123;</span><br><span class=\"line\">      <span class=\"string\">'name'</span>: tag,</span><br><span class=\"line\">      children: []</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    root = root.children[root.children.length<span class=\"number\">-1</span>]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  fields.forEach(<span class=\"function\">(<span class=\"params\">field</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    tags = field.split(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">    root = tree;</span><br><span class=\"line\">    tags.forEach(addNodes)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> tree;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Once we have the requested tree data, we can initialize our tree:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> root = d3.hierarchy(treeData, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">d</span>) </span>&#123; <span class=\"keyword\">return</span> d.children; &#125;);</span><br></pre></td></tr></table></figure>\n<h2>Normalize for the current depth</h2>\n<p>In the  <a href=\"http://bl.ocks.org/d3noob/8375092#index.html\" target=\"_blank\" rel=\"noopener\">Interactive d3.js tree diagram</a>, the height between the parent and child nodes would not change in regards to the tree height. As a result, the width of the tree chart will expand out of the screen width if there are too many layers. However, this is not responsive and we do not want a scroll bar at the bottom, so we want the whole tree to ‘shrink’ according to the tree height.</p>\n<h3>Get current tree depth</h3>\n<p>We need to know the tree depth if we want to change the width dynamically. We could do this by a quick top-down traversal:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">root.children are expanded children,</span></span><br><span class=\"line\"><span class=\"comment\">root._children are collapsed ones,</span></span><br><span class=\"line\"><span class=\"comment\">we only need to calculate expanded children when counting the tree height</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getHeight</span>(<span class=\"params\">root</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!root) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> expandChildren = [<span class=\"number\">0</span>]</span><br><span class=\"line\">  <span class=\"comment\">// if has expanded children</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (root.children) &#123; </span><br><span class=\"line\">    expandChildren = root.children.map(<span class=\"function\"><span class=\"params\">ea</span> =&gt;</span> getHeight(ea))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> max = expandChildren.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> <span class=\"built_in\">Math</span>.max(a,b))</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">1</span> + max</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3>Set each node’s y position based on its current depth</h3>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// inside update function</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> currentHeight = getHeight(root);</span><br><span class=\"line\"><span class=\"comment\">// Normalize for current-depth.</span></span><br><span class=\"line\">nodes.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">d</span>)</span>&#123; </span><br><span class=\"line\">  d.y = d.depth * <span class=\"built_in\">window</span>.innerWidth / (currentHeight+ <span class=\"built_in\">Math</span>.log(currentHeight<span class=\"number\">-1</span>))</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2>Handle window resize</h2>\n<p>The tree chart should resize when we change the inner window size. Firstly, we set the tree chart width to be</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> width = window.innerWidth - margin.<span class=\"keyword\">left</span> - margin.<span class=\"keyword\">right</span></span><br></pre></td></tr></table></figure>\n<p>Then we add a listener to the window resizing, we can debounce it a little by using <code>_.debounce</code> from <code>lodash.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'resize'</span>, _.debounce(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  update(root)</span><br><span class=\"line\">&#125;, <span class=\"number\">500</span>));</span><br></pre></td></tr></table></figure>\n<h2>Handle collapse</h2>\n<p>We could collapse all but root node:</p>\n<figure class=\"highlight openscad\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Collapse the node and all it's children</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">collapse</span><span class=\"params\">(d)</span> &#123;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (d.<span class=\"built_in\">children</span>) &#123;</span><br><span class=\"line\">    d._children = d.<span class=\"built_in\">children</span>;</span><br><span class=\"line\">    d._children.forEach(collapse);</span><br><span class=\"line\">    d.<span class=\"built_in\">children</span> = null;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">collapse(root)</span><br></pre></td></tr></table></figure>\n<p>Then expand the nodes on the given path or key:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Expand the tree based on key</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">expandOnKey</span>(<span class=\"params\">key, root</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> node = root;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> tags = key.split(<span class=\"string\">\".\"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (tags.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> found = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> next = tags[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (node._children) &#123;</span><br><span class=\"line\">      node._children.forEach(<span class=\"function\">(<span class=\"params\">child</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (child.data.name === next) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// expand this node</span></span><br><span class=\"line\">          node.children = node._children;</span><br><span class=\"line\">          node._children = <span class=\"literal\">null</span>;</span><br><span class=\"line\">          node = child;</span><br><span class=\"line\">          found = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (found) &#123;</span><br><span class=\"line\">      tags.shift()</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2>Handle click</h2>\n<p>We want to display 2 effects:</p>\n<ul>\n<li>highlight the path and node when clicking on the leaf node</li>\n<li>expand/collapse the subtree when clicking on non-leaf nodes</li>\n</ul>\n<figure class=\"highlight processing\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Toggle children on click.</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> click = d =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!d.children &amp;&amp; !d._children) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//leaf node</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> <span class=\"built_in\">key</span> = getPath(d);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123; <span class=\"built_in\">key</span> &#125;);</span><br><span class=\"line\">      d.path = <span class=\"built_in\">key</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.fetchAvailableValues(<span class=\"built_in\">key</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//d.children is collapsed children</span></span><br><span class=\"line\">    <span class=\"comment\">//d._children is expanded children</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (d.children) &#123;</span><br><span class=\"line\">      d._children = d.children;</span><br><span class=\"line\">      d.children = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      d.children = d._children;</span><br><span class=\"line\">      d._children = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    update(d);</span><br><span class=\"line\">     &#125;;</span><br></pre></td></tr></table></figure>\n<h3>Get path</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// return the path from root to this node</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getPath</span><span class=\"params\">(d)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> path = [];</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (d.<span class=\"keyword\">parent</span> !== <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      path.unshift(d.data.name);</span><br><span class=\"line\">      d = d.<span class=\"keyword\">parent</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> path.join(<span class=\"string\">'.'</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<h3>Highlight the clicked node</h3>\n<figure class=\"highlight scilab\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Update the node attributes and style</span></span><br><span class=\"line\">  nodeUpdate.<span class=\"keyword\">select</span>(<span class=\"string\">'circle.node'</span>)</span><br><span class=\"line\">    .attr(<span class=\"string\">'r'</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">    .style(<span class=\"string\">\"fill\"</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span> &#123;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getPath(d) === key) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// clicked leaf node</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">'#F88C36'</span>;</span><br><span class=\"line\">          &#125; </span><br><span class=\"line\">        <span class=\"keyword\">return</span> d._children ? <span class=\"string\">\"lightsteelblue\"</span> : <span class=\"string\">\"#fff\"</span>;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .attr(<span class=\"string\">'cursor'</span>, <span class=\"string\">'pointer'</span>);</span><br></pre></td></tr></table></figure>\n<h3>Highlight the matched path</h3>\n<p>If we are given a path <code>var key = &quot;tag.kubernetes.pod.label.release&quot;;</code>, we could mark each node on the path as <code>node.class = 'match'</code> when we expand the tree. Then we highlight the link between those marked nodes:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Transition back to the parent element position</span></span><br><span class=\"line\">  linkUpdate.transition()</span><br><span class=\"line\">      .duration(duration)</span><br><span class=\"line\">      .attr(<span class=\"string\">'d'</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span></span>&#123; <span class=\"keyword\">return</span> diagonal(d, d.<span class=\"keyword\">parent</span>) &#125;)</span><br><span class=\"line\">      .style(<span class=\"string\">\"stroke\"</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(d)</span></span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(d.class === <span class=\"string\">'match'</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">'#3fb986'</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n<h2>Integrate D3 with react</h2>\n<p>A lot of web apps are built with react, what if you want to render a D3 chart inside react app?</p>\n<p>Both libraries are declarative and provide a wrapper on top of native dom. We might have conflicts when we are trying to integrate them. So a common way to do is to expose dom through <code>ref</code> in react to D3. It’s like isolating a land for D3 to play with itself.</p>\n<p>In the meantime, we can put some attributes in theReact state to trigger re-rendering when necessary.</p>\n<p>Inside <code>render()</code> function, set</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;node</span> =&gt;</span> (this.node = node)&#125; /&gt;</span><br></pre></td></tr></table></figure>\n<p>then in d3:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">createTreeChart = <span class=\"function\"><span class=\"params\">fields</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> node = <span class=\"keyword\">this</span>.node;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Deploy a react app in kubernetes","catalog":true,"date":"2018-01-13T15:05:28.000Z","subtitle":null,"header-img":"tree.jpg","_content":"\n## Task: Deploy a react app in kubernetes \n> make sure cli tools such as node, docker, kubectl are installed\n\n## Steps:\n1. Use [create-react-app](https://github.com/facebookincubator/create-react-app) tool to generate a new project\n    - `create-react-app new-app`\n    - `cd new-app`\n2. Configure a [Dockerfile](https://docs.docker.com/engine/reference/builder/) for the react app\n    - use [alpine-node](https://github.com/mhart/alpine-node) as base docker image(Minimal Node.js Docker Images)\n        ```docker\n        # example\n        # create a production build\n        FROM mhart/alpine-node AS build\n        WORKDIR /app\n        COPY . .\n        RUN npm run build\n        \n        #serve the built app\n        FROM mhart/alpine-node\n        RUN npm install -g serve\n        WORKDIR /app\n        COPY --from=build /app/build .\n        CMD [ \"serve\", \"-p 80\", \"-s\", \".\"]\n        ```\n    - build the image: `docker build -t $repo-name .`\n    - run it with `docker run -p 8080:80 $repo-name`, go to `localhost:8080`\n3. Deploy your app to kubenetes cluster\n    - push your local image to a remote repo: `$ docker push $DOCKER_ID_USER/repo:tag` to docker hub \n    - create a new deployment: `kubectl run $deployment-name --image=$image-location --port=80`\n    - expose your service through NodePort: `kubectl expose deployment/$deployment-name --type=\"NodePort\" --port 80`\n    - get the node $name: `kubectl get node`\n    - get the service external $port: `kubectl describe services/$service-name`\n    - check the app out in the brower: `$nodename:$port`\n\n## References \n\n- [Running React app inside a Docker container](https://hackernoon.com/running-react-app-inside-a-docker-container-27136a75916b)\n- [Building and Deploying a Containerised React App and Microservice Using the Same OpenAPI Contract](http://connect.cd/2017/11/building-and-deploying-a-containerised-react-app-and-microservice-using-the-same-openapi-contract/)\n","source":"_posts/deploy-a-react-app-in-kubernetes.md","raw":"---\ntitle: Deploy a react app in kubernetes\ncatalog: true\ndate: 2018-01-13 10:05:28\nsubtitle:\nheader-img: \"tree.jpg\"\ntags:\n- Kubernetes\n- React.js\n- Cloud\n- Docker\n---\n\n## Task: Deploy a react app in kubernetes \n> make sure cli tools such as node, docker, kubectl are installed\n\n## Steps:\n1. Use [create-react-app](https://github.com/facebookincubator/create-react-app) tool to generate a new project\n    - `create-react-app new-app`\n    - `cd new-app`\n2. Configure a [Dockerfile](https://docs.docker.com/engine/reference/builder/) for the react app\n    - use [alpine-node](https://github.com/mhart/alpine-node) as base docker image(Minimal Node.js Docker Images)\n        ```docker\n        # example\n        # create a production build\n        FROM mhart/alpine-node AS build\n        WORKDIR /app\n        COPY . .\n        RUN npm run build\n        \n        #serve the built app\n        FROM mhart/alpine-node\n        RUN npm install -g serve\n        WORKDIR /app\n        COPY --from=build /app/build .\n        CMD [ \"serve\", \"-p 80\", \"-s\", \".\"]\n        ```\n    - build the image: `docker build -t $repo-name .`\n    - run it with `docker run -p 8080:80 $repo-name`, go to `localhost:8080`\n3. Deploy your app to kubenetes cluster\n    - push your local image to a remote repo: `$ docker push $DOCKER_ID_USER/repo:tag` to docker hub \n    - create a new deployment: `kubectl run $deployment-name --image=$image-location --port=80`\n    - expose your service through NodePort: `kubectl expose deployment/$deployment-name --type=\"NodePort\" --port 80`\n    - get the node $name: `kubectl get node`\n    - get the service external $port: `kubectl describe services/$service-name`\n    - check the app out in the brower: `$nodename:$port`\n\n## References \n\n- [Running React app inside a Docker container](https://hackernoon.com/running-react-app-inside-a-docker-container-27136a75916b)\n- [Building and Deploying a Containerised React App and Microservice Using the Same OpenAPI Contract](http://connect.cd/2017/11/building-and-deploying-a-containerised-react-app-and-microservice-using-the-same-openapi-contract/)\n","slug":"deploy-a-react-app-in-kubernetes","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxt000ex18l4g56qdjc","content":"<h2 id=\"task-deploy-a-react-app-in-kubernetes\">Task: Deploy a react app in kubernetes</h2>\n<blockquote>\n<p>make sure cli tools such as node, docker, kubectl are installed</p>\n</blockquote>\n<h2 id=\"steps\">Steps:</h2>\n<ol>\n<li>Use <a href=\"https://github.com/facebookincubator/create-react-app\" target=\"_blank\" rel=\"noopener\">create-react-app</a> tool to generate a new project\n<ul>\n<li><code>create-react-app new-app</code></li>\n<li><code>cd new-app</code></li>\n</ul>\n</li>\n<li>Configure a <a href=\"https://docs.docker.com/engine/reference/builder/\" target=\"_blank\" rel=\"noopener\">Dockerfile</a> for the react app\n<ul>\n<li>\n<p>use <a href=\"https://github.com/mhart/alpine-node\" target=\"_blank\" rel=\"noopener\">alpine-node</a> as base docker image(Minimal Node.js Docker Images)</p>\n  <figure class=\"highlight docker\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># example</span></span><br><span class=\"line\"><span class=\"comment\"># create a production build</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> mhart/alpine-node AS build</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /app</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> . .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm run build</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#serve the built app</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> mhart/alpine-node</span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm install -g serve</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /app</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> --from=build /app/build .</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [ <span class=\"string\">\"serve\"</span>, <span class=\"string\">\"-p 80\"</span>, <span class=\"string\">\"-s\"</span>, <span class=\"string\">\".\"</span>]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>build the image: <code>docker build -t $repo-name .</code></p>\n</li>\n<li>\n<p>run it with <code>docker run -p 8080:80 $repo-name</code>, go to <code>localhost:8080</code></p>\n</li>\n</ul>\n</li>\n<li>Deploy your app to kubenetes cluster\n<ul>\n<li>push your local image to a remote repo: <code>$ docker push $DOCKER_ID_USER/repo:tag</code> to docker hub</li>\n<li>create a new deployment: <code>kubectl run $deployment-name --image=$image-location --port=80</code></li>\n<li>expose your service through NodePort: <code>kubectl expose deployment/$deployment-name --type=&quot;NodePort&quot; --port 80</code></li>\n<li>get the node $name: <code>kubectl get node</code></li>\n<li>get the service external $port: <code>kubectl describe services/$service-name</code></li>\n<li>check the app out in the brower: <code>$nodename:$port</code></li>\n</ul>\n</li>\n</ol>\n<h2 id=\"references\">References</h2>\n<ul>\n<li><a href=\"https://hackernoon.com/running-react-app-inside-a-docker-container-27136a75916b\" target=\"_blank\" rel=\"noopener\">Running React app inside a Docker container</a></li>\n<li><a href=\"http://connect.cd/2017/11/building-and-deploying-a-containerised-react-app-and-microservice-using-the-same-openapi-contract/\" target=\"_blank\" rel=\"noopener\">Building and Deploying a Containerised React App and Microservice Using the Same OpenAPI Contract</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2>Task: Deploy a react app in kubernetes</h2>\n<blockquote>\n<p>make sure cli tools such as node, docker, kubectl are installed</p>\n</blockquote>\n<h2>Steps:</h2>\n<ol>\n<li>Use <a href=\"https://github.com/facebookincubator/create-react-app\" target=\"_blank\" rel=\"noopener\">create-react-app</a> tool to generate a new project\n<ul>\n<li><code>create-react-app new-app</code></li>\n<li><code>cd new-app</code></li>\n</ul>\n</li>\n<li>Configure a <a href=\"https://docs.docker.com/engine/reference/builder/\" target=\"_blank\" rel=\"noopener\">Dockerfile</a> for the react app\n<ul>\n<li>\n<p>use <a href=\"https://github.com/mhart/alpine-node\" target=\"_blank\" rel=\"noopener\">alpine-node</a> as base docker image(Minimal Node.js Docker Images)</p>\n  <figure class=\"highlight docker\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># example</span></span><br><span class=\"line\"><span class=\"comment\"># create a production build</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> mhart/alpine-node AS build</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /app</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> . .</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm run build</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#serve the built app</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> mhart/alpine-node</span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> npm install -g serve</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"bash\"> /app</span></span><br><span class=\"line\"><span class=\"keyword\">COPY</span><span class=\"bash\"> --from=build /app/build .</span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [ <span class=\"string\">\"serve\"</span>, <span class=\"string\">\"-p 80\"</span>, <span class=\"string\">\"-s\"</span>, <span class=\"string\">\".\"</span>]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>build the image: <code>docker build -t $repo-name .</code></p>\n</li>\n<li>\n<p>run it with <code>docker run -p 8080:80 $repo-name</code>, go to <code>localhost:8080</code></p>\n</li>\n</ul>\n</li>\n<li>Deploy your app to kubenetes cluster\n<ul>\n<li>push your local image to a remote repo: <code>$ docker push $DOCKER_ID_USER/repo:tag</code> to docker hub</li>\n<li>create a new deployment: <code>kubectl run $deployment-name --image=$image-location --port=80</code></li>\n<li>expose your service through NodePort: <code>kubectl expose deployment/$deployment-name --type=&quot;NodePort&quot; --port 80</code></li>\n<li>get the node $name: <code>kubectl get node</code></li>\n<li>get the service external $port: <code>kubectl describe services/$service-name</code></li>\n<li>check the app out in the brower: <code>$nodename:$port</code></li>\n</ul>\n</li>\n</ol>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://hackernoon.com/running-react-app-inside-a-docker-container-27136a75916b\" target=\"_blank\" rel=\"noopener\">Running React app inside a Docker container</a></li>\n<li><a href=\"http://connect.cd/2017/11/building-and-deploying-a-containerised-react-app-and-microservice-using-the-same-openapi-contract/\" target=\"_blank\" rel=\"noopener\">Building and Deploying a Containerised React App and Microservice Using the Same OpenAPI Contract</a></li>\n</ul>\n"},{"title":"一次关于networking的对话","catalog":true,"date":"2017-12-26T02:41:43.000Z","subtitle":null,"header-img":"lighthouse3.jpg","_content":"\n房东在学校某部门做外联性质的工作，是个networking很厉害的人，平时待人处物都会给人一种很得体的感觉，圣诞前夕会专门写贺卡或者小纸条加上葡萄酒送同事、朋友，在我去参加面试之前专门指导我怎么去自我介绍以及事后如何发感谢信之类的，确实也是职场“老手”。于是前天我和他展开了一段关于networking的对话，让我觉得受益匪浅，更多也是一种看待视角的转变吧。\n\n### networking能力可以培养么？\n\n房东认为是可以的，但是要去观察，以及花时间有目的地训练。他说他刚进入职场的时候，他的第一个老板就是一个社交能力很强的人。一个活动来了一百多个嘉宾，结束的时候他老板大概能记住其中八九十人的名字，甚至有些人孩子的名字，兴趣爱好都能复述出来。然而他老板那时候已经六七十岁，所以并不是因为脑子转得特别快或是记忆力好，而是长期以来培养的一种习惯和能力。他也逐渐从他老板身上学习，去培养自己这方面的能力，因为记住这些关键的信息既能拉进关系，也表现对对方的一种尊重。\n\n他也解释说为什么一开始遇到我们的时候一定要我们报中文名，而不是大家为了方便老美记忆取的什么Tony, Allen之类的。当然这和他自己经历过的事也相关，他叫Alok，一个印度名字。在他曾经接电话的时候，别人居然问他“What is your American name?”。他就直言这就是我的名字，如果你不认识或者叫不出我的名字，我们就不要继续聊下去了。很多人自己的独特性就应该被尊重，而不是为了方便或是其它什么原因被抹去，被“美国化”或者大众化。\n\n### networking的意义是什么？\n\n房东的女朋友是中国人，所以房东学到了关系（guanxi）这个词，他直言这个东西美国一点都不比中国少，但可能没有那么直接，而且潜在于一层层包装之下。更多的人脉关系意味着更多的机会与信息。但我向他提出的问题是，很多networking的活动我看不到意义怎么办？很多事情常常更愿意自己网上搜，自己解决而不是找人。所以很多时候极其没有耐心。\n\n房东的观点是，其实去找人谈话，或者去帮人解决问题也是在提高自己。当别人在聊天过程中阐述问题、观点的时候，你可以假设自己处于他人的位置上，想想自己会怎么思考与应对，这对将来遇到类似的问题时是极有帮助的。阅历也是在这个过程中逐渐积累的。\n\n另外，人脉都是到用时方恨少，这也就是为什么要去记忆不同人的特点，所在领域，通过后面的互动建立联系。完全陌生的人之间的cold reach是很难的，但是往往通过某一个共同参加的活动作为切入点进行联系就会方便很多。\n\n### 沟通与做事一样重要\n\n因为很快要开始工作了，后来还聊到很多关于management，leadership之类的话题，不一而足，但有一点感受是共同的：就是很多职场上沟通以及社交的能力都是要刻意去锻炼的，这也是我们中国人很缺乏的一块技能。确实能体会到很多中国人在公众场合对于陌生人之间的交往往局促不安，其实能力都不比老美差，但是会表现出来没有那么自信与镇定。\n\n并不是只要写好代码，完成分配的任务就是做好工作了。如何去协作，如何去展示自己的成果都是很重要的一环。看很多论坛里中国很喜欢抱怨印度人抢了功劳，靠一张嘴就升官加薪，然而这并不是全部的事实，我们故意去抱怨这样一种现象来掩盖自己社交努力的不足也许是背后真正的原因。\n\n有些人喜欢说中国人的文化自信不足，但我觉得有时候是对自己的文化太过于执着、保守，认为凡是和自己文化习惯不同的社交方式都是一种时间浪费，不愿去改变，不愿去融入。而往往是，你在公众场合或者集体里发声得越少，就越没人觉得你很重要，自然就是嗓门大的获得了最多话语权。\n\n当然回到networking本身，真诚才是交朋友最重要的因素，技巧都是次要的，只是这种意愿要慢慢培养，毕竟与牛人一席话，往往胜读十年书。","source":"_posts/一次关于networking的对话.md","raw":"---\ntitle: 一次关于networking的对话\ncatalog: true\ndate: 2017-12-25 21:41:43\nsubtitle:\nheader-img: \"lighthouse3.jpg\"\ntags: \n- Thoughts\n---\n\n房东在学校某部门做外联性质的工作，是个networking很厉害的人，平时待人处物都会给人一种很得体的感觉，圣诞前夕会专门写贺卡或者小纸条加上葡萄酒送同事、朋友，在我去参加面试之前专门指导我怎么去自我介绍以及事后如何发感谢信之类的，确实也是职场“老手”。于是前天我和他展开了一段关于networking的对话，让我觉得受益匪浅，更多也是一种看待视角的转变吧。\n\n### networking能力可以培养么？\n\n房东认为是可以的，但是要去观察，以及花时间有目的地训练。他说他刚进入职场的时候，他的第一个老板就是一个社交能力很强的人。一个活动来了一百多个嘉宾，结束的时候他老板大概能记住其中八九十人的名字，甚至有些人孩子的名字，兴趣爱好都能复述出来。然而他老板那时候已经六七十岁，所以并不是因为脑子转得特别快或是记忆力好，而是长期以来培养的一种习惯和能力。他也逐渐从他老板身上学习，去培养自己这方面的能力，因为记住这些关键的信息既能拉进关系，也表现对对方的一种尊重。\n\n他也解释说为什么一开始遇到我们的时候一定要我们报中文名，而不是大家为了方便老美记忆取的什么Tony, Allen之类的。当然这和他自己经历过的事也相关，他叫Alok，一个印度名字。在他曾经接电话的时候，别人居然问他“What is your American name?”。他就直言这就是我的名字，如果你不认识或者叫不出我的名字，我们就不要继续聊下去了。很多人自己的独特性就应该被尊重，而不是为了方便或是其它什么原因被抹去，被“美国化”或者大众化。\n\n### networking的意义是什么？\n\n房东的女朋友是中国人，所以房东学到了关系（guanxi）这个词，他直言这个东西美国一点都不比中国少，但可能没有那么直接，而且潜在于一层层包装之下。更多的人脉关系意味着更多的机会与信息。但我向他提出的问题是，很多networking的活动我看不到意义怎么办？很多事情常常更愿意自己网上搜，自己解决而不是找人。所以很多时候极其没有耐心。\n\n房东的观点是，其实去找人谈话，或者去帮人解决问题也是在提高自己。当别人在聊天过程中阐述问题、观点的时候，你可以假设自己处于他人的位置上，想想自己会怎么思考与应对，这对将来遇到类似的问题时是极有帮助的。阅历也是在这个过程中逐渐积累的。\n\n另外，人脉都是到用时方恨少，这也就是为什么要去记忆不同人的特点，所在领域，通过后面的互动建立联系。完全陌生的人之间的cold reach是很难的，但是往往通过某一个共同参加的活动作为切入点进行联系就会方便很多。\n\n### 沟通与做事一样重要\n\n因为很快要开始工作了，后来还聊到很多关于management，leadership之类的话题，不一而足，但有一点感受是共同的：就是很多职场上沟通以及社交的能力都是要刻意去锻炼的，这也是我们中国人很缺乏的一块技能。确实能体会到很多中国人在公众场合对于陌生人之间的交往往局促不安，其实能力都不比老美差，但是会表现出来没有那么自信与镇定。\n\n并不是只要写好代码，完成分配的任务就是做好工作了。如何去协作，如何去展示自己的成果都是很重要的一环。看很多论坛里中国很喜欢抱怨印度人抢了功劳，靠一张嘴就升官加薪，然而这并不是全部的事实，我们故意去抱怨这样一种现象来掩盖自己社交努力的不足也许是背后真正的原因。\n\n有些人喜欢说中国人的文化自信不足，但我觉得有时候是对自己的文化太过于执着、保守，认为凡是和自己文化习惯不同的社交方式都是一种时间浪费，不愿去改变，不愿去融入。而往往是，你在公众场合或者集体里发声得越少，就越没人觉得你很重要，自然就是嗓门大的获得了最多话语权。\n\n当然回到networking本身，真诚才是交朋友最重要的因素，技巧都是次要的，只是这种意愿要慢慢培养，毕竟与牛人一席话，往往胜读十年书。","slug":"一次关于networking的对话","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxxu000hx18lugdt1dwb","content":"<p>房东在学校某部门做外联性质的工作，是个networking很厉害的人，平时待人处物都会给人一种很得体的感觉，圣诞前夕会专门写贺卡或者小纸条加上葡萄酒送同事、朋友，在我去参加面试之前专门指导我怎么去自我介绍以及事后如何发感谢信之类的，确实也是职场“老手”。于是前天我和他展开了一段关于networking的对话，让我觉得受益匪浅，更多也是一种看待视角的转变吧。</p>\n<h3 id=\"networking能力可以培养么\">networking能力可以培养么？</h3>\n<p>房东认为是可以的，但是要去观察，以及花时间有目的地训练。他说他刚进入职场的时候，他的第一个老板就是一个社交能力很强的人。一个活动来了一百多个嘉宾，结束的时候他老板大概能记住其中八九十人的名字，甚至有些人孩子的名字，兴趣爱好都能复述出来。然而他老板那时候已经六七十岁，所以并不是因为脑子转得特别快或是记忆力好，而是长期以来培养的一种习惯和能力。他也逐渐从他老板身上学习，去培养自己这方面的能力，因为记住这些关键的信息既能拉进关系，也表现对对方的一种尊重。</p>\n<p>他也解释说为什么一开始遇到我们的时候一定要我们报中文名，而不是大家为了方便老美记忆取的什么Tony, Allen之类的。当然这和他自己经历过的事也相关，他叫Alok，一个印度名字。在他曾经接电话的时候，别人居然问他“What is your American name?”。他就直言这就是我的名字，如果你不认识或者叫不出我的名字，我们就不要继续聊下去了。很多人自己的独特性就应该被尊重，而不是为了方便或是其它什么原因被抹去，被“美国化”或者大众化。</p>\n<h3 id=\"networking的意义是什么\">networking的意义是什么？</h3>\n<p>房东的女朋友是中国人，所以房东学到了关系（guanxi）这个词，他直言这个东西美国一点都不比中国少，但可能没有那么直接，而且潜在于一层层包装之下。更多的人脉关系意味着更多的机会与信息。但我向他提出的问题是，很多networking的活动我看不到意义怎么办？很多事情常常更愿意自己网上搜，自己解决而不是找人。所以很多时候极其没有耐心。</p>\n<p>房东的观点是，其实去找人谈话，或者去帮人解决问题也是在提高自己。当别人在聊天过程中阐述问题、观点的时候，你可以假设自己处于他人的位置上，想想自己会怎么思考与应对，这对将来遇到类似的问题时是极有帮助的。阅历也是在这个过程中逐渐积累的。</p>\n<p>另外，人脉都是到用时方恨少，这也就是为什么要去记忆不同人的特点，所在领域，通过后面的互动建立联系。完全陌生的人之间的cold reach是很难的，但是往往通过某一个共同参加的活动作为切入点进行联系就会方便很多。</p>\n<h3 id=\"沟通与做事一样重要\">沟通与做事一样重要</h3>\n<p>因为很快要开始工作了，后来还聊到很多关于management，leadership之类的话题，不一而足，但有一点感受是共同的：就是很多职场上沟通以及社交的能力都是要刻意去锻炼的，这也是我们中国人很缺乏的一块技能。确实能体会到很多中国人在公众场合对于陌生人之间的交往往局促不安，其实能力都不比老美差，但是会表现出来没有那么自信与镇定。</p>\n<p>并不是只要写好代码，完成分配的任务就是做好工作了。如何去协作，如何去展示自己的成果都是很重要的一环。看很多论坛里中国很喜欢抱怨印度人抢了功劳，靠一张嘴就升官加薪，然而这并不是全部的事实，我们故意去抱怨这样一种现象来掩盖自己社交努力的不足也许是背后真正的原因。</p>\n<p>有些人喜欢说中国人的文化自信不足，但我觉得有时候是对自己的文化太过于执着、保守，认为凡是和自己文化习惯不同的社交方式都是一种时间浪费，不愿去改变，不愿去融入。而往往是，你在公众场合或者集体里发声得越少，就越没人觉得你很重要，自然就是嗓门大的获得了最多话语权。</p>\n<p>当然回到networking本身，真诚才是交朋友最重要的因素，技巧都是次要的，只是这种意愿要慢慢培养，毕竟与牛人一席话，往往胜读十年书。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>房东在学校某部门做外联性质的工作，是个networking很厉害的人，平时待人处物都会给人一种很得体的感觉，圣诞前夕会专门写贺卡或者小纸条加上葡萄酒送同事、朋友，在我去参加面试之前专门指导我怎么去自我介绍以及事后如何发感谢信之类的，确实也是职场“老手”。于是前天我和他展开了一段关于networking的对话，让我觉得受益匪浅，更多也是一种看待视角的转变吧。</p>\n<h3>networking能力可以培养么？</h3>\n<p>房东认为是可以的，但是要去观察，以及花时间有目的地训练。他说他刚进入职场的时候，他的第一个老板就是一个社交能力很强的人。一个活动来了一百多个嘉宾，结束的时候他老板大概能记住其中八九十人的名字，甚至有些人孩子的名字，兴趣爱好都能复述出来。然而他老板那时候已经六七十岁，所以并不是因为脑子转得特别快或是记忆力好，而是长期以来培养的一种习惯和能力。他也逐渐从他老板身上学习，去培养自己这方面的能力，因为记住这些关键的信息既能拉进关系，也表现对对方的一种尊重。</p>\n<p>他也解释说为什么一开始遇到我们的时候一定要我们报中文名，而不是大家为了方便老美记忆取的什么Tony, Allen之类的。当然这和他自己经历过的事也相关，他叫Alok，一个印度名字。在他曾经接电话的时候，别人居然问他“What is your American name?”。他就直言这就是我的名字，如果你不认识或者叫不出我的名字，我们就不要继续聊下去了。很多人自己的独特性就应该被尊重，而不是为了方便或是其它什么原因被抹去，被“美国化”或者大众化。</p>\n<h3>networking的意义是什么？</h3>\n<p>房东的女朋友是中国人，所以房东学到了关系（guanxi）这个词，他直言这个东西美国一点都不比中国少，但可能没有那么直接，而且潜在于一层层包装之下。更多的人脉关系意味着更多的机会与信息。但我向他提出的问题是，很多networking的活动我看不到意义怎么办？很多事情常常更愿意自己网上搜，自己解决而不是找人。所以很多时候极其没有耐心。</p>\n<p>房东的观点是，其实去找人谈话，或者去帮人解决问题也是在提高自己。当别人在聊天过程中阐述问题、观点的时候，你可以假设自己处于他人的位置上，想想自己会怎么思考与应对，这对将来遇到类似的问题时是极有帮助的。阅历也是在这个过程中逐渐积累的。</p>\n<p>另外，人脉都是到用时方恨少，这也就是为什么要去记忆不同人的特点，所在领域，通过后面的互动建立联系。完全陌生的人之间的cold reach是很难的，但是往往通过某一个共同参加的活动作为切入点进行联系就会方便很多。</p>\n<h3>沟通与做事一样重要</h3>\n<p>因为很快要开始工作了，后来还聊到很多关于management，leadership之类的话题，不一而足，但有一点感受是共同的：就是很多职场上沟通以及社交的能力都是要刻意去锻炼的，这也是我们中国人很缺乏的一块技能。确实能体会到很多中国人在公众场合对于陌生人之间的交往往局促不安，其实能力都不比老美差，但是会表现出来没有那么自信与镇定。</p>\n<p>并不是只要写好代码，完成分配的任务就是做好工作了。如何去协作，如何去展示自己的成果都是很重要的一环。看很多论坛里中国很喜欢抱怨印度人抢了功劳，靠一张嘴就升官加薪，然而这并不是全部的事实，我们故意去抱怨这样一种现象来掩盖自己社交努力的不足也许是背后真正的原因。</p>\n<p>有些人喜欢说中国人的文化自信不足，但我觉得有时候是对自己的文化太过于执着、保守，认为凡是和自己文化习惯不同的社交方式都是一种时间浪费，不愿去改变，不愿去融入。而往往是，你在公众场合或者集体里发声得越少，就越没人觉得你很重要，自然就是嗓门大的获得了最多话语权。</p>\n<p>当然回到networking本身，真诚才是交朋友最重要的因素，技巧都是次要的，只是这种意愿要慢慢培养，毕竟与牛人一席话，往往胜读十年书。</p>\n"},{"title":"Automatically create merge requests through gitlab api","catalog":true,"date":"2019-04-04T02:14:12.000Z","subtitle":"Laziness creates efficiency","header-img":"gitlab-blog-cover.png","_content":"\n## Background\n\nKubernetes is the new trend to manage cloud-based applications and also our main tool for orchestration. Each of our service is running inside an individual docker container and we use [helm charts](https://helm.sh/docs/developing_charts/) to configure each pod. For codebase management, we use gitlab, which is perfect for collaboration inside a team that hosts code server by themselves.\n\nIn production, everytime that we update our service version (either front end or back end), we need to update the hash inside the helm charts. Since we have a requirement for release notes to include **bug fix** or **new features**, **related commits** or **tickets** have to be included inside the body of gitlab merge request.\n\nWe are all lazy developers and try to avoid tedious work that could be automated by codes.\n\nSo the **workflow** I want to achieve is that whenever we merge a feature branch to the **master**, we collect all the **related issues** and **squashed commits**. Ideally, we set a merge request **interval** to avoid too frequent merge requests. Then we compare the latest master hash and the one in the helm charts, checking if the interval is longer enough for us to create a new merge request. Last but not the least, the whole step should be a phase in the gitlab CI.\n\nLuckily, [gitlab API](https://docs.gitlab.com/ee/api/) provides all the functions we need.\n\n## Tools\n\nBefore we proceed, we need a set of command line tools to boost our efficiency.\n\n### jq\n\n> jq is like sed for JSON data\n> You can use `jq` to easily extract useful information and format them in the way you want. For example:\n\n- extract the first element from a `json array`:\n\n`cat json | jq .[0]`\n\n- get a new json in the given format:\n\n`jq '.[] | {message: .commit.message, name: .commit.committer.name}'`\n\nYou can even use conditional operator or loop functions with `jq`, which is definitely worth checking out the [manual](https://stedolan.github.io/jq/manual/) if you are dealing with json form cli a lot.\n\n### yq\n\nyq is similar to jq, but especially for `yaml` files. It's also written in python.\n\n### gsed(sed)\n\n`sed` is a very handy tool on the unix system to perform basic text transformations on an input stream. However, `sed` on the `linux` and `mac` has slight differences, so we can use `gsed` here to keep it consistent.\n\n### curl\n\n`curl` is basically the postman on the command line, which will be our best friend to test apis from the terminal.\n\n### base64\n\n`base64` encoding is a common way to use textual data to store the binary data or serialize the files.\n\n## Step by step\n\nI'm using [node client](https://www.npmjs.com/package/gitlab) from gitlab here, but you can use any language to write the script.\n\n### Import the dependencies\n\nHere's the modules that I use:\n\n```js\nconst { ProjectsBundle } = require(\"gitlab\");\nconst yaml = require(\"js-yaml\");\nconst fs = require(\"fs\");\nconst exec = require(\"await-exec\");\nconst _ = require(\"lodash\");\nconst moment = require(\"moment\");\n```\n\n### Fetch helm-chart file\n\nWe use gitlab client to set up the project info:\n\n```js\nconst service = new ProjectsBundle({\n  url: HOST,\n  token: PRIVATE_TOKEN,\n});\n```\n\nThen we fetched the `values.yaml` file.\n\n```js\ntry {\n  var valuesFile = await service.RepositoryFiles.show(\n    HELM_CHART_PROJECT_ID,\n    \"path/to/values.yaml\",\n    \"master\"\n  );\n} catch (e) {\n  console.error(\"Unable to fetch values.yaml file. ❌\");\n  process.exit(1);\n}\n```\n\nThe response we get from the api so far is encoded in `base64`, so we need to decode it in plain text:\n\n```js\nconst { content } = valuesFile;\nconst generatedFile = await exec(\n  `echo ${content} | base64 --decode > values.yaml`,\n  puts\n);\n```\n\n### Compare the commit diff and time diff\n\nNext, We check whether the commit hash changed and whether time interval met our requirement, otherwise we don't need to make next move.\n\n```js\n // get commit hash from helm chart\n  try {\n    const doc = yaml.safeLoad(fs.readFileSync(\"./values.yaml\", \"utf8\"));\n    hashInHelm = doc.image.tag;\n  } catch (e) {\n    console.error(e);\n  }\n\n  const oldCommit = await service.Commits.show(PROJECT_ID, hashInHelm);\n  lastCommitTime = oldCommit[\"created_at\"];\n  let sinceTime = moment(lastCommitTime)\n    .add(1, \"minutes\")\n    .format();\n  const fetchMasterCommits = await exec(\n    `curl -H \"PRIVATE-TOKEN:${PRIVATE_TOKEN}\" ${HOST}/api/v4/projects/${PROJECT_ID}/repository/commits?since=${sinceTime}`\n  );\n  if (fetchMasterCommits.error) {\n    console.error(`fetchMasterCommits error: ${fetchMasterCommits.error} ❌`);\n  }\n  masterCommits = JSON.parse(fetchMasterCommits.stdout);\n  if (masterCommits.length === 0) {\n    console.log(\"The hash in the helm chart is the latest one.\");\n    process.exit(0);\n  }\n  hashInRepo = masterCommits[0].short_id;\n  const currentDate = new Date();\n  const lastUpdateDate = new Date(lastCommitTime)\n  // only continue the script when the hash changed and the time diff is large than the setting\n  if (\n    hashInHelm !== hashInManifold &&\n    currentDate - lastUpdateDate > TIME_INTERVAL\n  ) {\n    ...\n  }\n```\n\n- get related `merge requests` and `commit messages`\n\nIn order to create a merge request with enough information, we can fetch merge requests and commit messages that are related to this specific commit.\n\n```js\nconst description = {\n  commits: [],\n  issues: [],\n};\nmasterCommits\n  .map(commit => commit.id)\n  .forEach(async id => {\n    let mergeRequests;\n    try {\n      mergeRequests = await service.Commits.mergeRequests(PROJECT_ID, id);\n    } catch (e) {\n      console.error(`Unable to fetch merge requests for ${id}. ${e} ❌`);\n    }\n    // if no merge requests found, just use the commit message\n    if (Array.isArray(mergeRequests) && mergeRequests.length === 0) {\n      const c = _.find(masterCommits, o => o.id === id);\n      description.commits.push(`${c.short_id} - ${c.message}`);\n    } else {\n      // otherwise, format the description as [title](web_url)\n      mergeRequests\n        .map(m => m.iid)\n        .forEach(async iid => {\n          const closedIssues = await service.MergeRequests.closesIssues(\n            PROJECT_ID,\n            iid\n          );\n          closedIssues.forEach(issue => {\n            description.issues.push(`[${issue.title}](${issue.web_url})\\n`);\n          });\n        });\n    }\n  });\n```\n\n- Create a new merge request\n\nIn the final step, we create a new branch and apply the hash change that we made. Then we make a new merge request with all the useful information.\n\n```js\nconst newBranch = `change-hash-${hashInManifold}`;\n// replace the hash\nlet updatedFile = await exec(\n  `sed -i 's/${hashInHelm}/${hashInManifold}/' values.yaml`,\n  puts\n);\nconsole.log(\"Updated hash in values.yaml. ✅\");\nlet BASE64_yaml = base64_encode(\"values.yaml\");\nconst Payload = {\n  branch: newBranch,\n  content: BASE64_yaml,\n  commit_message: `update hash to ${hashInManifold}`,\n  encoding: \"base64\",\n};\nconst createNewBranch = await service.Branches.create(\n  HELM_CHART_PROJECT_ID,\n  newBranch,\n  \"master\"\n);\nconsole.log(`Created a branch ${newBranch} in helm-chart repo. ✅`);\ntry {\n  const updatedFileInHelm = await exec(`curl --request PUT --header 'PRIVATE-TOKEN:${PRIVATE_TOKEN}' --header \"Content-Type: application/json\" \\\n      --data '${JSON.stringify(\n        Payload\n      )}' \"${HOST}/api/v4/projects/${HELM_CHART_PROJECT_ID}/repository/files/charts%2Fdata-engine%2Fvalues.yaml\"`);\n  console.log(`Updated value.yaml file in helm-chart repo. ✅`);\n} catch (e) {\n  console.error(`Unable to update file. ❌`);\n}\n\n/**\n * projectId: ProjectId,\n * sourceBranch: string,\n * targetBranch: string,\n * title: string,\n * options: RequestOptions,\n */\nconst createMr = await service.MergeRequests.create(\n  HELM_CHART_PROJECT_ID,\n  newBranch,\n  \"master\",\n  \"WIP: update manifold hash\",\n  {\n    description: `\n## Description\n### related commits\n${_.uniq(description.commits).join(\"\\n\")}\n\n### related issues:\n${_.uniq(description.issues).join(\"\\n\")}`,\n  }\n);\nconsole.log(\"Created a merge request in helm-chart repo. ✅\");\nconsole.log(`Here is the link: ${createMr.web_url}`);\n```\n\n## Things to improve\n\nAbove are a relatively simple and straightforward way to create merge requests base on changes. We did observe several problems in the process and find improvements to be done in future.\n\n- Only create MRs in batches or close the MRs that are included in the current MR. MRs are created for each change now, then populate the whole merge list if the previous ones are not merge in time.\n\n- It would be nice that we provide a link with `Create MR` button for users to trigger the creation.\n\n- Better code abstraction for different project usage.\n\n- Better organization of description and commit messages.\n","source":"_posts/Automatically-create-merge-request-through-gitlab-api.md","raw":"---\ntitle: Automatically create merge requests through gitlab api\ncatalog: true\ndate: 2019-04-03 22:14:12\nsubtitle: Laziness creates efficiency\nheader-img: gitlab-blog-cover.png\ntags:\n  - gitlab\n  - bash\n  - node\n---\n\n## Background\n\nKubernetes is the new trend to manage cloud-based applications and also our main tool for orchestration. Each of our service is running inside an individual docker container and we use [helm charts](https://helm.sh/docs/developing_charts/) to configure each pod. For codebase management, we use gitlab, which is perfect for collaboration inside a team that hosts code server by themselves.\n\nIn production, everytime that we update our service version (either front end or back end), we need to update the hash inside the helm charts. Since we have a requirement for release notes to include **bug fix** or **new features**, **related commits** or **tickets** have to be included inside the body of gitlab merge request.\n\nWe are all lazy developers and try to avoid tedious work that could be automated by codes.\n\nSo the **workflow** I want to achieve is that whenever we merge a feature branch to the **master**, we collect all the **related issues** and **squashed commits**. Ideally, we set a merge request **interval** to avoid too frequent merge requests. Then we compare the latest master hash and the one in the helm charts, checking if the interval is longer enough for us to create a new merge request. Last but not the least, the whole step should be a phase in the gitlab CI.\n\nLuckily, [gitlab API](https://docs.gitlab.com/ee/api/) provides all the functions we need.\n\n## Tools\n\nBefore we proceed, we need a set of command line tools to boost our efficiency.\n\n### jq\n\n> jq is like sed for JSON data\n> You can use `jq` to easily extract useful information and format them in the way you want. For example:\n\n- extract the first element from a `json array`:\n\n`cat json | jq .[0]`\n\n- get a new json in the given format:\n\n`jq '.[] | {message: .commit.message, name: .commit.committer.name}'`\n\nYou can even use conditional operator or loop functions with `jq`, which is definitely worth checking out the [manual](https://stedolan.github.io/jq/manual/) if you are dealing with json form cli a lot.\n\n### yq\n\nyq is similar to jq, but especially for `yaml` files. It's also written in python.\n\n### gsed(sed)\n\n`sed` is a very handy tool on the unix system to perform basic text transformations on an input stream. However, `sed` on the `linux` and `mac` has slight differences, so we can use `gsed` here to keep it consistent.\n\n### curl\n\n`curl` is basically the postman on the command line, which will be our best friend to test apis from the terminal.\n\n### base64\n\n`base64` encoding is a common way to use textual data to store the binary data or serialize the files.\n\n## Step by step\n\nI'm using [node client](https://www.npmjs.com/package/gitlab) from gitlab here, but you can use any language to write the script.\n\n### Import the dependencies\n\nHere's the modules that I use:\n\n```js\nconst { ProjectsBundle } = require(\"gitlab\");\nconst yaml = require(\"js-yaml\");\nconst fs = require(\"fs\");\nconst exec = require(\"await-exec\");\nconst _ = require(\"lodash\");\nconst moment = require(\"moment\");\n```\n\n### Fetch helm-chart file\n\nWe use gitlab client to set up the project info:\n\n```js\nconst service = new ProjectsBundle({\n  url: HOST,\n  token: PRIVATE_TOKEN,\n});\n```\n\nThen we fetched the `values.yaml` file.\n\n```js\ntry {\n  var valuesFile = await service.RepositoryFiles.show(\n    HELM_CHART_PROJECT_ID,\n    \"path/to/values.yaml\",\n    \"master\"\n  );\n} catch (e) {\n  console.error(\"Unable to fetch values.yaml file. ❌\");\n  process.exit(1);\n}\n```\n\nThe response we get from the api so far is encoded in `base64`, so we need to decode it in plain text:\n\n```js\nconst { content } = valuesFile;\nconst generatedFile = await exec(\n  `echo ${content} | base64 --decode > values.yaml`,\n  puts\n);\n```\n\n### Compare the commit diff and time diff\n\nNext, We check whether the commit hash changed and whether time interval met our requirement, otherwise we don't need to make next move.\n\n```js\n // get commit hash from helm chart\n  try {\n    const doc = yaml.safeLoad(fs.readFileSync(\"./values.yaml\", \"utf8\"));\n    hashInHelm = doc.image.tag;\n  } catch (e) {\n    console.error(e);\n  }\n\n  const oldCommit = await service.Commits.show(PROJECT_ID, hashInHelm);\n  lastCommitTime = oldCommit[\"created_at\"];\n  let sinceTime = moment(lastCommitTime)\n    .add(1, \"minutes\")\n    .format();\n  const fetchMasterCommits = await exec(\n    `curl -H \"PRIVATE-TOKEN:${PRIVATE_TOKEN}\" ${HOST}/api/v4/projects/${PROJECT_ID}/repository/commits?since=${sinceTime}`\n  );\n  if (fetchMasterCommits.error) {\n    console.error(`fetchMasterCommits error: ${fetchMasterCommits.error} ❌`);\n  }\n  masterCommits = JSON.parse(fetchMasterCommits.stdout);\n  if (masterCommits.length === 0) {\n    console.log(\"The hash in the helm chart is the latest one.\");\n    process.exit(0);\n  }\n  hashInRepo = masterCommits[0].short_id;\n  const currentDate = new Date();\n  const lastUpdateDate = new Date(lastCommitTime)\n  // only continue the script when the hash changed and the time diff is large than the setting\n  if (\n    hashInHelm !== hashInManifold &&\n    currentDate - lastUpdateDate > TIME_INTERVAL\n  ) {\n    ...\n  }\n```\n\n- get related `merge requests` and `commit messages`\n\nIn order to create a merge request with enough information, we can fetch merge requests and commit messages that are related to this specific commit.\n\n```js\nconst description = {\n  commits: [],\n  issues: [],\n};\nmasterCommits\n  .map(commit => commit.id)\n  .forEach(async id => {\n    let mergeRequests;\n    try {\n      mergeRequests = await service.Commits.mergeRequests(PROJECT_ID, id);\n    } catch (e) {\n      console.error(`Unable to fetch merge requests for ${id}. ${e} ❌`);\n    }\n    // if no merge requests found, just use the commit message\n    if (Array.isArray(mergeRequests) && mergeRequests.length === 0) {\n      const c = _.find(masterCommits, o => o.id === id);\n      description.commits.push(`${c.short_id} - ${c.message}`);\n    } else {\n      // otherwise, format the description as [title](web_url)\n      mergeRequests\n        .map(m => m.iid)\n        .forEach(async iid => {\n          const closedIssues = await service.MergeRequests.closesIssues(\n            PROJECT_ID,\n            iid\n          );\n          closedIssues.forEach(issue => {\n            description.issues.push(`[${issue.title}](${issue.web_url})\\n`);\n          });\n        });\n    }\n  });\n```\n\n- Create a new merge request\n\nIn the final step, we create a new branch and apply the hash change that we made. Then we make a new merge request with all the useful information.\n\n```js\nconst newBranch = `change-hash-${hashInManifold}`;\n// replace the hash\nlet updatedFile = await exec(\n  `sed -i 's/${hashInHelm}/${hashInManifold}/' values.yaml`,\n  puts\n);\nconsole.log(\"Updated hash in values.yaml. ✅\");\nlet BASE64_yaml = base64_encode(\"values.yaml\");\nconst Payload = {\n  branch: newBranch,\n  content: BASE64_yaml,\n  commit_message: `update hash to ${hashInManifold}`,\n  encoding: \"base64\",\n};\nconst createNewBranch = await service.Branches.create(\n  HELM_CHART_PROJECT_ID,\n  newBranch,\n  \"master\"\n);\nconsole.log(`Created a branch ${newBranch} in helm-chart repo. ✅`);\ntry {\n  const updatedFileInHelm = await exec(`curl --request PUT --header 'PRIVATE-TOKEN:${PRIVATE_TOKEN}' --header \"Content-Type: application/json\" \\\n      --data '${JSON.stringify(\n        Payload\n      )}' \"${HOST}/api/v4/projects/${HELM_CHART_PROJECT_ID}/repository/files/charts%2Fdata-engine%2Fvalues.yaml\"`);\n  console.log(`Updated value.yaml file in helm-chart repo. ✅`);\n} catch (e) {\n  console.error(`Unable to update file. ❌`);\n}\n\n/**\n * projectId: ProjectId,\n * sourceBranch: string,\n * targetBranch: string,\n * title: string,\n * options: RequestOptions,\n */\nconst createMr = await service.MergeRequests.create(\n  HELM_CHART_PROJECT_ID,\n  newBranch,\n  \"master\",\n  \"WIP: update manifold hash\",\n  {\n    description: `\n## Description\n### related commits\n${_.uniq(description.commits).join(\"\\n\")}\n\n### related issues:\n${_.uniq(description.issues).join(\"\\n\")}`,\n  }\n);\nconsole.log(\"Created a merge request in helm-chart repo. ✅\");\nconsole.log(`Here is the link: ${createMr.web_url}`);\n```\n\n## Things to improve\n\nAbove are a relatively simple and straightforward way to create merge requests base on changes. We did observe several problems in the process and find improvements to be done in future.\n\n- Only create MRs in batches or close the MRs that are included in the current MR. MRs are created for each change now, then populate the whole merge list if the previous ones are not merge in time.\n\n- It would be nice that we provide a link with `Create MR` button for users to trigger the creation.\n\n- Better code abstraction for different project usage.\n\n- Better organization of description and commit messages.\n","slug":"Automatically-create-merge-request-through-gitlab-api","published":1,"updated":"2019-08-17T01:38:19.275Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxy7001cx18lbri0p6po","content":"<h2 id=\"background\">Background</h2>\n<p>Kubernetes is the new trend to manage cloud-based applications and also our main tool for orchestration. Each of our service is running inside an individual docker container and we use <a href=\"https://helm.sh/docs/developing_charts/\" target=\"_blank\" rel=\"noopener\">helm charts</a> to configure each pod. For codebase management, we use gitlab, which is perfect for collaboration inside a team that hosts code server by themselves.</p>\n<p>In production, everytime that we update our service version (either front end or back end), we need to update the hash inside the helm charts. Since we have a requirement for release notes to include <strong>bug fix</strong> or <strong>new features</strong>, <strong>related commits</strong> or <strong>tickets</strong> have to be included inside the body of gitlab merge request.</p>\n<p>We are all lazy developers and try to avoid tedious work that could be automated by codes.</p>\n<p>So the <strong>workflow</strong> I want to achieve is that whenever we merge a feature branch to the <strong>master</strong>, we collect all the <strong>related issues</strong> and <strong>squashed commits</strong>. Ideally, we set a merge request <strong>interval</strong> to avoid too frequent merge requests. Then we compare the latest master hash and the one in the helm charts, checking if the interval is longer enough for us to create a new merge request. Last but not the least, the whole step should be a phase in the gitlab CI.</p>\n<p>Luckily, <a href=\"https://docs.gitlab.com/ee/api/\" target=\"_blank\" rel=\"noopener\">gitlab API</a> provides all the functions we need.</p>\n<h2 id=\"tools\">Tools</h2>\n<p>Before we proceed, we need a set of command line tools to boost our efficiency.</p>\n<h3 id=\"jq\">jq</h3>\n<blockquote>\n<p>jq is like sed for JSON data<br>\nYou can use <code>jq</code> to easily extract useful information and format them in the way you want. For example:</p>\n</blockquote>\n<ul>\n<li>extract the first element from a <code>json array</code>:</li>\n</ul>\n<p><code>cat json | jq .[0]</code></p>\n<ul>\n<li>get a new json in the given format:</li>\n</ul>\n<p><code>jq '.[] | {message: .commit.message, name: .commit.committer.name}'</code></p>\n<p>You can even use conditional operator or loop functions with <code>jq</code>, which is definitely worth checking out the <a href=\"https://stedolan.github.io/jq/manual/\" target=\"_blank\" rel=\"noopener\">manual</a> if you are dealing with json form cli a lot.</p>\n<h3 id=\"yq\">yq</h3>\n<p>yq is similar to jq, but especially for <code>yaml</code> files. It’s also written in python.</p>\n<h3 id=\"gsedsed\">gsed(sed)</h3>\n<p><code>sed</code> is a very handy tool on the unix system to perform basic text transformations on an input stream. However, <code>sed</code> on the <code>linux</code> and <code>mac</code> has slight differences, so we can use <code>gsed</code> here to keep it consistent.</p>\n<h3 id=\"curl\">curl</h3>\n<p><code>curl</code> is basically the postman on the command line, which will be our best friend to test apis from the terminal.</p>\n<h3 id=\"base64\">base64</h3>\n<p><code>base64</code> encoding is a common way to use textual data to store the binary data or serialize the files.</p>\n<h2 id=\"step-by-step\">Step by step</h2>\n<p>I’m using <a href=\"https://www.npmjs.com/package/gitlab\" target=\"_blank\" rel=\"noopener\">node client</a> from gitlab here, but you can use any language to write the script.</p>\n<h3 id=\"import-the-dependencies\">Import the dependencies</h3>\n<p>Here’s the modules that I use:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; ProjectsBundle &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">\"gitlab\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> yaml = <span class=\"built_in\">require</span>(<span class=\"string\">\"js-yaml\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> exec = <span class=\"built_in\">require</span>(<span class=\"string\">\"await-exec\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> _ = <span class=\"built_in\">require</span>(<span class=\"string\">\"lodash\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> moment = <span class=\"built_in\">require</span>(<span class=\"string\">\"moment\"</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"fetch-helm-chart-file\">Fetch helm-chart file</h3>\n<p>We use gitlab client to set up the project info:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> service = <span class=\"keyword\">new</span> ProjectsBundle(&#123;</span><br><span class=\"line\">  url: HOST,</span><br><span class=\"line\">  token: PRIVATE_TOKEN,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Then we fetched the <code>values.yaml</code> file.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> valuesFile = <span class=\"keyword\">await</span> service.RepositoryFiles.show(</span><br><span class=\"line\">    HELM_CHART_PROJECT_ID,</span><br><span class=\"line\">    <span class=\"string\">\"path/to/values.yaml\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"master\"</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">\"Unable to fetch values.yaml file. ❌\"</span>);</span><br><span class=\"line\">  process.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The response we get from the api so far is encoded in <code>base64</code>, so we need to decode it in plain text:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; content &#125; = valuesFile;</span><br><span class=\"line\"><span class=\"keyword\">const</span> generatedFile = <span class=\"keyword\">await</span> exec(</span><br><span class=\"line\">  <span class=\"string\">`echo <span class=\"subst\">$&#123;content&#125;</span> | base64 --decode &gt; values.yaml`</span>,</span><br><span class=\"line\">  puts</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h3 id=\"compare-the-commit-diff-and-time-diff\">Compare the commit diff and time diff</h3>\n<p>Next, We check whether the commit hash changed and whether time interval met our requirement, otherwise we don’t need to make next move.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get commit hash from helm chart</span></span><br><span class=\"line\"> <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> doc = yaml.safeLoad(fs.readFileSync(<span class=\"string\">\"./values.yaml\"</span>, <span class=\"string\">\"utf8\"</span>));</span><br><span class=\"line\">   hashInHelm = doc.image.tag;</span><br><span class=\"line\"> &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.error(e);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">const</span> oldCommit = <span class=\"keyword\">await</span> service.Commits.show(PROJECT_ID, hashInHelm);</span><br><span class=\"line\"> lastCommitTime = oldCommit[<span class=\"string\">\"created_at\"</span>];</span><br><span class=\"line\"> <span class=\"keyword\">let</span> sinceTime = moment(lastCommitTime)</span><br><span class=\"line\">   .add(<span class=\"number\">1</span>, <span class=\"string\">\"minutes\"</span>)</span><br><span class=\"line\">   .format();</span><br><span class=\"line\"> <span class=\"keyword\">const</span> fetchMasterCommits = <span class=\"keyword\">await</span> exec(</span><br><span class=\"line\">   <span class=\"string\">`curl -H \"PRIVATE-TOKEN:<span class=\"subst\">$&#123;PRIVATE_TOKEN&#125;</span>\" <span class=\"subst\">$&#123;HOST&#125;</span>/api/v4/projects/<span class=\"subst\">$&#123;PROJECT_ID&#125;</span>/repository/commits?since=<span class=\"subst\">$&#123;sinceTime&#125;</span>`</span></span><br><span class=\"line\"> );</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (fetchMasterCommits.error) &#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.error(<span class=\"string\">`fetchMasterCommits error: <span class=\"subst\">$&#123;fetchMasterCommits.error&#125;</span> ❌`</span>);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> masterCommits = <span class=\"built_in\">JSON</span>.parse(fetchMasterCommits.stdout);</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (masterCommits.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(<span class=\"string\">\"The hash in the helm chart is the latest one.\"</span>);</span><br><span class=\"line\">   process.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> hashInRepo = masterCommits[<span class=\"number\">0</span>].short_id;</span><br><span class=\"line\"> <span class=\"keyword\">const</span> currentDate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"> <span class=\"keyword\">const</span> lastUpdateDate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(lastCommitTime)</span><br><span class=\"line\"> <span class=\"comment\">// only continue the script when the hash changed and the time diff is large than the setting</span></span><br><span class=\"line\"> <span class=\"keyword\">if</span> (</span><br><span class=\"line\">   hashInHelm !== hashInManifold &amp;&amp;</span><br><span class=\"line\">   currentDate - lastUpdateDate &gt; TIME_INTERVAL</span><br><span class=\"line\"> ) &#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>get related <code>merge requests</code> and <code>commit messages</code></li>\n</ul>\n<p>In order to create a merge request with enough information, we can fetch merge requests and commit messages that are related to this specific commit.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> description = &#123;</span><br><span class=\"line\">  commits: [],</span><br><span class=\"line\">  issues: [],</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">masterCommits</span><br><span class=\"line\">  .map(<span class=\"function\"><span class=\"params\">commit</span> =&gt;</span> commit.id)</span><br><span class=\"line\">  .forEach(<span class=\"keyword\">async</span> id =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> mergeRequests;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      mergeRequests = <span class=\"keyword\">await</span> service.Commits.mergeRequests(PROJECT_ID, id);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(<span class=\"string\">`Unable to fetch merge requests for <span class=\"subst\">$&#123;id&#125;</span>. <span class=\"subst\">$&#123;e&#125;</span> ❌`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// if no merge requests found, just use the commit message</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(mergeRequests) &amp;&amp; mergeRequests.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> c = _.find(masterCommits, o =&gt; o.id === id);</span><br><span class=\"line\">      description.commits.push(<span class=\"string\">`<span class=\"subst\">$&#123;c.short_id&#125;</span> - <span class=\"subst\">$&#123;c.message&#125;</span>`</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// otherwise, format the description as [title](web_url)</span></span><br><span class=\"line\">      mergeRequests</span><br><span class=\"line\">        .map(<span class=\"function\"><span class=\"params\">m</span> =&gt;</span> m.iid)</span><br><span class=\"line\">        .forEach(<span class=\"keyword\">async</span> iid =&gt; &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> closedIssues = <span class=\"keyword\">await</span> service.MergeRequests.closesIssues(</span><br><span class=\"line\">            PROJECT_ID,</span><br><span class=\"line\">            iid</span><br><span class=\"line\">          );</span><br><span class=\"line\">          closedIssues.forEach(<span class=\"function\"><span class=\"params\">issue</span> =&gt;</span> &#123;</span><br><span class=\"line\">            description.issues.push(<span class=\"string\">`[<span class=\"subst\">$&#123;issue.title&#125;</span>](<span class=\"subst\">$&#123;issue.web_url&#125;</span>)\\n`</span>);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Create a new merge request</li>\n</ul>\n<p>In the final step, we create a new branch and apply the hash change that we made. Then we make a new merge request with all the useful information.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> newBranch = <span class=\"string\">`change-hash-<span class=\"subst\">$&#123;hashInManifold&#125;</span>`</span>;</span><br><span class=\"line\"><span class=\"comment\">// replace the hash</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> updatedFile = <span class=\"keyword\">await</span> exec(</span><br><span class=\"line\">  <span class=\"string\">`sed -i 's/<span class=\"subst\">$&#123;hashInHelm&#125;</span>/<span class=\"subst\">$&#123;hashInManifold&#125;</span>/' values.yaml`</span>,</span><br><span class=\"line\">  puts</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"Updated hash in values.yaml. ✅\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> BASE64_yaml = base64_encode(<span class=\"string\">\"values.yaml\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> Payload = &#123;</span><br><span class=\"line\">  branch: newBranch,</span><br><span class=\"line\">  content: BASE64_yaml,</span><br><span class=\"line\">  commit_message: <span class=\"string\">`update hash to <span class=\"subst\">$&#123;hashInManifold&#125;</span>`</span>,</span><br><span class=\"line\">  encoding: <span class=\"string\">\"base64\"</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> createNewBranch = <span class=\"keyword\">await</span> service.Branches.create(</span><br><span class=\"line\">  HELM_CHART_PROJECT_ID,</span><br><span class=\"line\">  newBranch,</span><br><span class=\"line\">  <span class=\"string\">\"master\"</span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`Created a branch <span class=\"subst\">$&#123;newBranch&#125;</span> in helm-chart repo. ✅`</span>);</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> updatedFileInHelm = <span class=\"keyword\">await</span> exec(<span class=\"string\">`curl --request PUT --header 'PRIVATE-TOKEN:<span class=\"subst\">$&#123;PRIVATE_TOKEN&#125;</span>' --header \"Content-Type: application/json\" \\</span></span><br><span class=\"line\"><span class=\"string\">      --data '<span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">        Payload</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">      )&#125;</span>' \"<span class=\"subst\">$&#123;HOST&#125;</span>/api/v4/projects/<span class=\"subst\">$&#123;HELM_CHART_PROJECT_ID&#125;</span>/repository/files/charts%2Fdata-engine%2Fvalues.yaml\"`</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`Updated value.yaml file in helm-chart repo. ✅`</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">`Unable to update file. ❌`</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * projectId: ProjectId,</span></span><br><span class=\"line\"><span class=\"comment\"> * sourceBranch: string,</span></span><br><span class=\"line\"><span class=\"comment\"> * targetBranch: string,</span></span><br><span class=\"line\"><span class=\"comment\"> * title: string,</span></span><br><span class=\"line\"><span class=\"comment\"> * options: RequestOptions,</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> createMr = <span class=\"keyword\">await</span> service.MergeRequests.create(</span><br><span class=\"line\">  HELM_CHART_PROJECT_ID,</span><br><span class=\"line\">  newBranch,</span><br><span class=\"line\">  <span class=\"string\">\"master\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"WIP: update manifold hash\"</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    description: <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">## Description</span></span><br><span class=\"line\"><span class=\"string\">### related commits</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$&#123;_.uniq(description.commits).join(<span class=\"string\">\"\\n\"</span>)&#125;</span></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### related issues:</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$&#123;_.uniq(description.issues).join(<span class=\"string\">\"\\n\"</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"Created a merge request in helm-chart repo. ✅\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`Here is the link: <span class=\"subst\">$&#123;createMr.web_url&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"things-to-improve\">Things to improve</h2>\n<p>Above are a relatively simple and straightforward way to create merge requests base on changes. We did observe several problems in the process and find improvements to be done in future.</p>\n<ul>\n<li>\n<p>Only create MRs in batches or close the MRs that are included in the current MR. MRs are created for each change now, then populate the whole merge list if the previous ones are not merge in time.</p>\n</li>\n<li>\n<p>It would be nice that we provide a link with <code>Create MR</code> button for users to trigger the creation.</p>\n</li>\n<li>\n<p>Better code abstraction for different project usage.</p>\n</li>\n<li>\n<p>Better organization of description and commit messages.</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2>Background</h2>\n<p>Kubernetes is the new trend to manage cloud-based applications and also our main tool for orchestration. Each of our service is running inside an individual docker container and we use <a href=\"https://helm.sh/docs/developing_charts/\" target=\"_blank\" rel=\"noopener\">helm charts</a> to configure each pod. For codebase management, we use gitlab, which is perfect for collaboration inside a team that hosts code server by themselves.</p>\n<p>In production, everytime that we update our service version (either front end or back end), we need to update the hash inside the helm charts. Since we have a requirement for release notes to include <strong>bug fix</strong> or <strong>new features</strong>, <strong>related commits</strong> or <strong>tickets</strong> have to be included inside the body of gitlab merge request.</p>\n<p>We are all lazy developers and try to avoid tedious work that could be automated by codes.</p>\n<p>So the <strong>workflow</strong> I want to achieve is that whenever we merge a feature branch to the <strong>master</strong>, we collect all the <strong>related issues</strong> and <strong>squashed commits</strong>. Ideally, we set a merge request <strong>interval</strong> to avoid too frequent merge requests. Then we compare the latest master hash and the one in the helm charts, checking if the interval is longer enough for us to create a new merge request. Last but not the least, the whole step should be a phase in the gitlab CI.</p>\n<p>Luckily, <a href=\"https://docs.gitlab.com/ee/api/\" target=\"_blank\" rel=\"noopener\">gitlab API</a> provides all the functions we need.</p>\n<h2>Tools</h2>\n<p>Before we proceed, we need a set of command line tools to boost our efficiency.</p>\n<h3>jq</h3>\n<blockquote>\n<p>jq is like sed for JSON data<br>\nYou can use <code>jq</code> to easily extract useful information and format them in the way you want. For example:</p>\n</blockquote>\n<ul>\n<li>extract the first element from a <code>json array</code>:</li>\n</ul>\n<p><code>cat json | jq .[0]</code></p>\n<ul>\n<li>get a new json in the given format:</li>\n</ul>\n<p><code>jq '.[] | {message: .commit.message, name: .commit.committer.name}'</code></p>\n<p>You can even use conditional operator or loop functions with <code>jq</code>, which is definitely worth checking out the <a href=\"https://stedolan.github.io/jq/manual/\" target=\"_blank\" rel=\"noopener\">manual</a> if you are dealing with json form cli a lot.</p>\n<h3>yq</h3>\n<p>yq is similar to jq, but especially for <code>yaml</code> files. It’s also written in python.</p>\n<h3>gsed(sed)</h3>\n<p><code>sed</code> is a very handy tool on the unix system to perform basic text transformations on an input stream. However, <code>sed</code> on the <code>linux</code> and <code>mac</code> has slight differences, so we can use <code>gsed</code> here to keep it consistent.</p>\n<h3>curl</h3>\n<p><code>curl</code> is basically the postman on the command line, which will be our best friend to test apis from the terminal.</p>\n<h3>base64</h3>\n<p><code>base64</code> encoding is a common way to use textual data to store the binary data or serialize the files.</p>\n<h2>Step by step</h2>\n<p>I’m using <a href=\"https://www.npmjs.com/package/gitlab\" target=\"_blank\" rel=\"noopener\">node client</a> from gitlab here, but you can use any language to write the script.</p>\n<h3>Import the dependencies</h3>\n<p>Here’s the modules that I use:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; ProjectsBundle &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">\"gitlab\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> yaml = <span class=\"built_in\">require</span>(<span class=\"string\">\"js-yaml\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> exec = <span class=\"built_in\">require</span>(<span class=\"string\">\"await-exec\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> _ = <span class=\"built_in\">require</span>(<span class=\"string\">\"lodash\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> moment = <span class=\"built_in\">require</span>(<span class=\"string\">\"moment\"</span>);</span><br></pre></td></tr></table></figure>\n<h3>Fetch helm-chart file</h3>\n<p>We use gitlab client to set up the project info:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> service = <span class=\"keyword\">new</span> ProjectsBundle(&#123;</span><br><span class=\"line\">  url: HOST,</span><br><span class=\"line\">  token: PRIVATE_TOKEN,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Then we fetched the <code>values.yaml</code> file.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> valuesFile = <span class=\"keyword\">await</span> service.RepositoryFiles.show(</span><br><span class=\"line\">    HELM_CHART_PROJECT_ID,</span><br><span class=\"line\">    <span class=\"string\">\"path/to/values.yaml\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"master\"</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">\"Unable to fetch values.yaml file. ❌\"</span>);</span><br><span class=\"line\">  process.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The response we get from the api so far is encoded in <code>base64</code>, so we need to decode it in plain text:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; content &#125; = valuesFile;</span><br><span class=\"line\"><span class=\"keyword\">const</span> generatedFile = <span class=\"keyword\">await</span> exec(</span><br><span class=\"line\">  <span class=\"string\">`echo <span class=\"subst\">$&#123;content&#125;</span> | base64 --decode &gt; values.yaml`</span>,</span><br><span class=\"line\">  puts</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h3>Compare the commit diff and time diff</h3>\n<p>Next, We check whether the commit hash changed and whether time interval met our requirement, otherwise we don’t need to make next move.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// get commit hash from helm chart</span></span><br><span class=\"line\"> <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> doc = yaml.safeLoad(fs.readFileSync(<span class=\"string\">\"./values.yaml\"</span>, <span class=\"string\">\"utf8\"</span>));</span><br><span class=\"line\">   hashInHelm = doc.image.tag;</span><br><span class=\"line\"> &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.error(e);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">const</span> oldCommit = <span class=\"keyword\">await</span> service.Commits.show(PROJECT_ID, hashInHelm);</span><br><span class=\"line\"> lastCommitTime = oldCommit[<span class=\"string\">\"created_at\"</span>];</span><br><span class=\"line\"> <span class=\"keyword\">let</span> sinceTime = moment(lastCommitTime)</span><br><span class=\"line\">   .add(<span class=\"number\">1</span>, <span class=\"string\">\"minutes\"</span>)</span><br><span class=\"line\">   .format();</span><br><span class=\"line\"> <span class=\"keyword\">const</span> fetchMasterCommits = <span class=\"keyword\">await</span> exec(</span><br><span class=\"line\">   <span class=\"string\">`curl -H \"PRIVATE-TOKEN:<span class=\"subst\">$&#123;PRIVATE_TOKEN&#125;</span>\" <span class=\"subst\">$&#123;HOST&#125;</span>/api/v4/projects/<span class=\"subst\">$&#123;PROJECT_ID&#125;</span>/repository/commits?since=<span class=\"subst\">$&#123;sinceTime&#125;</span>`</span></span><br><span class=\"line\"> );</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (fetchMasterCommits.error) &#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.error(<span class=\"string\">`fetchMasterCommits error: <span class=\"subst\">$&#123;fetchMasterCommits.error&#125;</span> ❌`</span>);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> masterCommits = <span class=\"built_in\">JSON</span>.parse(fetchMasterCommits.stdout);</span><br><span class=\"line\"> <span class=\"keyword\">if</span> (masterCommits.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(<span class=\"string\">\"The hash in the helm chart is the latest one.\"</span>);</span><br><span class=\"line\">   process.exit(<span class=\"number\">0</span>);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> hashInRepo = masterCommits[<span class=\"number\">0</span>].short_id;</span><br><span class=\"line\"> <span class=\"keyword\">const</span> currentDate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"> <span class=\"keyword\">const</span> lastUpdateDate = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(lastCommitTime)</span><br><span class=\"line\"> <span class=\"comment\">// only continue the script when the hash changed and the time diff is large than the setting</span></span><br><span class=\"line\"> <span class=\"keyword\">if</span> (</span><br><span class=\"line\">   hashInHelm !== hashInManifold &amp;&amp;</span><br><span class=\"line\">   currentDate - lastUpdateDate &gt; TIME_INTERVAL</span><br><span class=\"line\"> ) &#123;</span><br><span class=\"line\">   ...</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>get related <code>merge requests</code> and <code>commit messages</code></li>\n</ul>\n<p>In order to create a merge request with enough information, we can fetch merge requests and commit messages that are related to this specific commit.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> description = &#123;</span><br><span class=\"line\">  commits: [],</span><br><span class=\"line\">  issues: [],</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">masterCommits</span><br><span class=\"line\">  .map(<span class=\"function\"><span class=\"params\">commit</span> =&gt;</span> commit.id)</span><br><span class=\"line\">  .forEach(<span class=\"keyword\">async</span> id =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> mergeRequests;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      mergeRequests = <span class=\"keyword\">await</span> service.Commits.mergeRequests(PROJECT_ID, id);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(<span class=\"string\">`Unable to fetch merge requests for <span class=\"subst\">$&#123;id&#125;</span>. <span class=\"subst\">$&#123;e&#125;</span> ❌`</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// if no merge requests found, just use the commit message</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(mergeRequests) &amp;&amp; mergeRequests.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> c = _.find(masterCommits, o =&gt; o.id === id);</span><br><span class=\"line\">      description.commits.push(<span class=\"string\">`<span class=\"subst\">$&#123;c.short_id&#125;</span> - <span class=\"subst\">$&#123;c.message&#125;</span>`</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// otherwise, format the description as [title](web_url)</span></span><br><span class=\"line\">      mergeRequests</span><br><span class=\"line\">        .map(<span class=\"function\"><span class=\"params\">m</span> =&gt;</span> m.iid)</span><br><span class=\"line\">        .forEach(<span class=\"keyword\">async</span> iid =&gt; &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> closedIssues = <span class=\"keyword\">await</span> service.MergeRequests.closesIssues(</span><br><span class=\"line\">            PROJECT_ID,</span><br><span class=\"line\">            iid</span><br><span class=\"line\">          );</span><br><span class=\"line\">          closedIssues.forEach(<span class=\"function\"><span class=\"params\">issue</span> =&gt;</span> &#123;</span><br><span class=\"line\">            description.issues.push(<span class=\"string\">`[<span class=\"subst\">$&#123;issue.title&#125;</span>](<span class=\"subst\">$&#123;issue.web_url&#125;</span>)\\n`</span>);</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Create a new merge request</li>\n</ul>\n<p>In the final step, we create a new branch and apply the hash change that we made. Then we make a new merge request with all the useful information.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> newBranch = <span class=\"string\">`change-hash-<span class=\"subst\">$&#123;hashInManifold&#125;</span>`</span>;</span><br><span class=\"line\"><span class=\"comment\">// replace the hash</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> updatedFile = <span class=\"keyword\">await</span> exec(</span><br><span class=\"line\">  <span class=\"string\">`sed -i 's/<span class=\"subst\">$&#123;hashInHelm&#125;</span>/<span class=\"subst\">$&#123;hashInManifold&#125;</span>/' values.yaml`</span>,</span><br><span class=\"line\">  puts</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"Updated hash in values.yaml. ✅\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> BASE64_yaml = base64_encode(<span class=\"string\">\"values.yaml\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> Payload = &#123;</span><br><span class=\"line\">  branch: newBranch,</span><br><span class=\"line\">  content: BASE64_yaml,</span><br><span class=\"line\">  commit_message: <span class=\"string\">`update hash to <span class=\"subst\">$&#123;hashInManifold&#125;</span>`</span>,</span><br><span class=\"line\">  encoding: <span class=\"string\">\"base64\"</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">const</span> createNewBranch = <span class=\"keyword\">await</span> service.Branches.create(</span><br><span class=\"line\">  HELM_CHART_PROJECT_ID,</span><br><span class=\"line\">  newBranch,</span><br><span class=\"line\">  <span class=\"string\">\"master\"</span></span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`Created a branch <span class=\"subst\">$&#123;newBranch&#125;</span> in helm-chart repo. ✅`</span>);</span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> updatedFileInHelm = <span class=\"keyword\">await</span> exec(<span class=\"string\">`curl --request PUT --header 'PRIVATE-TOKEN:<span class=\"subst\">$&#123;PRIVATE_TOKEN&#125;</span>' --header \"Content-Type: application/json\" \\</span></span><br><span class=\"line\"><span class=\"string\">      --data '<span class=\"subst\">$&#123;<span class=\"built_in\">JSON</span>.stringify(</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">        Payload</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">      )&#125;</span>' \"<span class=\"subst\">$&#123;HOST&#125;</span>/api/v4/projects/<span class=\"subst\">$&#123;HELM_CHART_PROJECT_ID&#125;</span>/repository/files/charts%2Fdata-engine%2Fvalues.yaml\"`</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">`Updated value.yaml file in helm-chart repo. ✅`</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">`Unable to update file. ❌`</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * projectId: ProjectId,</span></span><br><span class=\"line\"><span class=\"comment\"> * sourceBranch: string,</span></span><br><span class=\"line\"><span class=\"comment\"> * targetBranch: string,</span></span><br><span class=\"line\"><span class=\"comment\"> * title: string,</span></span><br><span class=\"line\"><span class=\"comment\"> * options: RequestOptions,</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> createMr = <span class=\"keyword\">await</span> service.MergeRequests.create(</span><br><span class=\"line\">  HELM_CHART_PROJECT_ID,</span><br><span class=\"line\">  newBranch,</span><br><span class=\"line\">  <span class=\"string\">\"master\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"WIP: update manifold hash\"</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    description: <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">## Description</span></span><br><span class=\"line\"><span class=\"string\">### related commits</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$&#123;_.uniq(description.commits).join(<span class=\"string\">\"\\n\"</span>)&#125;</span></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">### related issues:</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">$&#123;_.uniq(description.issues).join(<span class=\"string\">\"\\n\"</span>)&#125;</span>`</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"Created a merge request in helm-chart repo. ✅\"</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">`Here is the link: <span class=\"subst\">$&#123;createMr.web_url&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>\n<h2>Things to improve</h2>\n<p>Above are a relatively simple and straightforward way to create merge requests base on changes. We did observe several problems in the process and find improvements to be done in future.</p>\n<ul>\n<li>\n<p>Only create MRs in batches or close the MRs that are included in the current MR. MRs are created for each change now, then populate the whole merge list if the previous ones are not merge in time.</p>\n</li>\n<li>\n<p>It would be nice that we provide a link with <code>Create MR</code> button for users to trigger the creation.</p>\n</li>\n<li>\n<p>Better code abstraction for different project usage.</p>\n</li>\n<li>\n<p>Better organization of description and commit messages.</p>\n</li>\n</ul>\n"},{"title":"一些刷题常用的 python 技巧","catalog":true,"date":"2019-08-17T02:51:10.000Z","subtitle":null,"header-img":"antelope_valley.JPG","_content":"\nPython 越来越多地成为大家刷题的主流语言，主要原因是它的语法非常简洁明了。因此我们能节省更多的时间，来关注算法和数据结构本身。\n\n而用好 Python 自身独有的一些语法特性，不仅能更节省时间，也能让代码看起来更加优雅。这里我总结了一些我自己刷题过程中用到的一些常用的功能。以下以 python3 为例， python2 略有差异。\n\n## List\n\nPython 的列表 List 基本就是其它语言的 Array.\n\n### Initialization 初始化\n\nList 的初始化一般用 List comprehension，往往能一行解决问题\n\n```python\n# 1d array\nl = [0 for _ in range(len(array)]\n\n# 2d\nl = [[0] for i in range(cols) for j in range(rows)]\n```\n\n### Start from the behind\n\n你可以轻松从后往前访问：\n\n```python\n\nlastElement = l[-1]\n\nlastTwo = l[-2:]\n\nfor i in range(0, -10, -1)\n# 0, -1, -2, -3, -4, -5, -6, -7, -8, -9\n```\n\n### copy 复制\n\n#### shallow copy 浅拷贝\n\n```\nl2 = l1[:]\n# or\nl2 = l1.copy()\n```\n\n浅复制的问题在于，如果 l1 内部还有 list，那么这种嵌套的索引不能被复制，比如：\n\n```\na = [1, 2, [3, 4]]\nb = a[:]\na[2].append(5)\nprint(b)\n# [1, 2, [3, 4, 5]]\n```\n\n#### deep copy 深拷贝\n\n所以如果要做深拷贝，要节制自带库 `copy`\n\n```\nimport copy\n\ncopy.deepcopy()\n```\n\n### enumerate 枚举\n\n当我们需要枚举一个数组并同时获得值与 index 的时候可以使用：\n\n```\nl = [\"a\", \"b\", \"c\"]\n\nfor i, v in enumerate(l):\n    print(i, v)\n# 0 a\n# 1 b\n# 2 c\n```\n\n### zip\n\n`zip` 本意就是拉链，可以想象成将两个数组像拉链一样挨个聚合：\n\n```\n>>> x = [1, 2, 3]\n>>> y = [4, 5, 6]\n>>> zipped = zip(x, y)\n>>> list(zipped)\n[(1, 4), (2, 5), (3, 6)]\n```\n\n### reduce\n\n`reduce` 可以分别对相邻元素使用同一种计算规则，同时每一步结果作为下一步的参数，很典型的函数式编程用法。\n\n```\n# importing functools for reduce()\nimport functools\n# initializing list\nlis = [ 1, 3, 5, 6, 2, ]\n\n# using reduce to compute sum of list\nprint (\"The sum of the list elements is : \",end=\"\")\nprint (functools.reduce(lambda a,b : a+b,lis))\n\n# The sum of the list elements is : 17\n\n```\n\n### map\n\n可以将参数一一映射来计算， 比如\n\n```\ndate = \"2019-8-15\"\nY, M, D = map(int, date.split('-'))\n# Y = 2019, M = 8, D = 15\n```\n\n## deque\n\nlist 删除末尾的操作是`O(1)`的，但是删除头操作就是`O(n)`，这时候我们就需要一个双端队列 `deque`。首尾的常规操作为：\n\n- `append`，添加到末尾\n- `appendleft`, 添加到开头\n- `pop`, 剔除末尾\n- `popleft`，移除开头\n\n## sorted\n\nlist 自身有自带的 sort(), 但是它不返回新的 list. `sorted` 能返回一个新的 list, 并且支持传入参数`reverse`。\n\n比如我们有一个 tuple 的数组，我们想按照 tuple 的第一个元素进行排序：\n\n```python\nl1 = [(1,2), (0,1), (3,10) ]\n\nl2 = sorted(l1, key=lambda x: x[0])\n\n# l2 = [(0, 1), (1, 2), (3, 10)]\n```\n\n这里的 key 允许传入一个自定义参数，也可以用自带函数进行比较，比如在一个 string 数组里只想比较小写，可以传入`key=str.lower`\n\n```python\nl1 = [\"banana\",\"APPLE\", \"Watermelon\"]\nl2 = sorted(l1, key=str.lower)\nprint(l2)\n\n# ['APPLE', 'banana', 'Watermelon']\n```\n\n### lambda\n\n你注意到我们在上面使用了 `lambda` 来定义一个匿名函数，十分方便。如果你熟悉其它语言类似 JS 的话，可以把它理解成一个 callback 函数，参数名一一对应就行。\n\n### cmp_to_key\n\n在 python3 中，sorted 函数取消了自带的`cmp`函数，需要借助`functools` 库中的 `cmp_to_key`来做比较。\n比如如果要按照数组元素的绝对值来排序：\n\n```\nfrom functools import cmp_to_key\ndef absSort(arr):\n    newarr = sorted(arr, key = cmp_to_key(sortfunc))\n    return newarr\ndef sortfunc(a, b):\n    if abs(a) < abs(b):\n      return -1\n    elif abs(a) > abs(b):\n      return 1\n    else:\n      return a - b\n```\n\n## set\n\nset 的查找操作复杂度为`O(1)`，有时候可以替代`dict` 来存储中间过程。\n\n- `add` : set 的添加是 `add` 不是`append`\n\n- `remove` vs `discard`: 都是删除操作，区别在于`remove`不存在的元素会报错，`discard`不会。\n- `union`, `intersection`: 快速获得并集和交集，方便一些去重操作。\n\n## dict\n\n字典，相当于其它语言中的`map`, `hashtable`, `hashmap`之类的，读取操作也是`O(1)` 复杂度\n\n### keys(), values(), items()\n\n这三个方法可以分别获得`key`, `value`, `{key: value}`的数组。\n\n### setdefault\n\n这个函数经常在初始化字典时候使用，如果某个`key`在字典中存在，返回它的`value`, 否则返回你给的 default 值。比如在建一个 trie 树的时候\n\n```python\nnode = self.root\nfor char in word:\n    node = node.setdefault(char, {})\n```\n\n### OrderedDict\n\nOrderedDict 能记录你 key 和 value 插入的顺序，底层其实是一个双向链表加哈希表的实现。我们甚至可以使用`move_to_end`这样的函数：\n\n```python\n>>> d = OrderedDict.fromkeys('abcde')\n>>> d.move_to_end('b')\n>>> ''.join(d.keys())\n'acdeb'\n# 放开头\n>>> d.move_to_end('b', last=False)\n>>> ''.join(d.keys())\n'bacde'\n```\n\n### defaultdict\n\n`defaultdict`可以很好地来解决一些初始化的问题，比如 value 是一个 list，每次需要判断 key 是否存在的情况。这时我们可以直接定义\n\n```python\nd = defaultdict(list)\n\ns = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]\nfor k, v in s:\n     d[k].append(v)\nsorted(d.items())\n# [('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]\n```\n\n## heapq\n\nheapq 就是 python 的 priority queue，`heapq[0]`即为堆顶元素。\n\nheapq 的实现是小顶堆，如果需要一个大顶堆，常规的一个做法是把值取负存入，取出时再反转。\n以下是借助 heapq 来实现 heapsort 的例子：\n\n```\n>>> def heapsort(iterable):\n...     h = []\n...     for value in iterable:\n...         heappush(h, value)\n...     return [heappop(h) for i in range(len(h))]\n...\n>>> heapsort([1, 3, 5, 7, 9, 2, 4, 6, 8, 0])\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n```\n\n## bisect\n\npython 自带二分查找的库，在一些不要求实现 binary search，但是借助它能加速的场景下可以直接使用。\n\n```python\nbisect.bisect(a, x, lo=0, hi=len(a))\n这里的参数分别为 数组，要查找的数，范围起始点，范围结束点\n```\n\n相似函数还有\n\n- `bisect.bisect_left`\n- `bisect.bisect_right`\n  分别返回可以插入 x 的最左和最右 index\n\n## Counter\n\nCounter 接受的参数可以是一个 string, 或者一个 list, mapping\n\n```\n>>> c = Counter()                           # a new, empty counter\n>>> c = Counter('gallahad')                 # a new counter from an iterable\n>>> c = Counter({'red': 4, 'blue': 2})      # a new counter from a mapping\n>>> c = Counter(cats=4, dogs=8)             # a new counter from keyword args\n```\n\n- `most_common(n)`\n  可以得到出现次数最多的 n 个数：\n\n```\n>>> Counter('abracadabra').most_common(3)  # doctest: +SKIP\n[('a', 5), ('r', 2), ('b', 2)]\n```\n\n## strings\n\n### ord, char\n\nord 返回单个字符的 unicode:\n\n```\n>>> ord('a')\n97\n```\n\nchar 则是反向操作：\n\n```\n>>> chr(100)\n'd'\n```\n\n### strip\n\n移除 string 前后的字符串，默认来移除空格，但是也可以给一个字符串，然后会移除含有这个字符串的部分：\n\n```py\n>>> '   spacious   '.strip()\n'spacious'\n>>> 'www.example.com'.strip('cmowz.')\n'example'\n```\n\n### split\n\n按照某个字符串来切分，返回一个 list, 可以传入一个参数`maxsplit`来限定分离数。\n\n```\n>>> '1,2,3'.split(',')\n['1', '2', '3']\n>>> '1,2,3'.split(',', maxsplit=1)\n['1', '2,3']\n>>> '1,2,,3,'.split(',')\n['1', '2', '', '3', '']\n```\n\n## int/ float\n\n### 最大, 最小 number\n\n有时候初始化我们需要设定 `Math.max()` 和 `Math.min()`, 在 python 中分别以 `float('inf')` 和 `float('-inf')`表示\n\n在 python2 中我们也可以这么做：\n\n```\nimport sys\n\n#maxint\nMax = sys.maxint\n```\n\n### 除法\n\n在 python3 中， `/` 会保留浮点，相当于 float 相除，如果需要做到像 pyhton2 中的 int 相除，需要 `//`：\n\n```py\n>>> 3 / 2\n1.5\n>>> 3 // 2\n1\n```\n\n### 次方\n\n在 python 中为 `**`:\n\n```\n>>> 2 ** 10\n1024\n```\n\n## conditions\n\n在 python 的三项表达式(ternary operation) 与其它语言不太一样：\n\n```\nres = a if condition else b\n```\n\n它表示如果 condition 满足，那么 `res = a`, 不然 `res = b`，在类 c 的语言里即为：\n\n```\nres = condition ? a : b;\n```\n\n## any, all\n\n`any(), all()`很好理解，就是字面意思，即参数中任何一个为 true 或者全部为 true 则返回 true。经常可以秀一些骚操作:\n比如 [36. Valid Sudoku](https://leetcode.com/problems/valid-sudoku/) 这题：\n\n```\nclass Solution:\n    def isValidSudoku(self, board: List[List[str]]) -> bool:\n        row = [[x for x in y if x != '.'] for y in board]\n        col = [[x for x in y if x != '.'] for y in zip(*board)]\n        pal = [[board[i+m][j+n] for m in range(3) for n in range(3) if board[i+m][j+n] != '.'] for i in (0, 3, 6) for j in (0, 3, 6)]\n        return all(len(set(x)) == len(x) for x in (*row, *col, *pal))\n```\n\n## itertools\n\n这是 python 自带的迭代器库，有很多实用的、与遍历、迭代相关的函数。\n\n### permutations 排列\n\n```py\npermutations('ABCD', 2)\n# AB AC AD BA BC BD CA CB CD DA DB DC\n```\n\n### combinations 组合\n\n```py\ncombinations('ABCD', 2)\n# AB AC AD BC BD CD\n```\n\n### groupby 合并\n\nhttps://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898\n\n```\n[k for k, g in groupby('AAAABBBCCDAABBB')] --> A B C D A B\n[list(g) for k, g in groupby('AAAABBBCCD')] --> AAAA BBB CC D\n```\n\n## functools\n\n这个库里有很多高阶函数，包括前面介绍到的`cmp_to_key` 以及 `reduce`，但是比较逆天的有 `lru_cache`，即 least recently used cache. 这个 [LRU Cache](https://leetcode.com/problems/lru-cache/)是一个常见的面试题，通常用 hashmap 和双向链表来实现，python 居然直接内置了。\n\n用法即直接作为 decorator 装饰在要 cache 的函数上，以变量值为 key 存储，当反复调用时直接返回计算过的值，例子如下：\n\n### lru_cache\n\nhttps://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution\n\n```py\n  def stoneGameII(self, A: List[int]) -> int:\n        N = len(A)\n        for i in range(N - 2, -1, -1):\n            A[i] += A[i + 1]\n        from functools import lru_cache\n        @lru_cache(None)\n        def dp(i, m):\n            if i + 2 * m >= N: return A[i]\n            return A[i] - min(dp(i + x, max(m, x)) for x in range(1, 2 * m + 1))\n        return dp(0, 1)\n```\n\n## resource\n\n这是一个大神用各种 Python trick 解题的 repo，可供娱乐：\n\nhttps://github.com/cy69855522/Shortest-LeetCode-Python-Solutions\n\n当然 Leetcode 讨论区还会经常见到 `StefanPochmann` 或者 `lee215`这样的大神 Po 一些很秀技的 python 代码，都是学习范本。\n","source":"_posts/python-leetcode-trick.md","raw":"---\ntitle: 一些刷题常用的 python 技巧\ncatalog: true\ndate: 2019-08-16 22:51:10\nsubtitle:\nheader-img: \"antelope_valley.JPG\"\ntags:\n  - python\n  - leetcode\n  - algorithm\n---\n\nPython 越来越多地成为大家刷题的主流语言，主要原因是它的语法非常简洁明了。因此我们能节省更多的时间，来关注算法和数据结构本身。\n\n而用好 Python 自身独有的一些语法特性，不仅能更节省时间，也能让代码看起来更加优雅。这里我总结了一些我自己刷题过程中用到的一些常用的功能。以下以 python3 为例， python2 略有差异。\n\n## List\n\nPython 的列表 List 基本就是其它语言的 Array.\n\n### Initialization 初始化\n\nList 的初始化一般用 List comprehension，往往能一行解决问题\n\n```python\n# 1d array\nl = [0 for _ in range(len(array)]\n\n# 2d\nl = [[0] for i in range(cols) for j in range(rows)]\n```\n\n### Start from the behind\n\n你可以轻松从后往前访问：\n\n```python\n\nlastElement = l[-1]\n\nlastTwo = l[-2:]\n\nfor i in range(0, -10, -1)\n# 0, -1, -2, -3, -4, -5, -6, -7, -8, -9\n```\n\n### copy 复制\n\n#### shallow copy 浅拷贝\n\n```\nl2 = l1[:]\n# or\nl2 = l1.copy()\n```\n\n浅复制的问题在于，如果 l1 内部还有 list，那么这种嵌套的索引不能被复制，比如：\n\n```\na = [1, 2, [3, 4]]\nb = a[:]\na[2].append(5)\nprint(b)\n# [1, 2, [3, 4, 5]]\n```\n\n#### deep copy 深拷贝\n\n所以如果要做深拷贝，要节制自带库 `copy`\n\n```\nimport copy\n\ncopy.deepcopy()\n```\n\n### enumerate 枚举\n\n当我们需要枚举一个数组并同时获得值与 index 的时候可以使用：\n\n```\nl = [\"a\", \"b\", \"c\"]\n\nfor i, v in enumerate(l):\n    print(i, v)\n# 0 a\n# 1 b\n# 2 c\n```\n\n### zip\n\n`zip` 本意就是拉链，可以想象成将两个数组像拉链一样挨个聚合：\n\n```\n>>> x = [1, 2, 3]\n>>> y = [4, 5, 6]\n>>> zipped = zip(x, y)\n>>> list(zipped)\n[(1, 4), (2, 5), (3, 6)]\n```\n\n### reduce\n\n`reduce` 可以分别对相邻元素使用同一种计算规则，同时每一步结果作为下一步的参数，很典型的函数式编程用法。\n\n```\n# importing functools for reduce()\nimport functools\n# initializing list\nlis = [ 1, 3, 5, 6, 2, ]\n\n# using reduce to compute sum of list\nprint (\"The sum of the list elements is : \",end=\"\")\nprint (functools.reduce(lambda a,b : a+b,lis))\n\n# The sum of the list elements is : 17\n\n```\n\n### map\n\n可以将参数一一映射来计算， 比如\n\n```\ndate = \"2019-8-15\"\nY, M, D = map(int, date.split('-'))\n# Y = 2019, M = 8, D = 15\n```\n\n## deque\n\nlist 删除末尾的操作是`O(1)`的，但是删除头操作就是`O(n)`，这时候我们就需要一个双端队列 `deque`。首尾的常规操作为：\n\n- `append`，添加到末尾\n- `appendleft`, 添加到开头\n- `pop`, 剔除末尾\n- `popleft`，移除开头\n\n## sorted\n\nlist 自身有自带的 sort(), 但是它不返回新的 list. `sorted` 能返回一个新的 list, 并且支持传入参数`reverse`。\n\n比如我们有一个 tuple 的数组，我们想按照 tuple 的第一个元素进行排序：\n\n```python\nl1 = [(1,2), (0,1), (3,10) ]\n\nl2 = sorted(l1, key=lambda x: x[0])\n\n# l2 = [(0, 1), (1, 2), (3, 10)]\n```\n\n这里的 key 允许传入一个自定义参数，也可以用自带函数进行比较，比如在一个 string 数组里只想比较小写，可以传入`key=str.lower`\n\n```python\nl1 = [\"banana\",\"APPLE\", \"Watermelon\"]\nl2 = sorted(l1, key=str.lower)\nprint(l2)\n\n# ['APPLE', 'banana', 'Watermelon']\n```\n\n### lambda\n\n你注意到我们在上面使用了 `lambda` 来定义一个匿名函数，十分方便。如果你熟悉其它语言类似 JS 的话，可以把它理解成一个 callback 函数，参数名一一对应就行。\n\n### cmp_to_key\n\n在 python3 中，sorted 函数取消了自带的`cmp`函数，需要借助`functools` 库中的 `cmp_to_key`来做比较。\n比如如果要按照数组元素的绝对值来排序：\n\n```\nfrom functools import cmp_to_key\ndef absSort(arr):\n    newarr = sorted(arr, key = cmp_to_key(sortfunc))\n    return newarr\ndef sortfunc(a, b):\n    if abs(a) < abs(b):\n      return -1\n    elif abs(a) > abs(b):\n      return 1\n    else:\n      return a - b\n```\n\n## set\n\nset 的查找操作复杂度为`O(1)`，有时候可以替代`dict` 来存储中间过程。\n\n- `add` : set 的添加是 `add` 不是`append`\n\n- `remove` vs `discard`: 都是删除操作，区别在于`remove`不存在的元素会报错，`discard`不会。\n- `union`, `intersection`: 快速获得并集和交集，方便一些去重操作。\n\n## dict\n\n字典，相当于其它语言中的`map`, `hashtable`, `hashmap`之类的，读取操作也是`O(1)` 复杂度\n\n### keys(), values(), items()\n\n这三个方法可以分别获得`key`, `value`, `{key: value}`的数组。\n\n### setdefault\n\n这个函数经常在初始化字典时候使用，如果某个`key`在字典中存在，返回它的`value`, 否则返回你给的 default 值。比如在建一个 trie 树的时候\n\n```python\nnode = self.root\nfor char in word:\n    node = node.setdefault(char, {})\n```\n\n### OrderedDict\n\nOrderedDict 能记录你 key 和 value 插入的顺序，底层其实是一个双向链表加哈希表的实现。我们甚至可以使用`move_to_end`这样的函数：\n\n```python\n>>> d = OrderedDict.fromkeys('abcde')\n>>> d.move_to_end('b')\n>>> ''.join(d.keys())\n'acdeb'\n# 放开头\n>>> d.move_to_end('b', last=False)\n>>> ''.join(d.keys())\n'bacde'\n```\n\n### defaultdict\n\n`defaultdict`可以很好地来解决一些初始化的问题，比如 value 是一个 list，每次需要判断 key 是否存在的情况。这时我们可以直接定义\n\n```python\nd = defaultdict(list)\n\ns = [('yellow', 1), ('blue', 2), ('yellow', 3), ('blue', 4), ('red', 1)]\nfor k, v in s:\n     d[k].append(v)\nsorted(d.items())\n# [('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]\n```\n\n## heapq\n\nheapq 就是 python 的 priority queue，`heapq[0]`即为堆顶元素。\n\nheapq 的实现是小顶堆，如果需要一个大顶堆，常规的一个做法是把值取负存入，取出时再反转。\n以下是借助 heapq 来实现 heapsort 的例子：\n\n```\n>>> def heapsort(iterable):\n...     h = []\n...     for value in iterable:\n...         heappush(h, value)\n...     return [heappop(h) for i in range(len(h))]\n...\n>>> heapsort([1, 3, 5, 7, 9, 2, 4, 6, 8, 0])\n[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n```\n\n## bisect\n\npython 自带二分查找的库，在一些不要求实现 binary search，但是借助它能加速的场景下可以直接使用。\n\n```python\nbisect.bisect(a, x, lo=0, hi=len(a))\n这里的参数分别为 数组，要查找的数，范围起始点，范围结束点\n```\n\n相似函数还有\n\n- `bisect.bisect_left`\n- `bisect.bisect_right`\n  分别返回可以插入 x 的最左和最右 index\n\n## Counter\n\nCounter 接受的参数可以是一个 string, 或者一个 list, mapping\n\n```\n>>> c = Counter()                           # a new, empty counter\n>>> c = Counter('gallahad')                 # a new counter from an iterable\n>>> c = Counter({'red': 4, 'blue': 2})      # a new counter from a mapping\n>>> c = Counter(cats=4, dogs=8)             # a new counter from keyword args\n```\n\n- `most_common(n)`\n  可以得到出现次数最多的 n 个数：\n\n```\n>>> Counter('abracadabra').most_common(3)  # doctest: +SKIP\n[('a', 5), ('r', 2), ('b', 2)]\n```\n\n## strings\n\n### ord, char\n\nord 返回单个字符的 unicode:\n\n```\n>>> ord('a')\n97\n```\n\nchar 则是反向操作：\n\n```\n>>> chr(100)\n'd'\n```\n\n### strip\n\n移除 string 前后的字符串，默认来移除空格，但是也可以给一个字符串，然后会移除含有这个字符串的部分：\n\n```py\n>>> '   spacious   '.strip()\n'spacious'\n>>> 'www.example.com'.strip('cmowz.')\n'example'\n```\n\n### split\n\n按照某个字符串来切分，返回一个 list, 可以传入一个参数`maxsplit`来限定分离数。\n\n```\n>>> '1,2,3'.split(',')\n['1', '2', '3']\n>>> '1,2,3'.split(',', maxsplit=1)\n['1', '2,3']\n>>> '1,2,,3,'.split(',')\n['1', '2', '', '3', '']\n```\n\n## int/ float\n\n### 最大, 最小 number\n\n有时候初始化我们需要设定 `Math.max()` 和 `Math.min()`, 在 python 中分别以 `float('inf')` 和 `float('-inf')`表示\n\n在 python2 中我们也可以这么做：\n\n```\nimport sys\n\n#maxint\nMax = sys.maxint\n```\n\n### 除法\n\n在 python3 中， `/` 会保留浮点，相当于 float 相除，如果需要做到像 pyhton2 中的 int 相除，需要 `//`：\n\n```py\n>>> 3 / 2\n1.5\n>>> 3 // 2\n1\n```\n\n### 次方\n\n在 python 中为 `**`:\n\n```\n>>> 2 ** 10\n1024\n```\n\n## conditions\n\n在 python 的三项表达式(ternary operation) 与其它语言不太一样：\n\n```\nres = a if condition else b\n```\n\n它表示如果 condition 满足，那么 `res = a`, 不然 `res = b`，在类 c 的语言里即为：\n\n```\nres = condition ? a : b;\n```\n\n## any, all\n\n`any(), all()`很好理解，就是字面意思，即参数中任何一个为 true 或者全部为 true 则返回 true。经常可以秀一些骚操作:\n比如 [36. Valid Sudoku](https://leetcode.com/problems/valid-sudoku/) 这题：\n\n```\nclass Solution:\n    def isValidSudoku(self, board: List[List[str]]) -> bool:\n        row = [[x for x in y if x != '.'] for y in board]\n        col = [[x for x in y if x != '.'] for y in zip(*board)]\n        pal = [[board[i+m][j+n] for m in range(3) for n in range(3) if board[i+m][j+n] != '.'] for i in (0, 3, 6) for j in (0, 3, 6)]\n        return all(len(set(x)) == len(x) for x in (*row, *col, *pal))\n```\n\n## itertools\n\n这是 python 自带的迭代器库，有很多实用的、与遍历、迭代相关的函数。\n\n### permutations 排列\n\n```py\npermutations('ABCD', 2)\n# AB AC AD BA BC BD CA CB CD DA DB DC\n```\n\n### combinations 组合\n\n```py\ncombinations('ABCD', 2)\n# AB AC AD BC BD CD\n```\n\n### groupby 合并\n\nhttps://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898\n\n```\n[k for k, g in groupby('AAAABBBCCDAABBB')] --> A B C D A B\n[list(g) for k, g in groupby('AAAABBBCCD')] --> AAAA BBB CC D\n```\n\n## functools\n\n这个库里有很多高阶函数，包括前面介绍到的`cmp_to_key` 以及 `reduce`，但是比较逆天的有 `lru_cache`，即 least recently used cache. 这个 [LRU Cache](https://leetcode.com/problems/lru-cache/)是一个常见的面试题，通常用 hashmap 和双向链表来实现，python 居然直接内置了。\n\n用法即直接作为 decorator 装饰在要 cache 的函数上，以变量值为 key 存储，当反复调用时直接返回计算过的值，例子如下：\n\n### lru_cache\n\nhttps://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution\n\n```py\n  def stoneGameII(self, A: List[int]) -> int:\n        N = len(A)\n        for i in range(N - 2, -1, -1):\n            A[i] += A[i + 1]\n        from functools import lru_cache\n        @lru_cache(None)\n        def dp(i, m):\n            if i + 2 * m >= N: return A[i]\n            return A[i] - min(dp(i + x, max(m, x)) for x in range(1, 2 * m + 1))\n        return dp(0, 1)\n```\n\n## resource\n\n这是一个大神用各种 Python trick 解题的 repo，可供娱乐：\n\nhttps://github.com/cy69855522/Shortest-LeetCode-Python-Solutions\n\n当然 Leetcode 讨论区还会经常见到 `StefanPochmann` 或者 `lee215`这样的大神 Po 一些很秀技的 python 代码，都是学习范本。\n","slug":"python-leetcode-trick","published":1,"updated":"2019-08-17T22:54:03.471Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxy8001dx18l3b6ppt9p","content":"<p>Python 越来越多地成为大家刷题的主流语言，主要原因是它的语法非常简洁明了。因此我们能节省更多的时间，来关注算法和数据结构本身。</p>\n<p>而用好 Python 自身独有的一些语法特性，不仅能更节省时间，也能让代码看起来更加优雅。这里我总结了一些我自己刷题过程中用到的一些常用的功能。以下以 python3 为例， python2 略有差异。</p>\n<h2 id=\"list\">List</h2>\n<p>Python 的列表 List 基本就是其它语言的 Array.</p>\n<h3 id=\"initialization-初始化\">Initialization 初始化</h3>\n<p>List 的初始化一般用 List comprehension，往往能一行解决问题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1d array</span></span><br><span class=\"line\">l = [<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> range(len(array)]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2d</span></span><br><span class=\"line\">l = [[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(cols) <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(rows)]</span><br></pre></td></tr></table></figure>\n<h3 id=\"start-from-the-behind\">Start from the behind</h3>\n<p>你可以轻松从后往前访问：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">lastElement = l[<span class=\"number\">-1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">lastTwo = l[<span class=\"number\">-2</span>:]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">-10</span>, <span class=\"number\">-1</span>)</span><br><span class=\"line\"><span class=\"comment\"># 0, -1, -2, -3, -4, -5, -6, -7, -8, -9</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"copy-复制\">copy 复制</h3>\n<h4 id=\"shallow-copy-浅拷贝\">shallow copy 浅拷贝</h4>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">l2</span> = l1[:]</span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\"><span class=\"attr\">l2</span> = l1.copy()</span><br></pre></td></tr></table></figure>\n<p>浅复制的问题在于，如果 l1 内部还有 list，那么这种嵌套的索引不能被复制，比如：</p>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"comment\">[1, 2, <span class=\"comment\">[3, 4]</span>]</span></span><br><span class=\"line\">b = a<span class=\"comment\">[:]</span></span><br><span class=\"line\">a<span class=\"comment\">[2]</span>.append(5)</span><br><span class=\"line\">print(b)</span><br><span class=\"line\"># <span class=\"comment\">[1, 2, <span class=\"comment\">[3, 4, 5]</span>]</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"deep-copy-深拷贝\">deep copy 深拷贝</h4>\n<p>所以如果要做深拷贝，要节制自带库 <code>copy</code></p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import <span class=\"keyword\">copy</span><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\">copy.deepcopy()</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"enumerate-枚举\">enumerate 枚举</h3>\n<p>当我们需要枚举一个数组并同时获得值与 index 的时候可以使用：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i, v <span class=\"keyword\">in</span> enumerate(l):</span><br><span class=\"line\">    <span class=\"builtin-name\">print</span>(i, v)</span><br><span class=\"line\"><span class=\"comment\"># 0 a</span></span><br><span class=\"line\"><span class=\"comment\"># 1 b</span></span><br><span class=\"line\"><span class=\"comment\"># 2 c</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"zip\">zip</h3>\n<p><code>zip</code> 本意就是拉链，可以想象成将两个数组像拉链一样挨个聚合：</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; x = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">&gt;&gt;&gt; y = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>]</span><br><span class=\"line\">&gt;&gt;&gt; zipped = zip(x, y)</span><br><span class=\"line\">&gt;&gt;&gt; <span class=\"type\">list</span>(zipped)</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"number\">4</span>), (<span class=\"number\">2</span>, <span class=\"number\">5</span>), (<span class=\"number\">3</span>, <span class=\"number\">6</span>)]</span><br></pre></td></tr></table></figure>\n<h3 id=\"reduce\">reduce</h3>\n<p><code>reduce</code> 可以分别对相邻元素使用同一种计算规则，同时每一步结果作为下一步的参数，很典型的函数式编程用法。</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># importing functools for reduce()</span></span><br><span class=\"line\">import functools</span><br><span class=\"line\"><span class=\"comment\"># initializing list</span></span><br><span class=\"line\">lis = [ 1, 3, 5, 6, 2, ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># using reduce to compute sum of list</span></span><br><span class=\"line\"><span class=\"builtin-name\">print</span> (<span class=\"string\">\"The sum of the list elements is : \"</span>,<span class=\"attribute\">end</span>=<span class=\"string\">\"\"</span>)</span><br><span class=\"line\"><span class=\"builtin-name\">print</span> (functools.reduce(lambda a,b : a+b,lis))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The sum of the list elements is : 17</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"map\">map</h3>\n<p>可以将参数一一映射来计算， 比如</p>\n<figure class=\"highlight axapta\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">date</span> = <span class=\"string\">\"2019-8-15\"</span></span><br><span class=\"line\">Y, M, D = map(<span class=\"keyword\">int</span>, <span class=\"keyword\">date</span>.split(<span class=\"string\">'-'</span>))</span><br><span class=\"line\"><span class=\"meta\"># Y = 2019, M = 8, D = 15</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"deque\">deque</h2>\n<p>list 删除末尾的操作是<code>O(1)</code>的，但是删除头操作就是<code>O(n)</code>，这时候我们就需要一个双端队列 <code>deque</code>。首尾的常规操作为：</p>\n<ul>\n<li><code>append</code>，添加到末尾</li>\n<li><code>appendleft</code>, 添加到开头</li>\n<li><code>pop</code>, 剔除末尾</li>\n<li><code>popleft</code>，移除开头</li>\n</ul>\n<h2 id=\"sorted\">sorted</h2>\n<p>list 自身有自带的 sort(), 但是它不返回新的 list. <code>sorted</code> 能返回一个新的 list, 并且支持传入参数<code>reverse</code>。</p>\n<p>比如我们有一个 tuple 的数组，我们想按照 tuple 的第一个元素进行排序：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l1 = [(<span class=\"number\">1</span>,<span class=\"number\">2</span>), (<span class=\"number\">0</span>,<span class=\"number\">1</span>), (<span class=\"number\">3</span>,<span class=\"number\">10</span>) ]</span><br><span class=\"line\"></span><br><span class=\"line\">l2 = sorted(l1, key=<span class=\"keyword\">lambda</span> x: x[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># l2 = [(0, 1), (1, 2), (3, 10)]</span></span><br></pre></td></tr></table></figure>\n<p>这里的 key 允许传入一个自定义参数，也可以用自带函数进行比较，比如在一个 string 数组里只想比较小写，可以传入<code>key=str.lower</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l1 = [<span class=\"string\">\"banana\"</span>,<span class=\"string\">\"APPLE\"</span>, <span class=\"string\">\"Watermelon\"</span>]</span><br><span class=\"line\">l2 = sorted(l1, key=str.lower)</span><br><span class=\"line\">print(l2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ['APPLE', 'banana', 'Watermelon']</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"lambda\">lambda</h3>\n<p>你注意到我们在上面使用了 <code>lambda</code> 来定义一个匿名函数，十分方便。如果你熟悉其它语言类似 JS 的话，可以把它理解成一个 callback 函数，参数名一一对应就行。</p>\n<h3 id=\"cmp_to_key\">cmp_to_key</h3>\n<p>在 python3 中，sorted 函数取消了自带的<code>cmp</code>函数，需要借助<code>functools</code> 库中的 <code>cmp_to_key</code>来做比较。<br>\n比如如果要按照数组元素的绝对值来排序：</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">from</span> functools import cmp_to_key</span><br><span class=\"line\">def absSort(arr):</span><br><span class=\"line\">    newarr = sorted(arr, key = cmp_to_key(sortfunc))</span><br><span class=\"line\">    <span class=\"literal\">return</span> newarr</span><br><span class=\"line\">def sortfunc(<span class=\"keyword\">a</span>, b):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">abs</span>(<span class=\"keyword\">a</span>) &lt; <span class=\"built_in\">abs</span>(b):</span><br><span class=\"line\">      <span class=\"literal\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">    elif <span class=\"built_in\">abs</span>(<span class=\"keyword\">a</span>) &gt; <span class=\"built_in\">abs</span>(b):</span><br><span class=\"line\">      <span class=\"literal\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">      <span class=\"literal\">return</span> <span class=\"keyword\">a</span> - b</span><br></pre></td></tr></table></figure>\n<h2 id=\"set\">set</h2>\n<p>set 的查找操作复杂度为<code>O(1)</code>，有时候可以替代<code>dict</code> 来存储中间过程。</p>\n<ul>\n<li>\n<p><code>add</code> : set 的添加是 <code>add</code> 不是<code>append</code></p>\n</li>\n<li>\n<p><code>remove</code> vs <code>discard</code>: 都是删除操作，区别在于<code>remove</code>不存在的元素会报错，<code>discard</code>不会。</p>\n</li>\n<li>\n<p><code>union</code>, <code>intersection</code>: 快速获得并集和交集，方便一些去重操作。</p>\n</li>\n</ul>\n<h2 id=\"dict\">dict</h2>\n<p>字典，相当于其它语言中的<code>map</code>, <code>hashtable</code>, <code>hashmap</code>之类的，读取操作也是<code>O(1)</code> 复杂度</p>\n<h3 id=\"keys-values-items\">keys(), values(), items()</h3>\n<p>这三个方法可以分别获得<code>key</code>, <code>value</code>, <code>{key: value}</code>的数组。</p>\n<h3 id=\"setdefault\">setdefault</h3>\n<p>这个函数经常在初始化字典时候使用，如果某个<code>key</code>在字典中存在，返回它的<code>value</code>, 否则返回你给的 default 值。比如在建一个 trie 树的时候</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node = self.root</span><br><span class=\"line\"><span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> word:</span><br><span class=\"line\">    node = node.setdefault(char, &#123;&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"ordereddict\">OrderedDict</h3>\n<p>OrderedDict 能记录你 key 和 value 插入的顺序，底层其实是一个双向链表加哈希表的实现。我们甚至可以使用<code>move_to_end</code>这样的函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = OrderedDict.fromkeys(<span class=\"string\">'abcde'</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.move_to_end(<span class=\"string\">'b'</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">''</span>.join(d.keys())</span><br><span class=\"line\"><span class=\"string\">'acdeb'</span></span><br><span class=\"line\"><span class=\"comment\"># 放开头</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.move_to_end(<span class=\"string\">'b'</span>, last=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">''</span>.join(d.keys())</span><br><span class=\"line\"><span class=\"string\">'bacde'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"defaultdict\">defaultdict</h3>\n<p><code>defaultdict</code>可以很好地来解决一些初始化的问题，比如 value 是一个 list，每次需要判断 key 是否存在的情况。这时我们可以直接定义</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d = defaultdict(list)</span><br><span class=\"line\"></span><br><span class=\"line\">s = [(<span class=\"string\">'yellow'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'yellow'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'red'</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">     d[k].append(v)</span><br><span class=\"line\">sorted(d.items())</span><br><span class=\"line\"><span class=\"comment\"># [('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"heapq\">heapq</h2>\n<p>heapq 就是 python 的 priority queue，<code>heapq[0]</code>即为堆顶元素。</p>\n<p>heapq 的实现是小顶堆，如果需要一个大顶堆，常规的一个做法是把值取负存入，取出时再反转。<br>\n以下是借助 heapq 来实现 heapsort 的例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">heapsort</span><span class=\"params\">(iterable)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">... </span>    h = []</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">for</span> value <span class=\"keyword\">in</span> iterable:</span><br><span class=\"line\"><span class=\"meta\">... </span>        heappush(h, value)</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">return</span> [heappop(h) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(h))]</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>heapsort([<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>, <span class=\"number\">0</span>])</span><br><span class=\"line\">[<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>]</span><br></pre></td></tr></table></figure>\n<h2 id=\"bisect\">bisect</h2>\n<p>python 自带二分查找的库，在一些不要求实现 binary search，但是借助它能加速的场景下可以直接使用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bisect.bisect(a, x, lo=<span class=\"number\">0</span>, hi=len(a))</span><br><span class=\"line\">这里的参数分别为 数组，要查找的数，范围起始点，范围结束点</span><br></pre></td></tr></table></figure>\n<p>相似函数还有</p>\n<ul>\n<li><code>bisect.bisect_left</code></li>\n<li><code>bisect.bisect_right</code><br>\n分别返回可以插入 x 的最左和最右 index</li>\n</ul>\n<h2 id=\"counter\">Counter</h2>\n<p>Counter 接受的参数可以是一个 string, 或者一个 list, mapping</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter()                           <span class=\"comment\"># a new, empty counter</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter(<span class=\"string\">'gallahad'</span>)                 <span class=\"comment\"># a new counter from an iterable</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter(&#123;<span class=\"string\">'red'</span>: <span class=\"number\">4</span>, <span class=\"string\">'blue'</span>: <span class=\"number\">2</span>&#125;)      <span class=\"comment\"># a new counter from a mapping</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter(cats=<span class=\"number\">4</span>, dogs=<span class=\"number\">8</span>)             <span class=\"comment\"># a new counter from keyword args</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>most_common(n)</code><br>\n可以得到出现次数最多的 n 个数：</li>\n</ul>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; Counter(<span class=\"string\">'abracadabra'</span>).most_common(<span class=\"number\">3</span>)  <span class=\"comment\"># doctest: +SKIP</span></span><br><span class=\"line\">[(<span class=\"string\">'a'</span>, <span class=\"number\">5</span>), (<span class=\"string\">'r'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'b'</span>, <span class=\"number\">2</span>)]</span><br></pre></td></tr></table></figure>\n<h2 id=\"strings\">strings</h2>\n<h3 id=\"ord-char\">ord, char</h3>\n<p>ord 返回单个字符的 unicode:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; ord(<span class=\"string\">'a'</span>)</span><br><span class=\"line\"><span class=\"number\">97</span></span><br></pre></td></tr></table></figure>\n<p>char 则是反向操作：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; chr(<span class=\"number\">100</span>)</span><br><span class=\"line\"><span class=\"string\">'d'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"strip\">strip</h3>\n<p>移除 string 前后的字符串，默认来移除空格，但是也可以给一个字符串，然后会移除含有这个字符串的部分：</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">'   spacious   '</span>.strip()</span><br><span class=\"line\"><span class=\"string\">'spacious'</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">'www.example.com'</span>.strip(<span class=\"string\">'cmowz.'</span>)</span><br><span class=\"line\"><span class=\"string\">'example'</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"split\">split</h3>\n<p>按照某个字符串来切分，返回一个 list, 可以传入一个参数<code>maxsplit</code>来限定分离数。</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; <span class=\"string\">'1,2,3'</span>.split(<span class=\"string\">','</span>)</span><br><span class=\"line\">[<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; <span class=\"string\">'1,2,3'</span>.split(<span class=\"string\">','</span>, maxsplit=<span class=\"number\">1</span>)</span><br><span class=\"line\">[<span class=\"string\">'1'</span>, <span class=\"string\">'2,3'</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; <span class=\"string\">'1,2,,3,'</span>.split(<span class=\"string\">','</span>)</span><br><span class=\"line\">[<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">''</span>, <span class=\"string\">'3'</span>, <span class=\"string\">''</span>]</span><br></pre></td></tr></table></figure>\n<h2 id=\"int-float\">int/ float</h2>\n<h3 id=\"最大-最小-number\">最大, 最小 number</h3>\n<p>有时候初始化我们需要设定 <code>Math.max()</code> 和 <code>Math.min()</code>, 在 python 中分别以 <code>float('inf')</code> 和 <code>float('-inf')</code>表示</p>\n<p>在 python2 中我们也可以这么做：</p>\n<figure class=\"highlight haskell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#maxint</span></span><br><span class=\"line\"><span class=\"type\">Max</span> = sys.maxint</span><br></pre></td></tr></table></figure>\n<h3 id=\"除法\">除法</h3>\n<p>在 python3 中， <code>/</code> 会保留浮点，相当于 float 相除，如果需要做到像 pyhton2 中的 int 相除，需要 <code>//</code>：</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"number\">3</span> / <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">1.5</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"number\">3</span> // <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"次方\">次方</h3>\n<p>在 python 中为 <code>**</code>:</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; <span class=\"number\">2</span> ** <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">1024</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"conditions\">conditions</h2>\n<p>在 python 的三项表达式(ternary operation) 与其它语言不太一样：</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">res = <span class=\"selector-tag\">a</span> <span class=\"keyword\">if</span> condition <span class=\"keyword\">else</span> b</span><br></pre></td></tr></table></figure>\n<p>它表示如果 condition 满足，那么 <code>res = a</code>, 不然 <code>res = b</code>，在类 c 的语言里即为：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">res</span> = condition ? a : b<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"any-all\">any, all</h2>\n<p><code>any(), all()</code>很好理解，就是字面意思，即参数中任何一个为 true 或者全部为 true 则返回 true。经常可以秀一些骚操作:<br>\n比如 <a href=\"https://leetcode.com/problems/valid-sudoku/\" target=\"_blank\" rel=\"noopener\">36. Valid Sudoku</a> 这题：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isValidSudoku</span><span class=\"params\">(<span class=\"keyword\">self</span>, <span class=\"symbol\">board:</span> List[List[str]])</span></span> -&gt; <span class=\"symbol\">bool:</span></span><br><span class=\"line\">        row = [[x <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> y <span class=\"keyword\">if</span> x != <span class=\"string\">'.'</span>] <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> board]</span><br><span class=\"line\">        col = [[x <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> y <span class=\"keyword\">if</span> x != <span class=\"string\">'.'</span>] <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> zip(*board)]</span><br><span class=\"line\">        pal = [[board[i+m][j+n] <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> range(<span class=\"number\">3</span>) <span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> range(<span class=\"number\">3</span>) <span class=\"keyword\">if</span> board[i+m][j+n] != <span class=\"string\">'.'</span>] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> (<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">6</span>) <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> (<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">6</span>)]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> all(len(set(x)) == len(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> (*row, *col, *pal))</span><br></pre></td></tr></table></figure>\n<h2 id=\"itertools\">itertools</h2>\n<p>这是 python 自带的迭代器库，有很多实用的、与遍历、迭代相关的函数。</p>\n<h3 id=\"permutations-排列\">permutations 排列</h3>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">permutations(<span class=\"string\">'ABCD'</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"comment\"># AB AC AD BA BC BD CA CB CD DA DB DC</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"combinations-组合\">combinations 组合</h3>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">combinations(<span class=\"string\">'ABCD'</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"comment\"># AB AC AD BC BD CD</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"groupby-合并\">groupby 合并</h3>\n<p><a href=\"https://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898</a></p>\n<figure class=\"highlight ocaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[k <span class=\"keyword\">for</span> k, g <span class=\"keyword\">in</span> groupby(<span class=\"symbol\">'AAAABBBCCDAABBB'</span>)] --&gt; <span class=\"type\">A</span> <span class=\"type\">B</span> <span class=\"type\">C</span> <span class=\"type\">D</span> <span class=\"type\">A</span> <span class=\"type\">B</span></span><br><span class=\"line\">[<span class=\"built_in\">list</span>(g) <span class=\"keyword\">for</span> k, g <span class=\"keyword\">in</span> groupby(<span class=\"symbol\">'AAAABBBCCD'</span>)] --&gt; <span class=\"type\">AAAA</span> <span class=\"type\">BBB</span> <span class=\"type\">CC</span> <span class=\"type\">D</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"functools\">functools</h2>\n<p>这个库里有很多高阶函数，包括前面介绍到的<code>cmp_to_key</code> 以及 <code>reduce</code>，但是比较逆天的有 <code>lru_cache</code>，即 least recently used cache. 这个 <a href=\"https://leetcode.com/problems/lru-cache/\" target=\"_blank\" rel=\"noopener\">LRU Cache</a>是一个常见的面试题，通常用 hashmap 和双向链表来实现，python 居然直接内置了。</p>\n<p>用法即直接作为 decorator 装饰在要 cache 的函数上，以变量值为 key 存储，当反复调用时直接返回计算过的值，例子如下：</p>\n<h3 id=\"lru_cache\">lru_cache</h3>\n<p><a href=\"https://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution</a></p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">stoneGameII</span><span class=\"params\">(self, A: List[int])</span> -&gt; int:</span></span><br><span class=\"line\">      N = len(A)</span><br><span class=\"line\">      <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(N - <span class=\"number\">2</span>, <span class=\"number\">-1</span>, <span class=\"number\">-1</span>):</span><br><span class=\"line\">          A[i] += A[i + <span class=\"number\">1</span>]</span><br><span class=\"line\">      <span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> lru_cache</span><br><span class=\"line\"><span class=\"meta\">      @lru_cache(None)</span></span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dp</span><span class=\"params\">(i, m)</span>:</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> i + <span class=\"number\">2</span> * m &gt;= N: <span class=\"keyword\">return</span> A[i]</span><br><span class=\"line\">          <span class=\"keyword\">return</span> A[i] - min(dp(i + x, max(m, x)) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, <span class=\"number\">2</span> * m + <span class=\"number\">1</span>))</span><br><span class=\"line\">      <span class=\"keyword\">return</span> dp(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"resource\">resource</h2>\n<p>这是一个大神用各种 Python trick 解题的 repo，可供娱乐：</p>\n<p><a href=\"https://github.com/cy69855522/Shortest-LeetCode-Python-Solutions\" target=\"_blank\" rel=\"noopener\">https://github.com/cy69855522/Shortest-LeetCode-Python-Solutions</a></p>\n<p>当然 Leetcode 讨论区还会经常见到 <code>StefanPochmann</code> 或者 <code>lee215</code>这样的大神 Po 一些很秀技的 python 代码，都是学习范本。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Python 越来越多地成为大家刷题的主流语言，主要原因是它的语法非常简洁明了。因此我们能节省更多的时间，来关注算法和数据结构本身。</p>\n<p>而用好 Python 自身独有的一些语法特性，不仅能更节省时间，也能让代码看起来更加优雅。这里我总结了一些我自己刷题过程中用到的一些常用的功能。以下以 python3 为例， python2 略有差异。</p>\n<h2>List</h2>\n<p>Python 的列表 List 基本就是其它语言的 Array.</p>\n<h3>Initialization 初始化</h3>\n<p>List 的初始化一般用 List comprehension，往往能一行解决问题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1d array</span></span><br><span class=\"line\">l = [<span class=\"number\">0</span> <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> range(len(array)]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2d</span></span><br><span class=\"line\">l = [[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(cols) <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> range(rows)]</span><br></pre></td></tr></table></figure>\n<h3>Start from the behind</h3>\n<p>你可以轻松从后往前访问：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">lastElement = l[<span class=\"number\">-1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">lastTwo = l[<span class=\"number\">-2</span>:]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(<span class=\"number\">0</span>, <span class=\"number\">-10</span>, <span class=\"number\">-1</span>)</span><br><span class=\"line\"><span class=\"comment\"># 0, -1, -2, -3, -4, -5, -6, -7, -8, -9</span></span><br></pre></td></tr></table></figure>\n<h3>copy 复制</h3>\n<h4>shallow copy 浅拷贝</h4>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">l2</span> = l1[:]</span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\"><span class=\"attr\">l2</span> = l1.copy()</span><br></pre></td></tr></table></figure>\n<p>浅复制的问题在于，如果 l1 内部还有 list，那么这种嵌套的索引不能被复制，比如：</p>\n<figure class=\"highlight inform7\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"comment\">[1, 2, <span class=\"comment\">[3, 4]</span>]</span></span><br><span class=\"line\">b = a<span class=\"comment\">[:]</span></span><br><span class=\"line\">a<span class=\"comment\">[2]</span>.append(5)</span><br><span class=\"line\">print(b)</span><br><span class=\"line\"># <span class=\"comment\">[1, 2, <span class=\"comment\">[3, 4, 5]</span>]</span></span><br></pre></td></tr></table></figure>\n<h4>deep copy 深拷贝</h4>\n<p>所以如果要做深拷贝，要节制自带库 <code>copy</code></p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import <span class=\"keyword\">copy</span><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\"></span></span><br><span class=\"line\"><span class=\"bash\">copy.deepcopy()</span></span><br></pre></td></tr></table></figure>\n<h3>enumerate 枚举</h3>\n<p>当我们需要枚举一个数组并同时获得值与 index 的时候可以使用：</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i, v <span class=\"keyword\">in</span> enumerate(l):</span><br><span class=\"line\">    <span class=\"builtin-name\">print</span>(i, v)</span><br><span class=\"line\"><span class=\"comment\"># 0 a</span></span><br><span class=\"line\"><span class=\"comment\"># 1 b</span></span><br><span class=\"line\"><span class=\"comment\"># 2 c</span></span><br></pre></td></tr></table></figure>\n<h3>zip</h3>\n<p><code>zip</code> 本意就是拉链，可以想象成将两个数组像拉链一样挨个聚合：</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; x = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">&gt;&gt;&gt; y = [<span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>]</span><br><span class=\"line\">&gt;&gt;&gt; zipped = zip(x, y)</span><br><span class=\"line\">&gt;&gt;&gt; <span class=\"type\">list</span>(zipped)</span><br><span class=\"line\">[(<span class=\"number\">1</span>, <span class=\"number\">4</span>), (<span class=\"number\">2</span>, <span class=\"number\">5</span>), (<span class=\"number\">3</span>, <span class=\"number\">6</span>)]</span><br></pre></td></tr></table></figure>\n<h3>reduce</h3>\n<p><code>reduce</code> 可以分别对相邻元素使用同一种计算规则，同时每一步结果作为下一步的参数，很典型的函数式编程用法。</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># importing functools for reduce()</span></span><br><span class=\"line\">import functools</span><br><span class=\"line\"><span class=\"comment\"># initializing list</span></span><br><span class=\"line\">lis = [ 1, 3, 5, 6, 2, ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># using reduce to compute sum of list</span></span><br><span class=\"line\"><span class=\"builtin-name\">print</span> (<span class=\"string\">\"The sum of the list elements is : \"</span>,<span class=\"attribute\">end</span>=<span class=\"string\">\"\"</span>)</span><br><span class=\"line\"><span class=\"builtin-name\">print</span> (functools.reduce(lambda a,b : a+b,lis))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The sum of the list elements is : 17</span></span><br></pre></td></tr></table></figure>\n<h3>map</h3>\n<p>可以将参数一一映射来计算， 比如</p>\n<figure class=\"highlight axapta\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">date</span> = <span class=\"string\">\"2019-8-15\"</span></span><br><span class=\"line\">Y, M, D = map(<span class=\"keyword\">int</span>, <span class=\"keyword\">date</span>.split(<span class=\"string\">'-'</span>))</span><br><span class=\"line\"><span class=\"meta\"># Y = 2019, M = 8, D = 15</span></span><br></pre></td></tr></table></figure>\n<h2>deque</h2>\n<p>list 删除末尾的操作是<code>O(1)</code>的，但是删除头操作就是<code>O(n)</code>，这时候我们就需要一个双端队列 <code>deque</code>。首尾的常规操作为：</p>\n<ul>\n<li><code>append</code>，添加到末尾</li>\n<li><code>appendleft</code>, 添加到开头</li>\n<li><code>pop</code>, 剔除末尾</li>\n<li><code>popleft</code>，移除开头</li>\n</ul>\n<h2>sorted</h2>\n<p>list 自身有自带的 sort(), 但是它不返回新的 list. <code>sorted</code> 能返回一个新的 list, 并且支持传入参数<code>reverse</code>。</p>\n<p>比如我们有一个 tuple 的数组，我们想按照 tuple 的第一个元素进行排序：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l1 = [(<span class=\"number\">1</span>,<span class=\"number\">2</span>), (<span class=\"number\">0</span>,<span class=\"number\">1</span>), (<span class=\"number\">3</span>,<span class=\"number\">10</span>) ]</span><br><span class=\"line\"></span><br><span class=\"line\">l2 = sorted(l1, key=<span class=\"keyword\">lambda</span> x: x[<span class=\"number\">0</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># l2 = [(0, 1), (1, 2), (3, 10)]</span></span><br></pre></td></tr></table></figure>\n<p>这里的 key 允许传入一个自定义参数，也可以用自带函数进行比较，比如在一个 string 数组里只想比较小写，可以传入<code>key=str.lower</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">l1 = [<span class=\"string\">\"banana\"</span>,<span class=\"string\">\"APPLE\"</span>, <span class=\"string\">\"Watermelon\"</span>]</span><br><span class=\"line\">l2 = sorted(l1, key=str.lower)</span><br><span class=\"line\">print(l2)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ['APPLE', 'banana', 'Watermelon']</span></span><br></pre></td></tr></table></figure>\n<h3>lambda</h3>\n<p>你注意到我们在上面使用了 <code>lambda</code> 来定义一个匿名函数，十分方便。如果你熟悉其它语言类似 JS 的话，可以把它理解成一个 callback 函数，参数名一一对应就行。</p>\n<h3>cmp_to_key</h3>\n<p>在 python3 中，sorted 函数取消了自带的<code>cmp</code>函数，需要借助<code>functools</code> 库中的 <code>cmp_to_key</code>来做比较。<br>\n比如如果要按照数组元素的绝对值来排序：</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">from</span> functools import cmp_to_key</span><br><span class=\"line\">def absSort(arr):</span><br><span class=\"line\">    newarr = sorted(arr, key = cmp_to_key(sortfunc))</span><br><span class=\"line\">    <span class=\"literal\">return</span> newarr</span><br><span class=\"line\">def sortfunc(<span class=\"keyword\">a</span>, b):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">abs</span>(<span class=\"keyword\">a</span>) &lt; <span class=\"built_in\">abs</span>(b):</span><br><span class=\"line\">      <span class=\"literal\">return</span> <span class=\"number\">-1</span></span><br><span class=\"line\">    elif <span class=\"built_in\">abs</span>(<span class=\"keyword\">a</span>) &gt; <span class=\"built_in\">abs</span>(b):</span><br><span class=\"line\">      <span class=\"literal\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">      <span class=\"literal\">return</span> <span class=\"keyword\">a</span> - b</span><br></pre></td></tr></table></figure>\n<h2>set</h2>\n<p>set 的查找操作复杂度为<code>O(1)</code>，有时候可以替代<code>dict</code> 来存储中间过程。</p>\n<ul>\n<li>\n<p><code>add</code> : set 的添加是 <code>add</code> 不是<code>append</code></p>\n</li>\n<li>\n<p><code>remove</code> vs <code>discard</code>: 都是删除操作，区别在于<code>remove</code>不存在的元素会报错，<code>discard</code>不会。</p>\n</li>\n<li>\n<p><code>union</code>, <code>intersection</code>: 快速获得并集和交集，方便一些去重操作。</p>\n</li>\n</ul>\n<h2>dict</h2>\n<p>字典，相当于其它语言中的<code>map</code>, <code>hashtable</code>, <code>hashmap</code>之类的，读取操作也是<code>O(1)</code> 复杂度</p>\n<h3>keys(), values(), items()</h3>\n<p>这三个方法可以分别获得<code>key</code>, <code>value</code>, <code>{key: value}</code>的数组。</p>\n<h3>setdefault</h3>\n<p>这个函数经常在初始化字典时候使用，如果某个<code>key</code>在字典中存在，返回它的<code>value</code>, 否则返回你给的 default 值。比如在建一个 trie 树的时候</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node = self.root</span><br><span class=\"line\"><span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> word:</span><br><span class=\"line\">    node = node.setdefault(char, &#123;&#125;)</span><br></pre></td></tr></table></figure>\n<h3>OrderedDict</h3>\n<p>OrderedDict 能记录你 key 和 value 插入的顺序，底层其实是一个双向链表加哈希表的实现。我们甚至可以使用<code>move_to_end</code>这样的函数：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d = OrderedDict.fromkeys(<span class=\"string\">'abcde'</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.move_to_end(<span class=\"string\">'b'</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">''</span>.join(d.keys())</span><br><span class=\"line\"><span class=\"string\">'acdeb'</span></span><br><span class=\"line\"><span class=\"comment\"># 放开头</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>d.move_to_end(<span class=\"string\">'b'</span>, last=<span class=\"literal\">False</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">''</span>.join(d.keys())</span><br><span class=\"line\"><span class=\"string\">'bacde'</span></span><br></pre></td></tr></table></figure>\n<h3>defaultdict</h3>\n<p><code>defaultdict</code>可以很好地来解决一些初始化的问题，比如 value 是一个 list，每次需要判断 key 是否存在的情况。这时我们可以直接定义</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d = defaultdict(list)</span><br><span class=\"line\"></span><br><span class=\"line\">s = [(<span class=\"string\">'yellow'</span>, <span class=\"number\">1</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'yellow'</span>, <span class=\"number\">3</span>), (<span class=\"string\">'blue'</span>, <span class=\"number\">4</span>), (<span class=\"string\">'red'</span>, <span class=\"number\">1</span>)]</span><br><span class=\"line\"><span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> s:</span><br><span class=\"line\">     d[k].append(v)</span><br><span class=\"line\">sorted(d.items())</span><br><span class=\"line\"><span class=\"comment\"># [('blue', [2, 4]), ('red', [1]), ('yellow', [1, 3])]</span></span><br></pre></td></tr></table></figure>\n<h2>heapq</h2>\n<p>heapq 就是 python 的 priority queue，<code>heapq[0]</code>即为堆顶元素。</p>\n<p>heapq 的实现是小顶堆，如果需要一个大顶堆，常规的一个做法是把值取负存入，取出时再反转。<br>\n以下是借助 heapq 来实现 heapsort 的例子：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">heapsort</span><span class=\"params\">(iterable)</span>:</span></span><br><span class=\"line\"><span class=\"meta\">... </span>    h = []</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">for</span> value <span class=\"keyword\">in</span> iterable:</span><br><span class=\"line\"><span class=\"meta\">... </span>        heappush(h, value)</span><br><span class=\"line\"><span class=\"meta\">... </span>    <span class=\"keyword\">return</span> [heappop(h) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(len(h))]</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>heapsort([<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">5</span>, <span class=\"number\">7</span>, <span class=\"number\">9</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">6</span>, <span class=\"number\">8</span>, <span class=\"number\">0</span>])</span><br><span class=\"line\">[<span class=\"number\">0</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>]</span><br></pre></td></tr></table></figure>\n<h2>bisect</h2>\n<p>python 自带二分查找的库，在一些不要求实现 binary search，但是借助它能加速的场景下可以直接使用。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bisect.bisect(a, x, lo=<span class=\"number\">0</span>, hi=len(a))</span><br><span class=\"line\">这里的参数分别为 数组，要查找的数，范围起始点，范围结束点</span><br></pre></td></tr></table></figure>\n<p>相似函数还有</p>\n<ul>\n<li><code>bisect.bisect_left</code></li>\n<li><code>bisect.bisect_right</code><br>\n分别返回可以插入 x 的最左和最右 index</li>\n</ul>\n<h2>Counter</h2>\n<p>Counter 接受的参数可以是一个 string, 或者一个 list, mapping</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter()                           <span class=\"comment\"># a new, empty counter</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter(<span class=\"string\">'gallahad'</span>)                 <span class=\"comment\"># a new counter from an iterable</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter(&#123;<span class=\"string\">'red'</span>: <span class=\"number\">4</span>, <span class=\"string\">'blue'</span>: <span class=\"number\">2</span>&#125;)      <span class=\"comment\"># a new counter from a mapping</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; c = Counter(cats=<span class=\"number\">4</span>, dogs=<span class=\"number\">8</span>)             <span class=\"comment\"># a new counter from keyword args</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>most_common(n)</code><br>\n可以得到出现次数最多的 n 个数：</li>\n</ul>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; Counter(<span class=\"string\">'abracadabra'</span>).most_common(<span class=\"number\">3</span>)  <span class=\"comment\"># doctest: +SKIP</span></span><br><span class=\"line\">[(<span class=\"string\">'a'</span>, <span class=\"number\">5</span>), (<span class=\"string\">'r'</span>, <span class=\"number\">2</span>), (<span class=\"string\">'b'</span>, <span class=\"number\">2</span>)]</span><br></pre></td></tr></table></figure>\n<h2>strings</h2>\n<h3>ord, char</h3>\n<p>ord 返回单个字符的 unicode:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; ord(<span class=\"string\">'a'</span>)</span><br><span class=\"line\"><span class=\"number\">97</span></span><br></pre></td></tr></table></figure>\n<p>char 则是反向操作：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; chr(<span class=\"number\">100</span>)</span><br><span class=\"line\"><span class=\"string\">'d'</span></span><br></pre></td></tr></table></figure>\n<h3>strip</h3>\n<p>移除 string 前后的字符串，默认来移除空格，但是也可以给一个字符串，然后会移除含有这个字符串的部分：</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">'   spacious   '</span>.strip()</span><br><span class=\"line\"><span class=\"string\">'spacious'</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"string\">'www.example.com'</span>.strip(<span class=\"string\">'cmowz.'</span>)</span><br><span class=\"line\"><span class=\"string\">'example'</span></span><br></pre></td></tr></table></figure>\n<h3>split</h3>\n<p>按照某个字符串来切分，返回一个 list, 可以传入一个参数<code>maxsplit</code>来限定分离数。</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; <span class=\"string\">'1,2,3'</span>.split(<span class=\"string\">','</span>)</span><br><span class=\"line\">[<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; <span class=\"string\">'1,2,3'</span>.split(<span class=\"string\">','</span>, maxsplit=<span class=\"number\">1</span>)</span><br><span class=\"line\">[<span class=\"string\">'1'</span>, <span class=\"string\">'2,3'</span>]</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;</span>&gt; <span class=\"string\">'1,2,,3,'</span>.split(<span class=\"string\">','</span>)</span><br><span class=\"line\">[<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">''</span>, <span class=\"string\">'3'</span>, <span class=\"string\">''</span>]</span><br></pre></td></tr></table></figure>\n<h2>int/ float</h2>\n<h3>最大, 最小 number</h3>\n<p>有时候初始化我们需要设定 <code>Math.max()</code> 和 <code>Math.min()</code>, 在 python 中分别以 <code>float('inf')</code> 和 <code>float('-inf')</code>表示</p>\n<p>在 python2 中我们也可以这么做：</p>\n<figure class=\"highlight haskell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#maxint</span></span><br><span class=\"line\"><span class=\"type\">Max</span> = sys.maxint</span><br></pre></td></tr></table></figure>\n<h3>除法</h3>\n<p>在 python3 中， <code>/</code> 会保留浮点，相当于 float 相除，如果需要做到像 pyhton2 中的 int 相除，需要 <code>//</code>：</p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"number\">3</span> / <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">1.5</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"number\">3</span> // <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h3>次方</h3>\n<p>在 python 中为 <code>**</code>:</p>\n<figure class=\"highlight lsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt;&gt; <span class=\"number\">2</span> ** <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">1024</span></span><br></pre></td></tr></table></figure>\n<h2>conditions</h2>\n<p>在 python 的三项表达式(ternary operation) 与其它语言不太一样：</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">res = <span class=\"selector-tag\">a</span> <span class=\"keyword\">if</span> condition <span class=\"keyword\">else</span> b</span><br></pre></td></tr></table></figure>\n<p>它表示如果 condition 满足，那么 <code>res = a</code>, 不然 <code>res = b</code>，在类 c 的语言里即为：</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">res</span> = condition ? a : b<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<h2>any, all</h2>\n<p><code>any(), all()</code>很好理解，就是字面意思，即参数中任何一个为 true 或者全部为 true 则返回 true。经常可以秀一些骚操作:<br>\n比如 <a href=\"https://leetcode.com/problems/valid-sudoku/\" target=\"_blank\" rel=\"noopener\">36. Valid Sudoku</a> 这题：</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Solution</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">isValidSudoku</span><span class=\"params\">(<span class=\"keyword\">self</span>, <span class=\"symbol\">board:</span> List[List[str]])</span></span> -&gt; <span class=\"symbol\">bool:</span></span><br><span class=\"line\">        row = [[x <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> y <span class=\"keyword\">if</span> x != <span class=\"string\">'.'</span>] <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> board]</span><br><span class=\"line\">        col = [[x <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> y <span class=\"keyword\">if</span> x != <span class=\"string\">'.'</span>] <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> zip(*board)]</span><br><span class=\"line\">        pal = [[board[i+m][j+n] <span class=\"keyword\">for</span> m <span class=\"keyword\">in</span> range(<span class=\"number\">3</span>) <span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> range(<span class=\"number\">3</span>) <span class=\"keyword\">if</span> board[i+m][j+n] != <span class=\"string\">'.'</span>] <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> (<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">6</span>) <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> (<span class=\"number\">0</span>, <span class=\"number\">3</span>, <span class=\"number\">6</span>)]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> all(len(set(x)) == len(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> (*row, *col, *pal))</span><br></pre></td></tr></table></figure>\n<h2>itertools</h2>\n<p>这是 python 自带的迭代器库，有很多实用的、与遍历、迭代相关的函数。</p>\n<h3>permutations 排列</h3>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">permutations(<span class=\"string\">'ABCD'</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"comment\"># AB AC AD BA BC BD CA CB CD DA DB DC</span></span><br></pre></td></tr></table></figure>\n<h3>combinations 组合</h3>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">combinations(<span class=\"string\">'ABCD'</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\"><span class=\"comment\"># AB AC AD BC BD CD</span></span><br></pre></td></tr></table></figure>\n<h3>groupby 合并</h3>\n<p><a href=\"https://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898</a></p>\n<figure class=\"highlight ocaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[k <span class=\"keyword\">for</span> k, g <span class=\"keyword\">in</span> groupby(<span class=\"symbol\">'AAAABBBCCDAABBB'</span>)] --&gt; <span class=\"type\">A</span> <span class=\"type\">B</span> <span class=\"type\">C</span> <span class=\"type\">D</span> <span class=\"type\">A</span> <span class=\"type\">B</span></span><br><span class=\"line\">[<span class=\"built_in\">list</span>(g) <span class=\"keyword\">for</span> k, g <span class=\"keyword\">in</span> groupby(<span class=\"symbol\">'AAAABBBCCD'</span>)] --&gt; <span class=\"type\">AAAA</span> <span class=\"type\">BBB</span> <span class=\"type\">CC</span> <span class=\"type\">D</span></span><br></pre></td></tr></table></figure>\n<h2>functools</h2>\n<p>这个库里有很多高阶函数，包括前面介绍到的<code>cmp_to_key</code> 以及 <code>reduce</code>，但是比较逆天的有 <code>lru_cache</code>，即 least recently used cache. 这个 <a href=\"https://leetcode.com/problems/lru-cache/\" target=\"_blank\" rel=\"noopener\">LRU Cache</a>是一个常见的面试题，通常用 hashmap 和双向链表来实现，python 居然直接内置了。</p>\n<p>用法即直接作为 decorator 装饰在要 cache 的函数上，以变量值为 key 存储，当反复调用时直接返回计算过的值，例子如下：</p>\n<h3>lru_cache</h3>\n<p><a href=\"https://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution</a></p>\n<figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">stoneGameII</span><span class=\"params\">(self, A: List[int])</span> -&gt; int:</span></span><br><span class=\"line\">      N = len(A)</span><br><span class=\"line\">      <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> range(N - <span class=\"number\">2</span>, <span class=\"number\">-1</span>, <span class=\"number\">-1</span>):</span><br><span class=\"line\">          A[i] += A[i + <span class=\"number\">1</span>]</span><br><span class=\"line\">      <span class=\"keyword\">from</span> functools <span class=\"keyword\">import</span> lru_cache</span><br><span class=\"line\"><span class=\"meta\">      @lru_cache(None)</span></span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dp</span><span class=\"params\">(i, m)</span>:</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> i + <span class=\"number\">2</span> * m &gt;= N: <span class=\"keyword\">return</span> A[i]</span><br><span class=\"line\">          <span class=\"keyword\">return</span> A[i] - min(dp(i + x, max(m, x)) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> range(<span class=\"number\">1</span>, <span class=\"number\">2</span> * m + <span class=\"number\">1</span>))</span><br><span class=\"line\">      <span class=\"keyword\">return</span> dp(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n<h2>resource</h2>\n<p>这是一个大神用各种 Python trick 解题的 repo，可供娱乐：</p>\n<p><a href=\"https://github.com/cy69855522/Shortest-LeetCode-Python-Solutions\" target=\"_blank\" rel=\"noopener\">https://github.com/cy69855522/Shortest-LeetCode-Python-Solutions</a></p>\n<p>当然 Leetcode 讨论区还会经常见到 <code>StefanPochmann</code> 或者 <code>lee215</code>这样的大神 Po 一些很秀技的 python 代码，都是学习范本。</p>\n"},{"title":"React global state management","catalog":true,"date":"2018-03-09T04:51:10.000Z","subtitle":null,"header-img":"sunset.JPG","_content":"\nRedux and Mobx are two most popular state management tools for React apps, representing different design philosophis as object-oriented programming and functional programming. Recently, a new context api has been proposed to provide a native global store solution and received a lot of discussions. Here's a brief comparion of different methods. I have to say before hand, most things in software engineering are based on opinions and tradeoffs, not facts or hard truth. \n\n\n## Redux\n\nBasic data flow:\n\n```mermaid\ngraph LR\nA[Action]-->|just payload|B(Reducer)\nD[prevState] --> B\nB -->|new state| C(Store)\nC -->|rerender| E(subscribed views)\n```\n\n\n### Action\n\nActions are just plain object that contains `type` and `payload` property, such as \n```\n{\n    type: ADD_TODO,\n    payload: text\n}\n```\nActions should be returned by action creaters.\n\n### Reducer\n\nReducers are just pure functions that take the previous `related` state and action, then return the new state\n\nReducers can be combined together by using a function `combineReducers` from `redux`\n\n### Store\n\nSingle source of truth. Store should be created at the root level,\n```js\nimport { createStore } from 'redux'\nimport { Provider } from 'react-redux'\nimport App from './components/App'\nimport reducer from './reducers'\n...\nconst store = createStore(reducer)\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n)\n```\n\n### APIs\n\n- [createStore](https://redux.js.org/api-reference/createstore)\n    - create the single store at root level \n- [Store](https://redux.js.org/api-reference/store)\n- [combineReducers](https://redux.js.org/api-reference/combinereducers)\n- [applyMiddleware](https://note.youdao.com/)\n    - useful for async ajax requests   \n- [bindActionCreators](https://note.youdao.com/)\n    - the only use case for this is when you want to pass some action creators down to a component that isn't aware of Redux\n- [compose](https://note.youdao.com/)\n    - composes functions from right to left\n### react-redux\n\n#### <Provider store>\nMakes the Redux store available to the connect() calls in the component hierarchy below. \n\n#### connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])\nConnects a React component to a Redux store. \n\n`\nconnect(\n  mapStateToProps,\n  mapDispatchToProps\n)(component)`\n\nIf no parameters are provided, it injects just dispatch and doesn't listen to store\n\n**params:**\n- mapStateToProps(state, [ownProps]): stateProps\n\n- mapDispatchToProps(dispatch, [ownProps]): dispatchProps\n\n### related libraries\n\n- [redux-thunk](https://github.com/gaearon/redux-thunk)\n    - Redux Thunk middleware allows you to write action creators that return a function instead of an action.  \n    - The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. Thus it's very useful for async actions and promises.\n\n- [redux-saga](https://github.com/redux-saga/redux-saga)\n    - a library that aims to make application side effects (i.e. asynchronous things like data fetching and impure things like accessing the browser cache) easier to manage, more efficient to execute, simple to test, and better at handling failures.\n\n### Feature\n- reacting to actions or events\n- single store\n- functional programming paradigm\n- immutable\n- pure\n- explicit update logic\n- plain JavaScript\n- more boilerplate\n- normalized state\n- flat state\n- examples:\n    - business apps\n    - event based systems\n    - game events involving a complex reaction\n\n### redux todolist example:\n[![Edit todos](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/1zo57njq9q)\n\n### Summary\n\nRedux is an opinionated library that reinforces immutable data and functional programming pattern. It provides more granular control of data flow and shines in testability, scaleability, maintainability. It will be suitable for a large team and complex apps because it has mature best practices and community support.\n\n\n## MobX\nData flow:\n![dataflow](https://mobx.js.org/docs/flow.png)\n\n### observable\nObservable values can be JS primitives, references, plain objects, class instances, arrays and maps.\n\nUsage:\n- observable(value)\n- @observable classProperty = value\n\n### computed && autorun\n\nThey are both reactively invoked expressions, but use @computed if you want to reactively produce a value that can be used by other observers and autorun if you don't want to produce a new value but rather want to achieve an effect. For example imperative side effects like logging, making network requests etc.\n\nexample:\n```\nimport {observable, computed} from \"mobx\";\n\nclass OrderLine {\n    @observable price = 0;\n    @observable amount = 1;\n\n    constructor(price) {\n        this.price = price;\n    }\n\n    @computed get total() {\n        return this.price * this.amount;\n    }\n}\n```\n\n### (@)observer\n\nThe react components that are wrapped by observer will react to the change of observables.\n\n### action\n\nIt has similar concepts as action in redux. Simply call `mobx.useStrict(true)` when your application is initialized, and MobX will throw anytime you (accidentally) try to modify state without using an action.\n\n### Feature\n\n- Reacting to state changes\n- multiple stores\n- object-oriented programming and reactive programming paradigms\n- mutable\n- impure\n- implicit update logic\n- “magic” JavaScript\n- less boilerplate\n- denormalized state\n- nested state\n- Examples\n    - Real-time systems, dashboards, etc\n    - Text editors, presentation software, etc.\n    - Not for event based\n\n### mobx todo example:\n[![Edit Simple MobX TodoList](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/vnw0yzx555)\n\n### Summary\nMobx is more suitable for simpler application, rapid prototyping and a small team. It has short learning curve for those that are already familiar with object-oriented programming. It can also be used in large projects if explicit constraints are added, such as useStrict.\n\n\n## new context api\nThe new context api tries to provide a native global store for React apps and solves the problems that old context api has: [shouldComponentUpdate blocks context changes](https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shouldcomponentupdate-blocks-context-changes) and [Shifts complexity to user space](https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shifts-complexity-to-user-space)\n\nContext in React provides a mechanism for a child component to access a value in an ancestor component.\n\n### React.createContext()\nIt is passed the initial value (and optionally a [fancy opt-out function that uses a bitmask](https://twitter.com/acdlite/status/957446433656864768)). This returns an object with a \"provider\" and a \"consumer\"\n### Provider\n\nThe provider acts as an event emitter. It keeps track of the most recent context value, and a list of subscribers to be notified whenever it changes.\n\n### Consumer\n\nThe consumer accesses the provider's event emitter using the context API. (This usage is fine because the event emitter itself does not change). When the provider emits a change event, the consumer is notified and calls setState on itself to schedule a re-render.\n\nExample:\n```\nconst ThemeContext = React.createContext('light')\nclass ThemeProvider extends React.Component {\n  state = {theme: 'light'}\n  render() {\n    return ThemeContext.provide(this.state.theme, this.props.children)\n  }\n}\n\nconst ThemeConsumer = ({children}) => ThemeContext.consume(children)\n\nclass App extends React.Component {\n  render() {\n    <ThemeProvider>\n      <ThemeConsumer>{val => <div>{val}</div>}</ThemeConsumer>\n    </ThemeProvider>\n  }\n}\n```\n\n[![Edit Example of React's new context API](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/k71q68nzr)\n\n### Summary\n\nNew context api provides a native way to manage global store in react apps and is perfect for dependency injection (theme, intl, buildConfig), but it lacks the power to control the data flow. Redux or Mobx may still be needed to handle complex async data process.\n\n\n## Resource\n\n[Redux Doc](https://redux.js.org/)\n\n[Mobx Doc](https://mobx.js.org/index.html)\n\n[Preethi Kasireddy - MobX vs Redux: Comparing the Opposing Paradigms](https://www.youtube.com/watch?v=76FRrbY18Bs)\n\n[Redux or MobX: An attempt to dissolve the Confusion](https://www.robinwieruch.de/redux-mobx-confusion/)\n\n[Replacing redux with the new React context API](https://medium.com/@DidierFranc/replacing-redux-with-the-new-react-context-api-8f5d01a00e8c)\n\n[new version of context](https://github.com/acdlite/rfcs/blob/new-version-of-context/text/0000-new-version-of-context.md)","source":"_posts/react-global-state-management.md","raw":"---\ntitle: React global state management\ncatalog: true\ndate: 2018-03-08 23:51:10\nsubtitle:\nheader-img: \"sunset.JPG\"\ntags:\n- React\n- Redux\n- Mobx\n---\n\nRedux and Mobx are two most popular state management tools for React apps, representing different design philosophis as object-oriented programming and functional programming. Recently, a new context api has been proposed to provide a native global store solution and received a lot of discussions. Here's a brief comparion of different methods. I have to say before hand, most things in software engineering are based on opinions and tradeoffs, not facts or hard truth. \n\n\n## Redux\n\nBasic data flow:\n\n```mermaid\ngraph LR\nA[Action]-->|just payload|B(Reducer)\nD[prevState] --> B\nB -->|new state| C(Store)\nC -->|rerender| E(subscribed views)\n```\n\n\n### Action\n\nActions are just plain object that contains `type` and `payload` property, such as \n```\n{\n    type: ADD_TODO,\n    payload: text\n}\n```\nActions should be returned by action creaters.\n\n### Reducer\n\nReducers are just pure functions that take the previous `related` state and action, then return the new state\n\nReducers can be combined together by using a function `combineReducers` from `redux`\n\n### Store\n\nSingle source of truth. Store should be created at the root level,\n```js\nimport { createStore } from 'redux'\nimport { Provider } from 'react-redux'\nimport App from './components/App'\nimport reducer from './reducers'\n...\nconst store = createStore(reducer)\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n)\n```\n\n### APIs\n\n- [createStore](https://redux.js.org/api-reference/createstore)\n    - create the single store at root level \n- [Store](https://redux.js.org/api-reference/store)\n- [combineReducers](https://redux.js.org/api-reference/combinereducers)\n- [applyMiddleware](https://note.youdao.com/)\n    - useful for async ajax requests   \n- [bindActionCreators](https://note.youdao.com/)\n    - the only use case for this is when you want to pass some action creators down to a component that isn't aware of Redux\n- [compose](https://note.youdao.com/)\n    - composes functions from right to left\n### react-redux\n\n#### <Provider store>\nMakes the Redux store available to the connect() calls in the component hierarchy below. \n\n#### connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])\nConnects a React component to a Redux store. \n\n`\nconnect(\n  mapStateToProps,\n  mapDispatchToProps\n)(component)`\n\nIf no parameters are provided, it injects just dispatch and doesn't listen to store\n\n**params:**\n- mapStateToProps(state, [ownProps]): stateProps\n\n- mapDispatchToProps(dispatch, [ownProps]): dispatchProps\n\n### related libraries\n\n- [redux-thunk](https://github.com/gaearon/redux-thunk)\n    - Redux Thunk middleware allows you to write action creators that return a function instead of an action.  \n    - The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. Thus it's very useful for async actions and promises.\n\n- [redux-saga](https://github.com/redux-saga/redux-saga)\n    - a library that aims to make application side effects (i.e. asynchronous things like data fetching and impure things like accessing the browser cache) easier to manage, more efficient to execute, simple to test, and better at handling failures.\n\n### Feature\n- reacting to actions or events\n- single store\n- functional programming paradigm\n- immutable\n- pure\n- explicit update logic\n- plain JavaScript\n- more boilerplate\n- normalized state\n- flat state\n- examples:\n    - business apps\n    - event based systems\n    - game events involving a complex reaction\n\n### redux todolist example:\n[![Edit todos](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/1zo57njq9q)\n\n### Summary\n\nRedux is an opinionated library that reinforces immutable data and functional programming pattern. It provides more granular control of data flow and shines in testability, scaleability, maintainability. It will be suitable for a large team and complex apps because it has mature best practices and community support.\n\n\n## MobX\nData flow:\n![dataflow](https://mobx.js.org/docs/flow.png)\n\n### observable\nObservable values can be JS primitives, references, plain objects, class instances, arrays and maps.\n\nUsage:\n- observable(value)\n- @observable classProperty = value\n\n### computed && autorun\n\nThey are both reactively invoked expressions, but use @computed if you want to reactively produce a value that can be used by other observers and autorun if you don't want to produce a new value but rather want to achieve an effect. For example imperative side effects like logging, making network requests etc.\n\nexample:\n```\nimport {observable, computed} from \"mobx\";\n\nclass OrderLine {\n    @observable price = 0;\n    @observable amount = 1;\n\n    constructor(price) {\n        this.price = price;\n    }\n\n    @computed get total() {\n        return this.price * this.amount;\n    }\n}\n```\n\n### (@)observer\n\nThe react components that are wrapped by observer will react to the change of observables.\n\n### action\n\nIt has similar concepts as action in redux. Simply call `mobx.useStrict(true)` when your application is initialized, and MobX will throw anytime you (accidentally) try to modify state without using an action.\n\n### Feature\n\n- Reacting to state changes\n- multiple stores\n- object-oriented programming and reactive programming paradigms\n- mutable\n- impure\n- implicit update logic\n- “magic” JavaScript\n- less boilerplate\n- denormalized state\n- nested state\n- Examples\n    - Real-time systems, dashboards, etc\n    - Text editors, presentation software, etc.\n    - Not for event based\n\n### mobx todo example:\n[![Edit Simple MobX TodoList](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/vnw0yzx555)\n\n### Summary\nMobx is more suitable for simpler application, rapid prototyping and a small team. It has short learning curve for those that are already familiar with object-oriented programming. It can also be used in large projects if explicit constraints are added, such as useStrict.\n\n\n## new context api\nThe new context api tries to provide a native global store for React apps and solves the problems that old context api has: [shouldComponentUpdate blocks context changes](https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shouldcomponentupdate-blocks-context-changes) and [Shifts complexity to user space](https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shifts-complexity-to-user-space)\n\nContext in React provides a mechanism for a child component to access a value in an ancestor component.\n\n### React.createContext()\nIt is passed the initial value (and optionally a [fancy opt-out function that uses a bitmask](https://twitter.com/acdlite/status/957446433656864768)). This returns an object with a \"provider\" and a \"consumer\"\n### Provider\n\nThe provider acts as an event emitter. It keeps track of the most recent context value, and a list of subscribers to be notified whenever it changes.\n\n### Consumer\n\nThe consumer accesses the provider's event emitter using the context API. (This usage is fine because the event emitter itself does not change). When the provider emits a change event, the consumer is notified and calls setState on itself to schedule a re-render.\n\nExample:\n```\nconst ThemeContext = React.createContext('light')\nclass ThemeProvider extends React.Component {\n  state = {theme: 'light'}\n  render() {\n    return ThemeContext.provide(this.state.theme, this.props.children)\n  }\n}\n\nconst ThemeConsumer = ({children}) => ThemeContext.consume(children)\n\nclass App extends React.Component {\n  render() {\n    <ThemeProvider>\n      <ThemeConsumer>{val => <div>{val}</div>}</ThemeConsumer>\n    </ThemeProvider>\n  }\n}\n```\n\n[![Edit Example of React's new context API](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/k71q68nzr)\n\n### Summary\n\nNew context api provides a native way to manage global store in react apps and is perfect for dependency injection (theme, intl, buildConfig), but it lacks the power to control the data flow. Redux or Mobx may still be needed to handle complex async data process.\n\n\n## Resource\n\n[Redux Doc](https://redux.js.org/)\n\n[Mobx Doc](https://mobx.js.org/index.html)\n\n[Preethi Kasireddy - MobX vs Redux: Comparing the Opposing Paradigms](https://www.youtube.com/watch?v=76FRrbY18Bs)\n\n[Redux or MobX: An attempt to dissolve the Confusion](https://www.robinwieruch.de/redux-mobx-confusion/)\n\n[Replacing redux with the new React context API](https://medium.com/@DidierFranc/replacing-redux-with-the-new-react-context-api-8f5d01a00e8c)\n\n[new version of context](https://github.com/acdlite/rfcs/blob/new-version-of-context/text/0000-new-version-of-context.md)","slug":"react-global-state-management","published":1,"updated":"2019-04-04T01:46:35.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjzg5rxya001fx18lpm67eutv","content":"<p>Redux and Mobx are two most popular state management tools for React apps, representing different design philosophis as object-oriented programming and functional programming. Recently, a new context api has been proposed to provide a native global store solution and received a lot of discussions. Here’s a brief comparion of different methods. I have to say before hand, most things in software engineering are based on opinions and tradeoffs, not facts or hard truth.</p>\n<h2 id=\"redux\">Redux</h2>\n<p>Basic data flow:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph LR</span><br><span class=\"line\">A[Action]--&gt;|just payload|B(Reducer)</span><br><span class=\"line\">D[prevState] --&gt; B</span><br><span class=\"line\">B --&gt;|new state| C(Store)</span><br><span class=\"line\">C --&gt;|rerender| E(subscribed views)</span><br></pre></td></tr></table></figure>\n<h3 id=\"action\">Action</h3>\n<p>Actions are just plain object that contains <code>type</code> and <code>payload</code> property, such as</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attribute\">type</span>: ADD_TODO,</span><br><span class=\"line\">    payload: text</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Actions should be returned by action creaters.</p>\n<h3 id=\"reducer\">Reducer</h3>\n<p>Reducers are just pure functions that take the previous <code>related</code> state and action, then return the new state</p>\n<p>Reducers can be combined together by using a function <code>combineReducers</code> from <code>redux</code></p>\n<h3 id=\"store\">Store</h3>\n<p>Single source of truth. Store should be created at the root level,</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">'redux'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Provider &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-redux'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./components/App'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> reducer <span class=\"keyword\">from</span> <span class=\"string\">'./reducers'</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">const</span> store = createStore(reducer)</span><br><span class=\"line\"></span><br><span class=\"line\">render(</span><br><span class=\"line\">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class=\"line\">    &lt;App /&gt;</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/Provider&gt;,</span></span><br><span class=\"line\"><span class=\"regexp\">  document.getElementById('root')</span></span><br><span class=\"line\"><span class=\"regexp\">)</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"apis\">APIs</h3>\n<ul>\n<li><a href=\"https://redux.js.org/api-reference/createstore\" target=\"_blank\" rel=\"noopener\">createStore</a>\n<ul>\n<li>create the single store at root level</li>\n</ul>\n</li>\n<li><a href=\"https://redux.js.org/api-reference/store\" target=\"_blank\" rel=\"noopener\">Store</a></li>\n<li><a href=\"https://redux.js.org/api-reference/combinereducers\" target=\"_blank\" rel=\"noopener\">combineReducers</a></li>\n<li><a href=\"https://note.youdao.com/\" target=\"_blank\" rel=\"noopener\">applyMiddleware</a>\n<ul>\n<li>useful for async ajax requests</li>\n</ul>\n</li>\n<li><a href=\"https://note.youdao.com/\" target=\"_blank\" rel=\"noopener\">bindActionCreators</a>\n<ul>\n<li>the only use case for this is when you want to pass some action creators down to a component that isn’t aware of Redux</li>\n</ul>\n</li>\n<li><a href=\"https://note.youdao.com/\" target=\"_blank\" rel=\"noopener\">compose</a>\n<ul>\n<li>composes functions from right to left</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"react-redux\">react-redux</h3>\n<h4 id><provider store></provider></h4>\n<p>Makes the Redux store available to the connect() calls in the component hierarchy below.</p>\n<h4 id=\"connectmapstatetoprops-mapdispatchtoprops-mergeprops-options\">connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])</h4>\n<p>Connects a React component to a Redux store.</p>\n<p><code>connect( mapStateToProps, mapDispatchToProps )(component)</code></p>\n<p>If no parameters are provided, it injects just dispatch and doesn’t listen to store</p>\n<p><strong>params:</strong></p>\n<ul>\n<li>\n<p>mapStateToProps(state, [ownProps]): stateProps</p>\n</li>\n<li>\n<p>mapDispatchToProps(dispatch, [ownProps]): dispatchProps</p>\n</li>\n</ul>\n<h3 id=\"related-libraries\">related libraries</h3>\n<ul>\n<li>\n<p><a href=\"https://github.com/gaearon/redux-thunk\" target=\"_blank\" rel=\"noopener\">redux-thunk</a></p>\n<ul>\n<li>Redux Thunk middleware allows you to write action creators that return a function instead of an action.</li>\n<li>The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. Thus it’s very useful for async actions and promises.</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/redux-saga/redux-saga\" target=\"_blank\" rel=\"noopener\">redux-saga</a></p>\n<ul>\n<li>a library that aims to make application side effects (i.e. asynchronous things like data fetching and impure things like accessing the browser cache) easier to manage, more efficient to execute, simple to test, and better at handling failures.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"feature\">Feature</h3>\n<ul>\n<li>reacting to actions or events</li>\n<li>single store</li>\n<li>functional programming paradigm</li>\n<li>immutable</li>\n<li>pure</li>\n<li>explicit update logic</li>\n<li>plain JavaScript</li>\n<li>more boilerplate</li>\n<li>normalized state</li>\n<li>flat state</li>\n<li>examples:\n<ul>\n<li>business apps</li>\n<li>event based systems</li>\n<li>game events involving a complex reaction</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"redux-todolist-example\">redux todolist example:</h3>\n<p><a href=\"https://codesandbox.io/s/1zo57njq9q\" target=\"_blank\" rel=\"noopener\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit todos\"></a></p>\n<h3 id=\"summary\">Summary</h3>\n<p>Redux is an opinionated library that reinforces immutable data and functional programming pattern. It provides more granular control of data flow and shines in testability, scaleability, maintainability. It will be suitable for a large team and complex apps because it has mature best practices and community support.</p>\n<h2 id=\"mobx\">MobX</h2>\n<p>Data flow:<br>\n<img src=\"https://mobx.js.org/docs/flow.png\" alt=\"dataflow\"></p>\n<h3 id=\"observable\">observable</h3>\n<p>Observable values can be JS primitives, references, plain objects, class instances, arrays and maps.</p>\n<p>Usage:</p>\n<ul>\n<li>observable(value)</li>\n<li>@observable classProperty = value</li>\n</ul>\n<h3 id=\"computed-ampamp-autorun\">computed &amp;&amp; autorun</h3>\n<p>They are both reactively invoked expressions, but use @computed if you want to reactively produce a value that can be used by other observers and autorun if you don’t want to produce a new value but rather want to achieve an effect. For example imperative side effects like logging, making network requests etc.</p>\n<p>example:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;observable, computed&#125; from <span class=\"string\">\"mobx\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderLine</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@observable</span> price = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"meta\">@observable</span> amount = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(price) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.price = price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@computed</span> <span class=\"keyword\">get</span> total() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.price * <span class=\"keyword\">this</span>.amount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"observer\">(@)observer</h3>\n<p>The react components that are wrapped by observer will react to the change of observables.</p>\n<h3 id=\"action\">action</h3>\n<p>It has similar concepts as action in redux. Simply call <code>mobx.useStrict(true)</code> when your application is initialized, and MobX will throw anytime you (accidentally) try to modify state without using an action.</p>\n<h3 id=\"feature\">Feature</h3>\n<ul>\n<li>Reacting to state changes</li>\n<li>multiple stores</li>\n<li>object-oriented programming and reactive programming paradigms</li>\n<li>mutable</li>\n<li>impure</li>\n<li>implicit update logic</li>\n<li>“magic” JavaScript</li>\n<li>less boilerplate</li>\n<li>denormalized state</li>\n<li>nested state</li>\n<li>Examples\n<ul>\n<li>Real-time systems, dashboards, etc</li>\n<li>Text editors, presentation software, etc.</li>\n<li>Not for event based</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"mobx-todo-example\">mobx todo example:</h3>\n<p><a href=\"https://codesandbox.io/s/vnw0yzx555\" target=\"_blank\" rel=\"noopener\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit Simple MobX TodoList\"></a></p>\n<h3 id=\"summary\">Summary</h3>\n<p>Mobx is more suitable for simpler application, rapid prototyping and a small team. It has short learning curve for those that are already familiar with object-oriented programming. It can also be used in large projects if explicit constraints are added, such as useStrict.</p>\n<h2 id=\"new-context-api\">new context api</h2>\n<p>The new context api tries to provide a native global store for React apps and solves the problems that old context api has: <a href=\"https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shouldcomponentupdate-blocks-context-changes\" target=\"_blank\" rel=\"noopener\">shouldComponentUpdate blocks context changes</a> and <a href=\"https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shifts-complexity-to-user-space\" target=\"_blank\" rel=\"noopener\">Shifts complexity to user space</a></p>\n<p>Context in React provides a mechanism for a child component to access a value in an ancestor component.</p>\n<h3 id=\"reactcreatecontext\">React.createContext()</h3>\n<p>It is passed the initial value (and optionally a <a href=\"https://twitter.com/acdlite/status/957446433656864768\" target=\"_blank\" rel=\"noopener\">fancy opt-out function that uses a bitmask</a>). This returns an object with a “provider” and a “consumer”</p>\n<h3 id=\"provider\">Provider</h3>\n<p>The provider acts as an event emitter. It keeps track of the most recent context value, and a list of subscribers to be notified whenever it changes.</p>\n<h3 id=\"consumer\">Consumer</h3>\n<p>The consumer accesses the provider’s event emitter using the context API. (This usage is fine because the event emitter itself does not change). When the provider emits a change event, the consumer is notified and calls setState on itself to schedule a re-render.</p>\n<p>Example:</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const <span class=\"type\">ThemeContext</span> = <span class=\"type\">React</span>.createContext(<span class=\"symbol\">'ligh</span>t')</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThemeProvider</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;theme: <span class=\"symbol\">'ligh</span>t'&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">ThemeContext</span>.provide(<span class=\"keyword\">this</span>.state.theme, <span class=\"keyword\">this</span>.props.children)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const <span class=\"type\">ThemeConsumer</span> = (&#123;children&#125;) =&gt; <span class=\"type\">ThemeContext</span>.consume(children)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    &lt;<span class=\"type\">ThemeProvider</span>&gt;</span><br><span class=\"line\">      &lt;<span class=\"type\">ThemeConsumer</span>&gt;&#123;<span class=\"keyword\">val</span> =&gt; &lt;div&gt;&#123;<span class=\"keyword\">val</span>&#125;&lt;/div&gt;&#125;&lt;/<span class=\"type\">ThemeConsumer</span>&gt;</span><br><span class=\"line\">    &lt;/<span class=\"type\">ThemeProvider</span>&gt;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://codesandbox.io/s/k71q68nzr\" target=\"_blank\" rel=\"noopener\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit Example of React's new context API\"></a></p>\n<h3 id=\"summary\">Summary</h3>\n<p>New context api provides a native way to manage global store in react apps and is perfect for dependency injection (theme, intl, buildConfig), but it lacks the power to control the data flow. Redux or Mobx may still be needed to handle complex async data process.</p>\n<h2 id=\"resource\">Resource</h2>\n<p><a href=\"https://redux.js.org/\" target=\"_blank\" rel=\"noopener\">Redux Doc</a></p>\n<p><a href=\"https://mobx.js.org/index.html\" target=\"_blank\" rel=\"noopener\">Mobx Doc</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=76FRrbY18Bs\" target=\"_blank\" rel=\"noopener\">Preethi Kasireddy - MobX vs Redux: Comparing the Opposing Paradigms</a></p>\n<p><a href=\"https://www.robinwieruch.de/redux-mobx-confusion/\" target=\"_blank\" rel=\"noopener\">Redux or MobX: An attempt to dissolve the Confusion</a></p>\n<p><a href=\"https://medium.com/@DidierFranc/replacing-redux-with-the-new-react-context-api-8f5d01a00e8c\" target=\"_blank\" rel=\"noopener\">Replacing redux with the new React context API</a></p>\n<p><a href=\"https://github.com/acdlite/rfcs/blob/new-version-of-context/text/0000-new-version-of-context.md\" target=\"_blank\" rel=\"noopener\">new version of context</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Redux and Mobx are two most popular state management tools for React apps, representing different design philosophis as object-oriented programming and functional programming. Recently, a new context api has been proposed to provide a native global store solution and received a lot of discussions. Here’s a brief comparion of different methods. I have to say before hand, most things in software engineering are based on opinions and tradeoffs, not facts or hard truth.</p>\n<h2>Redux</h2>\n<p>Basic data flow:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph LR</span><br><span class=\"line\">A[Action]--&gt;|just payload|B(Reducer)</span><br><span class=\"line\">D[prevState] --&gt; B</span><br><span class=\"line\">B --&gt;|new state| C(Store)</span><br><span class=\"line\">C --&gt;|rerender| E(subscribed views)</span><br></pre></td></tr></table></figure>\n<h3>Action</h3>\n<p>Actions are just plain object that contains <code>type</code> and <code>payload</code> property, such as</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attribute\">type</span>: ADD_TODO,</span><br><span class=\"line\">    payload: text</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Actions should be returned by action creaters.</p>\n<h3>Reducer</h3>\n<p>Reducers are just pure functions that take the previous <code>related</code> state and action, then return the new state</p>\n<p>Reducers can be combined together by using a function <code>combineReducers</code> from <code>redux</code></p>\n<h3>Store</h3>\n<p>Single source of truth. Store should be created at the root level,</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createStore &#125; <span class=\"keyword\">from</span> <span class=\"string\">'redux'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Provider &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-redux'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> App <span class=\"keyword\">from</span> <span class=\"string\">'./components/App'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> reducer <span class=\"keyword\">from</span> <span class=\"string\">'./reducers'</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">const</span> store = createStore(reducer)</span><br><span class=\"line\"></span><br><span class=\"line\">render(</span><br><span class=\"line\">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class=\"line\">    &lt;App /&gt;</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/Provider&gt;,</span></span><br><span class=\"line\"><span class=\"regexp\">  document.getElementById('root')</span></span><br><span class=\"line\"><span class=\"regexp\">)</span></span><br></pre></td></tr></table></figure>\n<h3>APIs</h3>\n<ul>\n<li><a href=\"https://redux.js.org/api-reference/createstore\" target=\"_blank\" rel=\"noopener\">createStore</a>\n<ul>\n<li>create the single store at root level</li>\n</ul>\n</li>\n<li><a href=\"https://redux.js.org/api-reference/store\" target=\"_blank\" rel=\"noopener\">Store</a></li>\n<li><a href=\"https://redux.js.org/api-reference/combinereducers\" target=\"_blank\" rel=\"noopener\">combineReducers</a></li>\n<li><a href=\"https://note.youdao.com/\" target=\"_blank\" rel=\"noopener\">applyMiddleware</a>\n<ul>\n<li>useful for async ajax requests</li>\n</ul>\n</li>\n<li><a href=\"https://note.youdao.com/\" target=\"_blank\" rel=\"noopener\">bindActionCreators</a>\n<ul>\n<li>the only use case for this is when you want to pass some action creators down to a component that isn’t aware of Redux</li>\n</ul>\n</li>\n<li><a href=\"https://note.youdao.com/\" target=\"_blank\" rel=\"noopener\">compose</a>\n<ul>\n<li>composes functions from right to left</li>\n</ul>\n</li>\n</ul>\n<h3>react-redux</h3>\n<h4><provider store></provider></h4>\n<p>Makes the Redux store available to the connect() calls in the component hierarchy below.</p>\n<h4>connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])</h4>\n<p>Connects a React component to a Redux store.</p>\n<p><code>connect( mapStateToProps, mapDispatchToProps )(component)</code></p>\n<p>If no parameters are provided, it injects just dispatch and doesn’t listen to store</p>\n<p><strong>params:</strong></p>\n<ul>\n<li>\n<p>mapStateToProps(state, [ownProps]): stateProps</p>\n</li>\n<li>\n<p>mapDispatchToProps(dispatch, [ownProps]): dispatchProps</p>\n</li>\n</ul>\n<h3>related libraries</h3>\n<ul>\n<li>\n<p><a href=\"https://github.com/gaearon/redux-thunk\" target=\"_blank\" rel=\"noopener\">redux-thunk</a></p>\n<ul>\n<li>Redux Thunk middleware allows you to write action creators that return a function instead of an action.</li>\n<li>The thunk can be used to delay the dispatch of an action, or to dispatch only if a certain condition is met. Thus it’s very useful for async actions and promises.</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/redux-saga/redux-saga\" target=\"_blank\" rel=\"noopener\">redux-saga</a></p>\n<ul>\n<li>a library that aims to make application side effects (i.e. asynchronous things like data fetching and impure things like accessing the browser cache) easier to manage, more efficient to execute, simple to test, and better at handling failures.</li>\n</ul>\n</li>\n</ul>\n<h3>Feature</h3>\n<ul>\n<li>reacting to actions or events</li>\n<li>single store</li>\n<li>functional programming paradigm</li>\n<li>immutable</li>\n<li>pure</li>\n<li>explicit update logic</li>\n<li>plain JavaScript</li>\n<li>more boilerplate</li>\n<li>normalized state</li>\n<li>flat state</li>\n<li>examples:\n<ul>\n<li>business apps</li>\n<li>event based systems</li>\n<li>game events involving a complex reaction</li>\n</ul>\n</li>\n</ul>\n<h3>redux todolist example:</h3>\n<p><a href=\"https://codesandbox.io/s/1zo57njq9q\" target=\"_blank\" rel=\"noopener\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit todos\"></a></p>\n<h3>Summary</h3>\n<p>Redux is an opinionated library that reinforces immutable data and functional programming pattern. It provides more granular control of data flow and shines in testability, scaleability, maintainability. It will be suitable for a large team and complex apps because it has mature best practices and community support.</p>\n<h2>MobX</h2>\n<p>Data flow:<br>\n<img src=\"https://mobx.js.org/docs/flow.png\" alt=\"dataflow\"></p>\n<h3>observable</h3>\n<p>Observable values can be JS primitives, references, plain objects, class instances, arrays and maps.</p>\n<p>Usage:</p>\n<ul>\n<li>observable(value)</li>\n<li>@observable classProperty = value</li>\n</ul>\n<h3>computed &amp;&amp; autorun</h3>\n<p>They are both reactively invoked expressions, but use @computed if you want to reactively produce a value that can be used by other observers and autorun if you don’t want to produce a new value but rather want to achieve an effect. For example imperative side effects like logging, making network requests etc.</p>\n<p>example:</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;observable, computed&#125; from <span class=\"string\">\"mobx\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OrderLine</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@observable</span> price = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"meta\">@observable</span> amount = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(price) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.price = price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@computed</span> <span class=\"keyword\">get</span> total() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.price * <span class=\"keyword\">this</span>.amount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3>(@)observer</h3>\n<p>The react components that are wrapped by observer will react to the change of observables.</p>\n<h3>action</h3>\n<p>It has similar concepts as action in redux. Simply call <code>mobx.useStrict(true)</code> when your application is initialized, and MobX will throw anytime you (accidentally) try to modify state without using an action.</p>\n<h3>Feature</h3>\n<ul>\n<li>Reacting to state changes</li>\n<li>multiple stores</li>\n<li>object-oriented programming and reactive programming paradigms</li>\n<li>mutable</li>\n<li>impure</li>\n<li>implicit update logic</li>\n<li>“magic” JavaScript</li>\n<li>less boilerplate</li>\n<li>denormalized state</li>\n<li>nested state</li>\n<li>Examples\n<ul>\n<li>Real-time systems, dashboards, etc</li>\n<li>Text editors, presentation software, etc.</li>\n<li>Not for event based</li>\n</ul>\n</li>\n</ul>\n<h3>mobx todo example:</h3>\n<p><a href=\"https://codesandbox.io/s/vnw0yzx555\" target=\"_blank\" rel=\"noopener\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit Simple MobX TodoList\"></a></p>\n<h3>Summary</h3>\n<p>Mobx is more suitable for simpler application, rapid prototyping and a small team. It has short learning curve for those that are already familiar with object-oriented programming. It can also be used in large projects if explicit constraints are added, such as useStrict.</p>\n<h2>new context api</h2>\n<p>The new context api tries to provide a native global store for React apps and solves the problems that old context api has: <a href=\"https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shouldcomponentupdate-blocks-context-changes\" target=\"_blank\" rel=\"noopener\">shouldComponentUpdate blocks context changes</a> and <a href=\"https://github.com/reactjs/rfcs/blob/master/text/0002-new-version-of-context.md#shifts-complexity-to-user-space\" target=\"_blank\" rel=\"noopener\">Shifts complexity to user space</a></p>\n<p>Context in React provides a mechanism for a child component to access a value in an ancestor component.</p>\n<h3>React.createContext()</h3>\n<p>It is passed the initial value (and optionally a <a href=\"https://twitter.com/acdlite/status/957446433656864768\" target=\"_blank\" rel=\"noopener\">fancy opt-out function that uses a bitmask</a>). This returns an object with a “provider” and a “consumer”</p>\n<h3>Provider</h3>\n<p>The provider acts as an event emitter. It keeps track of the most recent context value, and a list of subscribers to be notified whenever it changes.</p>\n<h3>Consumer</h3>\n<p>The consumer accesses the provider’s event emitter using the context API. (This usage is fine because the event emitter itself does not change). When the provider emits a change event, the consumer is notified and calls setState on itself to schedule a re-render.</p>\n<p>Example:</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const <span class=\"type\">ThemeContext</span> = <span class=\"type\">React</span>.createContext(<span class=\"symbol\">'ligh</span>t')</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThemeProvider</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;theme: <span class=\"symbol\">'ligh</span>t'&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">ThemeContext</span>.provide(<span class=\"keyword\">this</span>.state.theme, <span class=\"keyword\">this</span>.props.children)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const <span class=\"type\">ThemeConsumer</span> = (&#123;children&#125;) =&gt; <span class=\"type\">ThemeContext</span>.consume(children)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    &lt;<span class=\"type\">ThemeProvider</span>&gt;</span><br><span class=\"line\">      &lt;<span class=\"type\">ThemeConsumer</span>&gt;&#123;<span class=\"keyword\">val</span> =&gt; &lt;div&gt;&#123;<span class=\"keyword\">val</span>&#125;&lt;/div&gt;&#125;&lt;/<span class=\"type\">ThemeConsumer</span>&gt;</span><br><span class=\"line\">    &lt;/<span class=\"type\">ThemeProvider</span>&gt;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://codesandbox.io/s/k71q68nzr\" target=\"_blank\" rel=\"noopener\"><img src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" alt=\"Edit Example of React's new context API\"></a></p>\n<h3>Summary</h3>\n<p>New context api provides a native way to manage global store in react apps and is perfect for dependency injection (theme, intl, buildConfig), but it lacks the power to control the data flow. Redux or Mobx may still be needed to handle complex async data process.</p>\n<h2>Resource</h2>\n<p><a href=\"https://redux.js.org/\" target=\"_blank\" rel=\"noopener\">Redux Doc</a></p>\n<p><a href=\"https://mobx.js.org/index.html\" target=\"_blank\" rel=\"noopener\">Mobx Doc</a></p>\n<p><a href=\"https://www.youtube.com/watch?v=76FRrbY18Bs\" target=\"_blank\" rel=\"noopener\">Preethi Kasireddy - MobX vs Redux: Comparing the Opposing Paradigms</a></p>\n<p><a href=\"https://www.robinwieruch.de/redux-mobx-confusion/\" target=\"_blank\" rel=\"noopener\">Redux or MobX: An attempt to dissolve the Confusion</a></p>\n<p><a href=\"https://medium.com/@DidierFranc/replacing-redux-with-the-new-react-context-api-8f5d01a00e8c\" target=\"_blank\" rel=\"noopener\">Replacing redux with the new React context API</a></p>\n<p><a href=\"https://github.com/acdlite/rfcs/blob/new-version-of-context/text/0000-new-version-of-context.md\" target=\"_blank\" rel=\"noopener\">new version of context</a></p>\n"}],"PostAsset":[{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP/cron_job.png","slug":"cron_job.png","post":"cjzg5rxxb0003x18lwphdkh5f","modified":0,"renderable":0},{"_id":"source/_posts/Automatically-create-merge-request-through-gitlab-api/gitlab-blog-cover.png","slug":"gitlab-blog-cover.png","post":"cjzg5rxy7001cx18lbri0p6po","modified":0,"renderable":0},{"_id":"source/_posts/Treechart-In-D3/tree.jpg","slug":"tree.jpg","post":"cjzg5rxxr000dx18ldf1vbphn","modified":0,"renderable":0},{"_id":"source/_posts/JavaScript-Flaws/centralPark.jpg","slug":"centralPark.jpg","post":"cjzg5rxxn0009x18lp39rdjhl","modified":0,"renderable":0},{"_id":"source/_posts/Python-Collections-And-Tricks/us_map.JPG","slug":"us_map.JPG","post":"cjzg5rxxo000ax18ltaq431q7","modified":0,"renderable":0},{"_id":"source/_posts/deploy-a-react-app-in-kubernetes/tree.jpg","slug":"tree.jpg","post":"cjzg5rxxt000ex18l4g56qdjc","modified":0,"renderable":0},{"_id":"source/_posts/一次关于networking的对话/lighthouse3.jpg","slug":"lighthouse3.jpg","post":"cjzg5rxxu000hx18lugdt1dwb","modified":0,"renderable":0},{"_id":"source/_posts/Interesting-Software-Names/trigger.png","slug":"trigger.png","post":"cjzg5rxxd0005x18l8ztycm94","modified":0,"renderable":0},{"_id":"source/_posts/Interesting-Software-Names/trip.JPG","slug":"trip.JPG","post":"cjzg5rxxd0005x18l8ztycm94","modified":0,"renderable":0},{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP/formlist.png","slug":"formlist.png","post":"cjzg5rxxb0003x18lwphdkh5f","modified":0,"renderable":0},{"_id":"source/_posts/Cloud-Based-Web-Tools-For-VIP/longwood.JPG","slug":"longwood.JPG","post":"cjzg5rxxb0003x18lwphdkh5f","modified":0,"renderable":0},{"_id":"source/_posts/To-My-Graduation/andy.jpg","slug":"andy.jpg","post":"cjzg5rxxq000bx18l5lwpp10t","modified":0,"renderable":0},{"_id":"source/_posts/To-My-Graduation/campus.JPG","slug":"campus.JPG","post":"cjzg5rxxq000bx18l5lwpp10t","modified":0,"renderable":0},{"_id":"source/_posts/To-My-Graduation/graduation.jpg","slug":"graduation.jpg","post":"cjzg5rxxq000bx18l5lwpp10t","modified":0,"renderable":0},{"_id":"source/_posts/To-My-Graduation/mac_room.JPG","slug":"mac_room.JPG","post":"cjzg5rxxq000bx18l5lwpp10t","modified":0,"renderable":0},{"_id":"source/_posts/python-leetcode-trick/antelope_valley.JPG","slug":"antelope_valley.JPG","post":"cjzg5rxy8001dx18l3b6ppt9p","modified":0,"renderable":0},{"_id":"source/_posts/react-global-state-management/sunset.JPG","slug":"sunset.JPG","post":"cjzg5rxya001fx18lpm67eutv","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cjzg5rxxb0003x18lwphdkh5f","category_id":"cjzg5rxxi0007x18lywu2klz6","_id":"cjzg5rxxt000fx18lduuao6yp"}],"PostTag":[{"post_id":"cjzg5rxxb0003x18lwphdkh5f","tag_id":"cjzg5rxxl0008x18lns10v6lr","_id":"cjzg5rxxw000jx18lfxs3l65t"},{"post_id":"cjzg5rxxb0003x18lwphdkh5f","tag_id":"cjzg5rxxq000cx18lwv9stsxw","_id":"cjzg5rxxw000kx18lgvn4i88v"},{"post_id":"cjzg5rxxb0003x18lwphdkh5f","tag_id":"cjzg5rxxt000gx18le29r6uik","_id":"cjzg5rxxw000mx18ll6rv2l62"},{"post_id":"cjzg5rxxd0005x18l8ztycm94","tag_id":"cjzg5rxxv000ix18l468gtpzw","_id":"cjzg5rxxy000rx18lnpmpnvb4"},{"post_id":"cjzg5rxxd0005x18l8ztycm94","tag_id":"cjzg5rxxw000lx18lb5j5gp1t","_id":"cjzg5rxxy000sx18l3t9zmr2f"},{"post_id":"cjzg5rxxd0005x18l8ztycm94","tag_id":"cjzg5rxxw000nx18lro9flxd0","_id":"cjzg5rxxz000ux18l2q8vvls9"},{"post_id":"cjzg5rxxd0005x18l8ztycm94","tag_id":"cjzg5rxxx000ox18l3tbekypj","_id":"cjzg5rxxz000vx18l4fqjgwpp"},{"post_id":"cjzg5rxxd0005x18l8ztycm94","tag_id":"cjzg5rxxq000cx18lwv9stsxw","_id":"cjzg5rxxz000xx18liu5xobl9"},{"post_id":"cjzg5rxxn0009x18lp39rdjhl","tag_id":"cjzg5rxxy000qx18lc55r18vj","_id":"cjzg5rxxz000yx18lpwmcf20v"},{"post_id":"cjzg5rxxo000ax18ltaq431q7","tag_id":"cjzg5rxxy000tx18lvky0it7v","_id":"cjzg5rxxz0010x18l2ut3cm0u"},{"post_id":"cjzg5rxxq000bx18l5lwpp10t","tag_id":"cjzg5rxxz000wx18l746gvsbg","_id":"cjzg5rxy00011x18lsqdn8xrb"},{"post_id":"cjzg5rxxr000dx18ldf1vbphn","tag_id":"cjzg5rxxz000zx18l30t21ro0","_id":"cjzg5rxy00013x18lvxlu7ud5"},{"post_id":"cjzg5rxxr000dx18ldf1vbphn","tag_id":"cjzg5rxxq000cx18lwv9stsxw","_id":"cjzg5rxy00014x18l023udu42"},{"post_id":"cjzg5rxxt000ex18l4g56qdjc","tag_id":"cjzg5rxxw000nx18lro9flxd0","_id":"cjzg5rxy10017x18lxapnghf4"},{"post_id":"cjzg5rxxt000ex18l4g56qdjc","tag_id":"cjzg5rxxq000cx18lwv9stsxw","_id":"cjzg5rxy10018x18l9r05iysw"},{"post_id":"cjzg5rxxt000ex18l4g56qdjc","tag_id":"cjzg5rxxl0008x18lns10v6lr","_id":"cjzg5rxy10019x18ljs0qkkvs"},{"post_id":"cjzg5rxxt000ex18l4g56qdjc","tag_id":"cjzg5rxxx000ox18l3tbekypj","_id":"cjzg5rxy2001ax18lff1pj4qn"},{"post_id":"cjzg5rxxu000hx18lugdt1dwb","tag_id":"cjzg5rxxz000wx18l746gvsbg","_id":"cjzg5rxy2001bx18lwtc0sqi5"},{"post_id":"cjzg5rxy7001cx18lbri0p6po","tag_id":"cjzg5rxy9001ex18l5nzpv82g","_id":"cjzg5rxyk001jx18lsl6uv1s8"},{"post_id":"cjzg5rxy7001cx18lbri0p6po","tag_id":"cjzg5rxyi001gx18l4xitlkox","_id":"cjzg5rxyk001kx18l5ls4ubkz"},{"post_id":"cjzg5rxy7001cx18lbri0p6po","tag_id":"cjzg5rxyj001hx18lkpyi0mpa","_id":"cjzg5rxyk001mx18l9l1ykc9y"},{"post_id":"cjzg5rxy8001dx18l3b6ppt9p","tag_id":"cjzg5rxxy000tx18lvky0it7v","_id":"cjzg5rxyl001ox18l8kfi3a54"},{"post_id":"cjzg5rxy8001dx18l3b6ppt9p","tag_id":"cjzg5rxyk001ix18lkjp0b71b","_id":"cjzg5rxyl001px18l8zpzohlc"},{"post_id":"cjzg5rxy8001dx18l3b6ppt9p","tag_id":"cjzg5rxyk001lx18l63ffwyyu","_id":"cjzg5rxyl001rx18l0m0cqtrb"},{"post_id":"cjzg5rxya001fx18lpm67eutv","tag_id":"cjzg5rxyk001nx18lbsfe14ow","_id":"cjzg5rxym001tx18lyemd5ss1"},{"post_id":"cjzg5rxya001fx18lpm67eutv","tag_id":"cjzg5rxyl001qx18l3i6da7f8","_id":"cjzg5rxym001ux18lz8wd6dn3"},{"post_id":"cjzg5rxya001fx18lpm67eutv","tag_id":"cjzg5rxyl001sx18lk8hjh0r2","_id":"cjzg5rxym001vx18ly5wls4bh"}],"Tag":[{"name":"Cloud","_id":"cjzg5rxxl0008x18lns10v6lr"},{"name":"React.js","_id":"cjzg5rxxq000cx18lwv9stsxw"},{"name":"Firebase","_id":"cjzg5rxxt000gx18le29r6uik"},{"name":"CockroachDB","_id":"cjzg5rxxv000ix18l468gtpzw"},{"name":"Google","_id":"cjzg5rxxw000lx18lb5j5gp1t"},{"name":"Kubernetes","_id":"cjzg5rxxw000nx18lro9flxd0"},{"name":"Docker","_id":"cjzg5rxxx000ox18l3tbekypj"},{"name":"JavaScript","_id":"cjzg5rxxy000qx18lc55r18vj"},{"name":"python","_id":"cjzg5rxxy000tx18lvky0it7v"},{"name":"Thoughts","_id":"cjzg5rxxz000wx18l746gvsbg"},{"name":"D3.js","_id":"cjzg5rxxz000zx18l30t21ro0"},{"name":"gitlab","_id":"cjzg5rxy9001ex18l5nzpv82g"},{"name":"bash","_id":"cjzg5rxyi001gx18l4xitlkox"},{"name":"node","_id":"cjzg5rxyj001hx18lkpyi0mpa"},{"name":"leetcode","_id":"cjzg5rxyk001ix18lkjp0b71b"},{"name":"algorithm","_id":"cjzg5rxyk001lx18l63ffwyyu"},{"name":"React","_id":"cjzg5rxyk001nx18lbsfe14ow"},{"name":"Redux","_id":"cjzg5rxyl001qx18l3i6da7f8"},{"name":"Mobx","_id":"cjzg5rxyl001sx18lk8hjh0r2"}]}}